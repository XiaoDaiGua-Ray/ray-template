import{n as p,d as h,h as u,p as b}from"./index-3666ac9c.js";import{l as R}from"./awesome-qr@2.1.5-rc.0-7b2b96ae.js";import{k as S,D as A,n as k,f as v,b as t,F as w}from"./@vue_runtime-core@3.3.4-1efe2776.js";import{k as B}from"./@vue_reactivity@3.3.4-dab4163d.js";import{e as N,Q as D}from"./naive-ui@2.34.4_vue@3.3.4-ac34c8ed.js";const L={loadingDescription:{type:String},watchText:{type:Boolean,default:!0},status:{type:String},errorDescription:{type:[String,Object],default:"二维码已过期"},errorActionDescription:{type:String,default:"重新加载"},text:{type:String,required:!0},size:{type:Number,default:160},margin:{type:Number,default:12},correctLevel:{type:Number,default:1,validator:r=>[0,1,2,3].includes(r)},maskPattern:{type:Number},version:{type:Number},components:{type:Object,default:()=>({data:{scale:1},timing:{scale:1,protectors:!1},alignment:{scale:1,protectors:!1},cornerAlignment:{scale:1,protectors:!0}})},colorDark:{type:String,default:"#000000"},colorLight:{type:String,default:"#ffffff"},autoColor:{type:Boolean,default:!0},backgroundImage:{type:String},backgroundDimming:{type:String,default:"rgba(0, 0, 0, 0)"},gifBackgroundURL:{type:String},gifBackground:{type:ArrayBuffer},whiteMargin:{type:Boolean,default:!0},logoImage:{type:String},logoScale:{type:Number,default:.4},logoMargin:{type:Number,default:6},logoCornerRadius:{type:Number,default:8},dotScale:{type:Number,default:1},onSuccess:{type:[Function,Array],default:null},onError:{type:[Function,Array],default:null},onReload:{type:[Function,Array],default:null}},F=r=>new Promise((s,c)=>{const e=new XMLHttpRequest;e.responseType="blob",e.onload=()=>{const n=new FileReader;n.onloadend=()=>{s(n.result)},n.onerror=a=>{c(a)},n.onabort=a=>{c(a)},n.readAsArrayBuffer(e.response)},e.open("GET",r),e.send()}),Q=S({name:"RayQRcode",props:L,setup(r,s){const{expose:c}=s,e=B(),n={opacitySpinning:"0.1"};let a;const g=async()=>{const{gifBackgroundURL:o}=r;if(o)try{a=await F(o)}catch(d){console.error(d)}},f=()=>{const{gifBackground:o,...d}=r;new R.AwesomeQR({...d,gifBackground:a??void 0}).draw().then(l=>{const{onSuccess:i}=r;i&&u(i,l),e.value=l}).catch(l=>{const{onError:i}=r;i&&u(i,l)})},y=()=>{if(s.slots.errorAction)return;const{onReload:o}=r;o&&u(o)},m=o=>{e.value&&p(e.value,"String")&&b(e.value,o)};return A(()=>{r.watchText&&k().then(()=>{f()})}),c({downloadQRCode:m}),v(async()=>{await g(),f()}),{qrcodeURL:e,spinOverrides:n,errorActionClick:y}},render(){return t("div",{class:"ray-qrcode"},[t(N,{show:this.status==="loading",themeOverrides:this.spinOverrides,description:this.loadingDescription},{default:()=>[t("img",{src:this.qrcodeURL},null)]}),this.status==="error"?t("div",{class:"ray-qrcode__error"},[t("div",{class:"ray-qrcode__error-content"},[p(this.errorDescription,"String")?this.errorDescription:()=>this.errorDescription]),t("div",{class:"ray-qrcode__error-btn",onClick:this.errorActionClick.bind(this)},[this.$slots.errorAction?this.$slots.errorAction():t(w,null,[t(D,{text:!0,color:"#ffffff"},{default:()=>this.errorActionDescription,icon:()=>t(h,{name:"reload",size:"16",color:"#ffffff"},null)})])])]):null])}}),T="/ray-template/assets/ray-ab649d1c.svg";export{T as L,Q as R};
