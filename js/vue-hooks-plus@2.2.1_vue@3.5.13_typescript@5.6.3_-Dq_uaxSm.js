import{u as h,k as b,v as y,e as X,a as Y,x as Z,l as K}from"./@vue_reactivity@3.5.13-CjJL8SnF.js";import{j as P,w as V,f as q,i as k,Q as ee}from"./@vue_runtime-core@3.5.13-BsGyjLIk.js";import{d as ne,t as te,c as j}from"./lodash@4.17.21-D1YkSij2.js";import"./js-cookie@3.0.5-Z_8Sd105.js";import{s as g}from"./screenfull@5.2.0-DQHhvod-.js";const z=(t,{manual:e,ready:n=!0,refreshDeps:s=[],refreshDepsAction:i})=>{const u=b(!1);return P(()=>{!e&&t.options.refreshDeps!==!0&&(u.value=h(n))}),s instanceof Array?V([u,...s],([r])=>{r&&!e&&r&&(i?i():t.refresh())},{deep:!0,immediate:!1}):V(u,r=>{!e&&r&&(i?i():t.refresh())}),{name:"autoRunPlugin",onBefore:()=>{if(!h(n))return{stopNow:!0}}}};z.onInit=({ready:t=!0,manual:e})=>({loading:!e&&h(t)});const T=new Map,se=(t,e,n)=>{const s=T.get(t);s!=null&&s.timer&&clearTimeout(s.timer);let i;e>-1&&(i=setTimeout(()=>{T.delete(t)},e)),T.set(t,{...n,timer:i})},ie=t=>T.get(t),F=new Map,re=t=>F.get(t),ue=(t,e)=>{F.set(t,e),e.then(n=>(F.delete(t),n)).catch(n=>{throw F.delete(t),n})},S={},le=[],ae=(t,e)=>{S[t]&&(S[t].forEach(n=>n(e)),le.forEach(n=>n({type:t,data:e})))},C=(t,e)=>(S[t]||(S[t]=[]),S[t].push(e),function(){const s=S[t].indexOf(e);S[t].splice(s,1)}),oe=(t,{cacheKey:e,cacheTime:n=5*60*1e3,staleTime:s=0,setCache:i,getCache:u})=>{const r=b(),o=b(),c=(l,f)=>{i?i(f):se(l,n,f),ae(l,f.data)},d=(l,f=[])=>u?u(f):ie(l);return P(()=>{if(!e)return;const l=d(e);l&&Object.hasOwnProperty.call(l,"data")&&(t.state.data=l.data,t.state.params=l.params,(s===-1||new Date().getTime()-l.time<=s)&&(t.state.loading=!1)),r.value=C(e,f=>{t.setState({data:f})})}),y(()=>{var l;(l=r.value)==null||l.call(r)}),e?{name:"cachePlugin",onBefore:l=>{const f=d(e,l);return!f||!Object.hasOwnProperty.call(f,"data")?{}:s===-1||new Date().getTime()-f.time<=s?{loading:!1,data:f==null?void 0:f.data,returnNow:!0}:{data:f==null?void 0:f.data}},onRequest:(l,f)=>{let m=re(e);return m&&m!==o.value?{servicePromise:m}:(m=l(...f),o.value=m,ue(e,m),{servicePromise:m})},onSuccess:(l,f)=>{var m;e&&((m=r.value)==null||m.call(r),c(e,{data:l,params:f,time:new Date().getTime()}),r.value=C(e,a=>{t.setState({data:a})}))},onMutate:l=>{var f;e&&((f=r.value)==null||f.call(r),c(e,{data:l,params:t.state.params,time:new Date().getTime()}),r.value=C(e,m=>{t.setState({data:m})}))}}:{}},ce=(t,{debounceWait:e,debounceLeading:n,debounceTrailing:s,debounceMaxWait:i})=>{const u=b(),r=q(()=>{const o={},c=h(n),d=h(s),l=h(i);return c!==void 0&&(o.leading=c),d!==void 0&&(o.trailing=d),l!==void 0&&(o.maxWait=l),o});return P(o=>{if(h(e)){const c=t.runAsync.bind(t);u.value=ne(d=>{d()},h(e),r.value),t.runAsync=(...d)=>new Promise((l,f)=>{var m;(m=u.value)==null||m.call(u,()=>{c(...d).then(l).catch(f)})}),o(()=>{var d;(d=u.value)==null||d.cancel(),t.runAsync=c})}}),h(e)?{name:"debouncePlugin",onCancel:()=>{var o;(o=u.value)==null||o.cancel()}}:{}};var fe=Object.defineProperty,de=(t,e,n)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,I=(t,e,n)=>(de(t,typeof e!="symbol"?e+"":e,n),n);class he{constructor(){I(this,"table",{}),I(this,"hashTable",{})}insert(e){const n=Symbol(e);return this.table[e]=!0,this.hashTable[n]=e,n}find(e){return this.hashTable[e]}}new he;var me=Object.defineProperty,pe=(t,e,n)=>e in t?me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Q=(t,e,n)=>(pe(t,typeof e!="symbol"?e+"":e,n),n);class ve{constructor(){Q(this,"requestInstances",new Map),Q(this,"listeners",[])}emit(e){this.listeners.forEach(n=>n(e))}subscribe(e){return this.listeners.push(e),()=>{const n=this.listeners.indexOf(e);this.listeners.splice(n,1)}}insert(e,n){this.requestInstances.set(e,{...n}),this.emit({key:e,...n})}update(e,n){this.has(e)&&this.requestInstances.set(e,{...this.requestInstances.get(e),...n})}has(e){return this.requestInstances.has(e)}reset(e){if(this.requestInstances.has(e)){const n=this.requestInstances.get(e);this.requestInstances.clear(),this.insert(e,n)}else this.requestInstances.clear()}getAll(){return this.requestInstances}}new ve;const be=(t,{loadingDelay:e})=>{const n=b(),s=()=>{n.value&&(clearTimeout(h(n.value)),n.value=void 0)};return{name:"loadingDelayPlugin",onFinally:()=>{s();const i=h(e);i&&(t.setState({loading:!0}),n.value=setTimeout(()=>{t.setState({loading:!1})},i))},onError:()=>{s()}}};function B(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}const ge=!!(typeof window<"u"&&window.document&&window.document.createElement);function U(){return B()?document.visibilityState!=="hidden":!0}const O=[];function _e(t){return O.push(t),function(){const n=O.indexOf(t);O.splice(n,1)}}if(B()){const t=()=>{if(U())for(let e=0;e<O.length;e++){const n=O[e];n()}};window.addEventListener("visibilitychange",t,!1)}const we=(t,{pollingInterval:e,pollingWhenHidden:n=!0,pollingErrorRetryCount:s=-1})=>{let i;const u=b(),r=b(0),o=()=>{var c;i&&clearTimeout(i),(c=u.value)==null||c.call(u)};return P(()=>{h(e)||o()}),h(e)?{name:"pollingPlugin",onBefore:()=>{o()},onError:()=>{r.value+=1},onSuccess:()=>{r.value=0},onFinally:()=>{s===-1||s!==-1&&r.value<=s?i=setTimeout(()=>{!n&&!U()?u.value=_e(()=>{t.refresh()}):t.refresh()},h(e)):r.value=0},onCancel:()=>{o()}}:{}};function Pe(t,e){let n=!1;return(...s)=>{n||(n=!0,t(...s),setTimeout(()=>{n=!1},e))}}function Ee(){return B()&&typeof navigator.onLine<"u"?navigator.onLine:!0}const D=[];function Re(t){return D.push(t),function(){const n=D.indexOf(t);n>-1&&D.splice(n,1)}}if(ge){const t=()=>{if(!(!U()||!Ee()))for(let e=0;e<D.length;e++){const n=D[e];n()}};window.addEventListener("visibilitychange",t,!1),window.addEventListener("focus",t,!1)}const Se=(t,{refreshOnWindowFocus:e,focusTimespan:n=5e3})=>{const s=b(),i=()=>{var u;(u=s.value)==null||u.call(s)};return P(u=>{if(h(e)){const r=Pe(t.refresh.bind(t),h(n));s.value=Re(()=>{r()})}u(()=>{i()})}),y(()=>{i()}),{name:"refreshOnWindowFocusPlugin"}},Oe=(t,{retryInterval:e,retryCount:n})=>{const s=b(),i=b(0),u=b(!1);return n?{name:"retryPlugin",onBefore:()=>{u.value||(i.value=0),u.value=!1,s.value&&clearTimeout(s.value)},onSuccess:()=>{i.value=0},onError:()=>{if(i.value+=1,n===-1||i.value<=n){const r=e??Math.min(1e3*2**i.value,3e4);s.value=setTimeout(()=>{u.value=!0,t.refresh()},r)}else i.value=0},onCancel:()=>{i.value=0,s.value&&clearTimeout(s.value)}}:{}},De=(t,{throttleWait:e,throttleLeading:n,throttleTrailing:s})=>{const i=q(()=>{const r={};return h(n)!==void 0&&(r.leading=h(n)),h(s)!==void 0&&(r.trailing=h(s)),r}),u=q(()=>te(r=>{r()},h(e),i.value));return P(r=>{if(h(e)){const o=t.runAsync.bind(t);t.runAsync=(...c)=>new Promise((d,l)=>{var f;(f=u.value)==null||f.call(u,()=>{o(...c).then(d).catch(l)})}),r(()=>{var c;t.runAsync=o,(c=u.value)==null||c.cancel()})}}),h(e)?{name:"throttlePlugin",onCancel:()=>{var r;(r=u.value)==null||r.cancel()}}:{}},G=t=>typeof t=="function",Ae=t=>typeof t=="boolean";var Te=Object.defineProperty,Fe=(t,e,n)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,A=(t,e,n)=>(Fe(t,typeof e!="symbol"?e+"":e,n),n);class qe{constructor(e,n,s,i={}){A(this,"pluginImpls"),A(this,"count",0),A(this,"state",{loading:!1,params:void 0,data:void 0,error:void 0}),A(this,"previousValidData"),this.serviceRef=e,this.options=n,this.setUpdateData=s,this.initState=i,this.state={...this.state,loading:!n.manual,...i}}setState(e={}){this.state={...this.state,...e},this.setUpdateData(this.state)}setData(e,n){console.warn("Please use 'setFetchState' instead of 'setData'"),n instanceof Array?n.forEach(s=>{this.state[s]=e,this.setUpdateData(e,s)}):(this.state[n]=e,this.setUpdateData(e,n))}setFetchState(e,n){n instanceof Array?n.forEach(s=>{this.state[s]=e,this.setUpdateData(e,s)}):(this.state[n]=e,this.setUpdateData(e,n))}runPluginHandler(e,...n){var s,i,u;const r=(u=(i=(s=this.pluginImpls)==null?void 0:s.map(o=>{var c;return(c=o[e])==null?void 0:c.call(o,...n)}))!=null?i:[])==null?void 0:u.filter(Boolean);return Object.assign({},...r)}async runAsync(...e){var n,s,i,u,r,o,c,d,l,f,m;this.count+=1;const a=this.count,{stopNow:w=!1,returnNow:p=!1,..._}=this.runPluginHandler("onBefore",e);if(w)return new Promise(()=>{});if(this.setState({loading:!0,params:e,..._}),p)return Promise.resolve(_.data);try{(s=(n=this.options).onBefore)==null||s.call(n,e)}catch(v){return this.setState({error:v,loading:!1}),(u=(i=this.options).onError)==null||u.call(i,v,e),this.runPluginHandler("onError",v,e),new Promise(()=>{})}try{let{servicePromise:v}=this.runPluginHandler("onRequest",this.serviceRef.value,e);const J=$=>{var L,H,N,M;if(a!==this.count)return new Promise(()=>{});const E=this.options.formatResult?this.options.formatResult($):$;return this.setState({data:E,error:void 0,loading:!1}),(H=(L=this.options).onSuccess)==null||H.call(L,E,e),this.runPluginHandler("onSuccess",E,e),this.previousValidData=E,(M=(N=this.options).onFinally)==null||M.call(N,e,E,void 0),a===this.count&&this.runPluginHandler("onFinally",e,E,void 0),E};v||(v=this.serviceRef.value(...e));const W=await v;return J(W)}catch(v){if(a!==this.count)return new Promise(()=>{});throw this.setState({error:v,loading:!1}),(o=(r=this.options).onError)==null||o.call(r,v,e),this.runPluginHandler("onError",v,e),(G((c=this.options)==null?void 0:c.rollbackOnError)&&((d=this.options)!=null&&d.rollbackOnError(e))||Ae((l=this.options)==null?void 0:l.rollbackOnError)&&this.options.rollbackOnError)&&this.setState({data:this.previousValidData}),(m=(f=this.options).onFinally)==null||m.call(f,e,void 0,v),a===this.count&&this.runPluginHandler("onFinally",e,void 0,v),v}}run(...e){this.runAsync(...e).catch(n=>{this.options.onError||console.error(n)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const n=G(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})}}const Ce=Symbol("USEREQUEST_GLOBAL_OPTIONS_PROVIDE_KEY");function xe(t){return Object.keys(t).filter(n=>["data","loading","params","error"].includes(n)).length===4}function ye(t,e={},n=[]){const s=k(Ce,{}),{initialData:i=void 0,manual:u=!1,ready:r=!0,...o}={...s??{},...e??{}},c={manual:u,ready:r,initialData:i,...o},d=b(t),l=X({data:i,loading:!1,params:void 0,error:void 0}),f=(p,_)=>{_?l[_]=p:xe(p)&&(l.data=p.data,l.loading=p.loading,l.error=p.error,l.params=p.params)},m=n.map(p=>{var _;return(_=p==null?void 0:p.onInit)==null?void 0:_.call(p,c)}).filter(Boolean),a=new qe(d,c,f,Object.assign({},...m,l));a.options=c,a.pluginImpls=n.map(p=>p(a,c));const w=q(()=>Y(r)?r.value:r);if(P(()=>{if(!u){const p=a.state.params||e.defaultParams||[];w.value&&a.options.refreshDeps===!0&&d.value&&a.run(...p)}}),!u&&a.options.refreshDeps!==!0){const p=a.state.params||e.defaultParams||[];h(r)&&a.run(...p)}return y(()=>{a.cancel()}),{...Z(l),cancel:a.cancel.bind(a),refresh:a.refresh.bind(a),refreshAsync:a.refreshAsync.bind(a),run:a.run.bind(a),runAsync:a.runAsync.bind(a),mutate:a.mutate.bind(a)}}const Be=(t,e)=>function(s,i={},u=[]){let r=t;const o=e||[];for(let c=o.length;c--;)r=o[c](r);return r(s,i,u)};function Qe(t,e,n){var s;const i=(s=[null,ce,be,we,Se,De,z,oe,Oe])==null?void 0:s.filter(Boolean);return Be(ye,e==null?void 0:e.use)(t,e,[...i])}const Ue=!!(typeof window<"u"&&window.document&&window.document.createElement);function x(t,e){var n,s;if(!Ue)return;if(!t)return e;let i;return typeof t=="function"?i=t():Y(t)?i=(s=(n=t.value)==null?void 0:n.$el)!=null?s:t.value:i=t,i}var $e=Object.defineProperty,Le=(t,e,n)=>e in t?$e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,R=(t,e,n)=>(Le(t,typeof e!="symbol"?e+"":e,n),n);class He{constructor(){R(this,"subscriptions",new Map),R(this,"emitEffectCache",new Map),R(this,"useSubscription",(e,n)=>{const s=b();P(i=>{var u,r;s.value=n;function o(d){s.value&&s.value(d)}const c=(r=(u=this.subscriptions)==null?void 0:u.get(e))!=null?r:[];c.push(o),this.subscriptions.set(e,c),this.emitEffect(e),i(()=>{this.subscriptions.delete(e)})})}),R(this,"emit",(e,...n)=>{if(typeof e=="string"||typeof e=="number"){const s=this.subscriptions.get(e);s==null||s.forEach(i=>{i==null||i({params:j(n),event:e})}),this.emitEffectCache.set(e,{params:j(n),event:e})}else throw new TypeError("event must be string or number !")}),R(this,"emitEffect",e=>{const n=this.emitEffectCache.get(e),s=this.subscriptions.get(e);n&&(s==null||s.forEach(i=>{i==null||i({...n})}))}),R(this,"removeListener",e=>{this.subscriptions.delete(e)}),R(this,"clear",()=>{this.subscriptions.clear()}),this.clear()}}new He;const Ge=(t,e)=>{const{onExit:n,onEnter:s,defaultElement:i=document.documentElement}={},u=b(n),r=b(s),o=b(!1),c=a=>{o.value=a},d=()=>{var a,w,p;if(g.isEnabled){const _=x(t,i);if(!g.element)(a=u.value)==null||a.call(u),c(!1),g.off("change",d);else{const v=g.element===_;v?(w=r.value)==null||w.call(r):(p=u.value)==null||p.call(u),c(v)}}},l=()=>{const a=x(t,i);if(a&&g.isEnabled)try{g.request(a),g.on("change",d)}catch(w){console.error(w)}},f=()=>{const a=x(t,i);g.isEnabled&&g.element===a&&g.exit()},m=()=>{o.value?f():l()};return ee(()=>{g.isEnabled&&g.off("change",d)}),[K(o),{enterFullscreen:l,exitFullscreen:f,toggleFullscreen:m,isEnabled:g.isEnabled}]};export{Qe as a,Ge as u};
