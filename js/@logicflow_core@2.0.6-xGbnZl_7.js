import{o as fo}from"./mobx-preact@3.0.0_mobx@5.15.7_preact@10.22.0-DV7O4jNC.js";import{u as x,b as V,_ as Gr,m as Gn,q as co}from"./preact@10.22.0-Dw4c-0kT.js";import{a as z,c as b,m as Fr,g as $r,n as dn,p as Zt,f as W,t as Nt,b as Ot,d as Bt,i as Qt,e as Jt,s as po,h as ho,j as Wn,k as yo,l as go,r as vo,o as Zn,q as _o,u as mo,v as Ur,w as xo,x as Eo}from"./lodash-es@4.17.21-l6r90Unf.js";import{c as Mo,t as vt,i as Wr,s as Oo,o as E,a as $,b as m,r as So}from"./mobx@5.15.7-BvNiR7Ki.js";import{v as wo}from"./uuid@9.0.1-CtRu48qb.js";import{c as Ao}from"./classnames@2.5.1-BXd8anFz.js";import{M as Po}from"./mousetrap@1.6.5-D2xAa-oQ.js";import{d as To}from"./mobx-utils@5.6.2_mobx@5.15.7-D4RSJWSh.js";var No=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},_e;(function(r){function e(t){var n=No(t,[]),o=t.container;if(!o)throw new Error("Ensure the container of LogicFlow is specified and valid.");return z({},r.defaults,n)}r.get=e})(_e||(_e={}));(function(r){r.defaults={background:!1,grid:!1,textEdit:!0,snapline:!0,outline:!1,disabledTools:[]}})(_e||(_e={}));var Vn={node:!1,edge:!1},Do={node:!0,edge:!0},bo=function(r){return!r||typeof r=="boolean"?r===!0?b(Do):b(Vn):Fr(b(Vn),r)},Co=function(){return $r(window,"navigator.userAgent","").match(/MSIE|Trident/)!==null};function tt(r){try{return JSON.parse(JSON.stringify(r))}catch{return r}}var Kn=200,Lo=9999,jo=10,B;(function(r){r[r.DEFAULT=1]="DEFAULT",r[r.TEXT_EDIT=2]="TEXT_EDIT",r[r.SHOW_MENU=3]="SHOW_MENU",r[r.ALLOW_CONNECT=4]="ALLOW_CONNECT",r[r.NOT_ALLOW_CONNECT=5]="NOT_ALLOW_CONNECT"})(B||(B={}));var U;(function(r){r.NODE="node",r.EDGE="edge",r.GRAPH="graph"})(U||(U={}));var j;(function(r){r.NODE="node",r.CIRCLE_NODE="circle-node",r.POLYGON_NODE="polygon-node",r.RECT_NODE="rect-node",r.TEXT_NODE="text-node",r.ELLIPSE_NODE="ellipse-node",r.DIAMOND_NODE="diamond-node",r.HTML_NODE="html-node",r.CUSTOM_HTML_NODE="custom-html-node",r.EDGE="edge",r.LINE_EDGE="line-edge",r.POLYLINE_EDGE="polyline-edge",r.BEZIER_EDGE="bezier-edge",r.GRAPH="graph"})(j||(j={}));var T;(function(r){r.ELEMENT_CLICK="element:click",r.NODE_ADD="node:add",r.NODE_DELETE="node:delete",r.NODE_CLICK="node:click",r.NODE_DBCLICK="node:dbclick",r.NODE_GROUP_COPY="node:group-copy-add",r.NODE_DND_ADD="node:dnd-add",r.NODE_DND_DRAG="node:dnd-drag",r.NODE_MOUSEDOWN="node:mousedown",r.NODE_DRAGSTART="node:dragstart",r.NODE_DRAG="node:drag",r.NODE_DROP="node:drop",r.NODE_MOUSEUP="node:mouseup",r.NODE_MOUSEMOVE="node:mousemove",r.NODE_MOUSEENTER="node:mouseenter",r.NODE_MOUSELEAVE="node:mouseleave",r.NODE_CONTEXTMENU="node:contextmenu",r.NODE_ROTATE="node:rotate",r.NODE_RESIZE="node:resize",r.NODE_PROPERTIES_CHANGE="node:properties-change",r.NODE_PROPERTIES_DELETE="node:properties-delete",r.EDGE_ADD="edge:add",r.EDGE_DELETE="edge:delete",r.EDGE_CLICK="edge:click",r.EDGE_DBCLICK="edge:dbclick",r.EDGE_MOUSEENTER="edge:mouseenter",r.EDGE_MOUSELEAVE="edge:mouseleave",r.EDGE_CONTEXTMENU="edge:contextmenu",r.EDGE_ADJUST="edge:adjust",r.EDGE_EXCHANGE_NODE="edge:exchange-node",r.ANCHOR_DRAGSTART="anchor:dragstart",r.ANCHOR_DRAG="anchor:drag",r.ANCHOR_DROP="anchor:drop",r.ANCHOR_DRAGEND="anchor:dragend",r.ADJUST_POINT_MOUSEDOWN="adjustPoint:mousedown",r.ADJUST_POINT_MOUSEUP="adjustPoint:mouseup",r.ADJUST_POINT_MOUSEMOVE="adjustPoint:mousemove",r.ADJUST_POINT_DRAGSTART="adjustPoint:dragstart",r.ADJUST_POINT_DRAG="adjustPoint:drag",r.ADJUST_POINT_DROP="adjustPoint:drop",r.ADJUST_POINT_DRAGEND="adjustPoint:dragend",r.BLANK_MOUSEDOWN="blank:mousedown",r.BLANK_DRAGSTART="blank:dragstart",r.BLANK_DRAG="blank:drag",r.BLANK_DROP="blank:drop",r.BLANK_MOUSEMOVE="blank:mousemove",r.BLANK_MOUSEUP="blank:mouseup",r.BLANK_CLICK="blank:click",r.BLANK_CONTEXTMENU="blank:contextmenu",r.SELECTION_MOUSEDOWN="selection:mousedown",r.SELECTION_DRAGSTART="selection:dragstart",r.SELECTION_DRAG="selection:drag",r.SELECTION_DROP="selection:drop",r.SELECTION_MOUSEMOVE="selection:mousemove",r.SELECTION_MOUSEUP="selection:mouseup",r.SELECTION_CONTEXTMENU="selection:contextmenu",r.CONNECTION_NOT_ALLOWED="connection:not-allowed",r.TEXT_MOUSEDOWN="text:mousedown",r.TEXT_DRAGSTART="text:dragstart",r.TEXT_DRAG="text:drag",r.TEXT_DROP="text:drop",r.TEXT_CLICK="text:click",r.TEXT_DBCLICK="text:dbclick",r.TEXT_BLUR="text:blur",r.TEXT_MOUSEMOVE="text:mousemove",r.TEXT_MOUSEUP="text:mouseup",r.TEXT_FOCUS="text:focus",r.TEXT_ADD="text:add",r.TEXT_UPDATE="text:update",r.TEXT_CLEAR="text:clear",r.LABEL_MOUSEDOWN="label:mousedown",r.LABEL_DRAGSTART="label:dragstart",r.LABEL_DRAG="label:drag",r.LABEL_DROP="label:drop",r.LABEL_CLICK="label:click",r.LABEL_DBCLICK="label:dbclick",r.LABEL_BLUR="label:blur",r.LABEL_MOUSEMOVE="label:mousemove",r.LABEL_MOUSEUP="label:mouseup",r.LABEL_FOCUS="label:focus",r.LABEL_ADD="label:add",r.LABEL_UPDATE="label:update",r.LABEL_CLEAR="label:clear",r.LABEL_DELETE="label:delete",r.LABEL_SHOULD_ADD="label:should-add",r.LABEL_BATCH_ADD="label:batch-add",r.LABEL_SHOULD_UPDATE="label:should-update",r.LABEL_SHOULD_DELETE="label:should-delete",r.LABEL_BATCH_DELETE="label:batch-delete",r.LABEL_NOT_ALLOWED_ADD="label:not-allowed-add",r.HISTORY_CHANGE="history:change",r.GRAPH_TRANSFORM="graph:transform",r.GRAPH_RENDERED="graph:rendered",r.GRAPH_UPDATED="graph:updated"})(T||(T={}));var ct;(function(r){r[r.DEFAULT=0]="DEFAULT",r[r.INCREASE=1]="INCREASE"})(ct||(ct={}));var F;(function(r){r.HORIZONTAL="horizontal",r.VERTICAL="vertical"})(F||(F={}));var ht;(function(r){r.TEXT="text",r.LABEL="label"})(ht||(ht={}));var Ro=0,xt=function(){function r(e){var t=e.onDragStart,n=t===void 0?dn:t,o=e.onDragging,i=o===void 0?dn:o,a=e.onDragEnd,s=a===void 0?dn:a,d=e.eventType,l=d===void 0?"":d,u=e.eventCenter,f=e.step,c=f===void 0?1:f,h=e.isStopPropagation,g=h===void 0?!0:h,p=e.model,v=e.data,y=this;this.isDragging=!1,this.isStartDragging=!1,this.startX=0,this.startY=0,this.sumDeltaX=0,this.sumDeltaY=0,this.handleMouseDown=function(_){var M,S,O=window==null?void 0:window.document;if(_.button===Ro){y.isStopPropagation&&_.stopPropagation(),y.isStartDragging=!0,y.startX=_.clientX,y.startY=_.clientY,O.addEventListener("mousemove",y.handleMouseMove,!1),O.addEventListener("mouseup",y.handleMouseUp,!1);var w=(M=y.model)===null||M===void 0?void 0:M.getData();(S=y.eventCenter)===null||S===void 0||S.emit(T["".concat(y.eventType,"_MOUSEDOWN")],{e:_,data:y.data||w}),y.startTime=new Date().getTime()}},this.handleMouseMove=function(_){var M,S;if(y.isStopPropagation&&_.stopPropagation(),!!y.isStartDragging&&(y.sumDeltaX+=_.clientX-y.startX,y.sumDeltaY+=_.clientY-y.startY,y.startX=_.clientX,y.startY=_.clientY,y.step<=1||Math.abs(y.sumDeltaX)>y.step||Math.abs(y.sumDeltaY)>y.step)){var O=y.sumDeltaX%y.step,w=y.sumDeltaY%y.step,A=y.sumDeltaX-O,C=y.sumDeltaY-w;y.sumDeltaX=O,y.sumDeltaY=w;var I=(M=y.model)===null||M===void 0?void 0:M.getData();y.isDragging||((S=y.eventCenter)===null||S===void 0||S.emit(T["".concat(y.eventType,"_DRAGSTART")],{e:_,data:y.data||I}),y.onDragStart({event:_})),y.isDragging=!0,Promise.resolve().then(function(){var L,G;y.onDragging({deltaX:A,deltaY:C,event:_}),(L=y.eventCenter)===null||L===void 0||L.emit(T["".concat(y.eventType,"_MOUSEMOVE")],{deltaX:A,deltaY:C,e:_,data:y.data||I}),(G=y.eventCenter)===null||G===void 0||G.emit(T["".concat(y.eventType,"_DRAG")],{e:_,data:y.data||I})})}},this.handleMouseUp=function(_){var M=window.document;y.isStartDragging=!1,y.isStopPropagation&&_.stopPropagation(),Promise.resolve().then(function(){var S,O,w;M.removeEventListener("mousemove",y.handleMouseMove,!1),M.removeEventListener("mouseup",y.handleMouseUp,!1);var A=(S=y.model)===null||S===void 0?void 0:S.getData();(O=y.eventCenter)===null||O===void 0||O.emit(T["".concat(y.eventType,"_MOUSEUP")],{e:_,data:y.data||A}),y.isDragging&&(y.isDragging=!1,y.onDragEnd({event:_}),(w=y.eventCenter)===null||w===void 0||w.emit(T["".concat(y.eventType,"_DROP")],{e:_,data:y.data||A}))})},this.cancelDrag=function(){var _=window==null?void 0:window.document;_.removeEventListener("mousemove",y.handleMouseMove,!1),_.removeEventListener("mouseup",y.handleMouseUp,!1),y.onDragEnd({event:void 0}),y.isDragging=!1},this.onDragStart=n,this.onDragging=i,this.onDragEnd=s,this.step=c,this.isStopPropagation=g,this.eventType=l,this.eventCenter=u,this.model=p,this.data=v}return r.prototype.setStep=function(e){this.step=e},r.prototype.setModel=function(e){this.model=e},r}(),Io=function(r){var e=r.x,t=r.y,n=r.width,o=r.height;return{x:e-n/2,y:t-o/2,x1:e+n/2,y1:t+o/2}},Bo=function(r){var e=r.startPoint,t=r.endPoint,n=(e.x+t.x)/2,o=(e.y+t.y)/2,i=Math.abs(e.x-t.x)+10,a=Math.abs(e.y-t.y)+10;return{x:n-i/2,y:o-a/2,x1:n+i/2,y1:o+a/2}},Xo=function(r){var e=r.points,t=Xt(e),n=Ee(t,8),o=n.x,i=n.y,a=n.width,s=n.height;return{x:o-a/2,y:i-s/2,x1:o+a/2,y1:i+s/2}},Yo=function(r){var e=r.path,t=Fn(e),n=Ee(t,8),o=n.x,i=n.y,a=n.width,s=n.height;return{x:o-a/2,y:i-s/2,x1:o+a/2,y1:i+s/2}},Ho=function(r){if(r.modelType===j.LINE_EDGE)return Bo(r);if(r.modelType===j.POLYLINE_EDGE)return Xo(r);if(r.modelType===j.BEZIER_EDGE)return Yo(r)},ko=function(r,e,t,n){var o=(e.y-r.y)*(n.x-t.x)-(r.x-e.x)*(t.y-n.y);if(o===0)return!1;var i=((e.x-r.x)*(n.x-t.x)*(t.y-r.y)+(e.y-r.y)*(n.x-t.x)*r.x-(n.y-t.y)*(e.x-r.x)*t.x)/o,a=-((e.y-r.y)*(n.y-t.y)*(t.x-r.x)+(e.x-r.x)*(n.y-t.y)*r.y-(n.x-t.x)*(e.y-r.y)*t.y)/o;return(i-r.x)*(i-e.x)<=0&&(a-r.y)*(a-e.y)<=0&&(i-t.x)*(i-n.x)<=0&&(a-t.y)*(a-n.y)<=0?{x:i,y:a}:!1},me=function(r,e,t){var n=r.x,o=r.y,i=e.x,a=e.y,s=t.x,d=t.y,l=(d-a)/(s-i),u=a-l*i;return n>=i&&n<=s&&o>=a&&o<=d&&Math.abs(o-l*n+u)<Number.EPSILON},xe=function(r){var e=r.start,t=r.end,n=r.offset,o=r.verticalLength,i=r.type,a={leftX:0,leftY:0,rightX:0,rightY:0},s=Math.atan((t.y-e.y)/(t.x-e.x)),d=Math.atan(n/o),l=Math.sqrt(o*o+n*n);return i==="start"?t.x>=e.x?(a.leftX=e.x+l*Math.sin(s+d),a.leftY=e.y-l*Math.cos(s+d),a.rightX=e.x-l*Math.sin(s-d),a.rightY=e.y+l*Math.cos(s-d)):(a.leftX=e.x-l*Math.sin(s+d),a.leftY=e.y+l*Math.cos(s+d),a.rightX=e.x+l*Math.sin(s-d),a.rightY=e.y-l*Math.cos(s-d)):i==="end"&&(t.x>=e.x?(a.leftX=t.x+l*Math.sin(s-d),a.leftY=t.y-l*Math.cos(s-d),a.rightX=t.x-l*Math.sin(s+d),a.rightY=t.y+l*Math.cos(s+d)):(a.leftX=t.x-l*Math.sin(s-d),a.leftY=t.y+l*Math.cos(s-d),a.rightX=t.x+l*Math.sin(s+d),a.rightY=t.y-l*Math.cos(s+d))),a},Vt=function(){return Vt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Vt.apply(this,arguments)},it=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Pt=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},zo=function(r,e){return Math.abs(r.centerX-e.centerX)*2<r.width+e.width&&Math.abs(r.centerY-e.centerY)*2<r.height+e.height},_n=function(r){var e=[],t={};return r.forEach(function(n){var o="".concat(n.x,"-").concat(n.y);n.id=o,t[o]=n}),Object.keys(t).forEach(function(n){e.push(t[n])}),e},Ge=function(r,e){return r.width===0&&r.height===0?r:{x:r.x,y:r.y,centerX:r.centerX,centerY:r.centerY,minX:r.minX-e,minY:r.minY-e,maxX:r.maxX+e,maxY:r.maxY+e,height:r.height+2*e,width:r.width+2*e}},Go=function(r,e){var t=Math.abs(r.x-e.centerX),n=Math.abs(r.y-e.centerY);return t/e.width>n/e.height?F.HORIZONTAL:F.VERTICAL},Fe=function(r,e,t){var n=Go(t,e);return n===F.HORIZONTAL?{x:t.x>r.centerX?r.maxX:r.minX,y:t.y}:{x:t.x,y:t.y>r.centerY?r.maxY:r.minY}},qn=function(r,e){var t=Math.min(r.minX,e.minX),n=Math.min(r.minY,e.minY),o=Math.max(r.maxX,e.maxX),i=Math.max(r.maxY,e.maxY);return{x:(t+o)/2,y:(n+i)/2,centerX:(t+o)/2,centerY:(n+i)/2,minX:t,minY:n,maxX:o,maxY:i,height:i-n,width:o-t}},Ee=function(r,e){r===void 0&&(r=[]);var t=[],n=[];r.forEach(function(u){t.push(u.x),n.push(u.y)});var o=Math.min.apply(Math,Pt([],it(t),!1)),i=Math.max.apply(Math,Pt([],it(t),!1)),a=Math.min.apply(Math,Pt([],it(n),!1)),s=Math.max.apply(Math,Pt([],it(n),!1)),d=i-o,l=s-a;return e&&(d+=e,l+=e),{centerX:(o+i)/2,centerY:(a+s)/2,maxX:i,maxY:s,minX:o,minY:a,x:(o+i)/2,y:(a+s)/2,height:l,width:d}},$e=function(r){var e=r.minX,t=r.minY,n=r.maxX,o=r.maxY;return[{x:e,y:t},{x:n,y:t},{x:n,y:o},{x:e,y:o}]},De=function(r,e){var t=r.x,n=r.y;return t<e.minX||t>e.maxX||n<e.minY||n>e.maxY},Fo=function(r,e){return e<r.minX||e>r.maxX?[]:[{x:e,y:r.minY},{x:e,y:r.maxY}]},$o=function(r,e){return e<r.minY||e>r.maxY?[]:[{x:r.minX,y:e},{x:r.maxX,y:e}]},Uo=function(r,e){return Pt(Pt([],it(Fo(r,e.x)),!1),it($o(r,e.y)),!1)},mn=function(r,e){return Math.abs(r.x-e.x)+Math.abs(r.y-e.y)},Wo=function(r,e){var t=-2,n=0;return e.forEach(function(o){o&&(r.x===o.x&&(n+=t),r.y===o.y&&(n+=t))}),n},Jn=function(r,e,t,n,o){return mn(r,e)+mn(r,t)+Wo(r,[e,t,n,o])},Zr=function(r,e,t,n,o){o||(o=0),r.unshift(e[n]),t[n]&&t[n]!==n&&o<=100&&Zr(r,e,t,t[n],o+1)},Zo=function(r,e){var t=r.indexOf(e);t>-1&&r.splice(t,1)},ie=function(r,e,t,n){var o=e.x-r.x,i=e.y-r.y,a=n.x-t.x,s=n.y-t.y,d=(-i*(r.x-t.x)+o*(r.y-t.y))/(-a*i+o*s),l=(a*(r.y-t.y)-s*(r.x-t.x))/(-a*i+o*s);return d>=0&&d<=1&&l>=0&&l<=1},Qn=function(r,e,t){if(t.width===0&&t.height===0)return!1;var n=it($e(t),4),o=n[0],i=n[1],a=n[2],s=n[3];return ie(r,e,o,i)||ie(r,e,o,s)||ie(r,e,i,a)||ie(r,e,a,s)},Vo=function(r,e,t,n){var o=[];return r.forEach(function(i){i!==e&&(i.x===e.x||i.y===e.y)&&!Qn(i,e,t)&&!Qn(i,e,n)&&o.push(i)}),_n(o)},Ko=function(r,e,t,n,o,i,a){var s=[],d=[e],l={},u={},f={};e.id&&(u[e.id]=0,f[e.id]=Jn(e,t,e));var c={};r.forEach(function(p){p.id&&(c[p.id]=p)});for(var h=function(){var p,v=1/0;if(d.forEach(function(_){_.id&&f[_.id]<v&&(v=f[_.id],p=_)}),p===t&&t.id){var y=[];return Zr(y,c,l,t.id),{value:y}}if(!p)return{value:[e,t]};Zo(d,p),s.push(p),Vo(r,p,n,o).forEach(function(_){if(s.indexOf(_)===-1&&(d.indexOf(_)===-1&&d.push(_),p!=null&&p.id&&(_!=null&&_.id))){var M=f[p.id]+mn(p,_);if(u[_.id]&&M>=u[_.id])return;l[_.id]=p.id,u[_.id]=M,f[_.id]=u[_.id]+Jn(_,t,e,i,a)}})};d.length;){var g=h();if(typeof g=="object")return g.value}return[e,t]},tr=function(r){return nt(r)},Vr=function(r){for(var e=1;e<r.length-1;){var t=r[e-1],n=r[e],o=r[e+1];t.x===n.x&&n.x===o.x||t.y===n.y&&n.y===o.y?r.splice(e,1):e++}return r},er=function(r,e,t,n,o){var i=tr(t),a=tr(n),s=Ge(i,o),d=Ge(a,o),l=Fe(s,i,r),u=Fe(d,a,e);if(zo(s,d)){var f=Jo(r,e,l,u);return Pt(Pt([r,l],it(f),!1),[u,e],!1)}var c=Ee([l,u]),h=qn(s,c),g=qn(d,c),p=[];p=p.concat($e(h)),p=p.concat($e(g));var v={x:(r.x+e.x)/2,y:(r.y+e.y)/2};[c,h,g].forEach(function(_){p=p.concat(Uo(_,v).filter(function(M){return De(M,s)&&De(M,d)}))}),[{x:l.x,y:u.y},{x:u.x,y:l.y}].forEach(function(_){De(_,s)&&De(_,d)&&p.push(_)}),p.unshift(l),p.push(u),p=_n(p);var y=Ko(p,l,u,i,a,r,e);return y.unshift(r),y.push(e),y.length>2&&(y=Vr(y)),_n(y)},qo=function(r){if(r.length===1){var e=it(r,1),t=e[0];return[t,t]}else{for(var n=r[0],o=r[1],i=pt(n.x,n.y,o.x,o.y),a=1;a<r.length-1;a++){var s=r[a],d=r[a+1],l=pt(s.x,s.y,d.x,d.y);l>i&&(i=l,n=s,o=d)}return[n,o]}},nr=function(r,e,t){var n=Tt(r,t),o=Tt(e,t);return n&&o},rr=function(r,e,t){var n=Tt(r,t),o=Tt(e,t),i=n&&o,a=n||o;return!i&&a},or=function(r,e,t){for(var n=void 0,o=nt(t),i=$e(o),a=0;a<i.length;a++){var s=ie(r,e,i[a],i[(a+1)%i.length]);s&&(n=[i[a],i[(a+1)%i.length]])}if(n)return ko(r,e,n[0],n[1])},Ue=function(r,e){var t=void 0;return r.x===e.x?t=F.VERTICAL:r.y===e.y&&(t=F.HORIZONTAL),t},Xt=function(r){var e=r.split(" "),t=[];return e&&e.forEach(function(n){var o=it(n.split(","),2),i=o[0],a=o[1];t.push({x:Number(i),y:Number(a)})}),t},Jo=function(r,e,t,n){var o=[],i=Ue(r,t),a=Ue(e,n);if(i===a)r.y===t.y?(o.push({x:t.x,y:(t.y+n.y)/2}),o.push({x:n.x,y:(t.y+n.y)/2})):(o.push({x:(t.x+n.x)/2,y:t.y}),o.push({x:(t.x+n.x)/2,y:n.y}));else{var s={x:t.x,y:n.y},d=me(s,r,t),l=me(s,e,n);if(d||l)s={x:n.x,y:t.y};else{var u=ir(s,r,t),f=ir(s,e,n);u&&f&&(s={x:n.x,y:t.y})}o.push(s)}return o},ir=function(r,e,t){return r.x===e.x&&r.x===t.x||r.y===e.y&&r.y===t.y},Kr=function(r){if(!r)return 0;for(var e=0,t=0;t<r.length;t++){var n=r.charCodeAt(t);r.match(/[A-Z]/)?e+=1.5:n>=1&&n<=126||n>=65376&&n<=65439?e+=1:e+=2}return e},Qo=function(r){var e=r.start,t=r.end,n;if(e.x===t.x&&e.y===t.y)n="";else{var o={start:e,end:t,offset:10,verticalLength:5},i=xe(Vt(Vt({},o),{type:"start"})),a=xe(Vt(Vt({},o),{type:"end"}));n="M".concat(i.leftX," ").concat(i.leftY,`
    L`).concat(i.rightX," ").concat(i.rightY,`
    L`).concat(a.rightX," ").concat(a.rightY,`
    L`).concat(a.leftX," ").concat(a.leftY," z")}return{d:n,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},ar=function(r){var e=r.start,t=r.end,n=r.sourceNode,o=r.targetNode,i=r.offset,a=nt(n),s=nt(o),d=Ge(a,i),l=Ge(s,i),u=Fe(d,a,e),f=Fe(l,s,t);return{sNext:u,ePre:f}},Fn=function(r){var e=r.replace(/M/g,"").replace(/C/g,",").split(","),t=be(e[0]),n=be(e[1]),o=be(e[2]),i=be(e[3]);return[t,n,o,i]},be=function(r){var e=it(r.replace(/(^\s*)/g,"").split(" "),2),t=e[0],n=e[1];return{x:+t,y:+n}},sr=function(r,e){var t=it(r,4),n=t[0],o=t[1],i=t[2],a=t[3],s=Bi(n,o,i,a,e);return[s,r[3]]},qr=function(r,e){for(var t=r.x,n=r.y,o=Xt(e),i=Number.MAX_SAFE_INTEGER,a,s=[],d=0;d<o.length;d++)s.push({start:o[d],end:o[(d+1)%o.length]});if(s.forEach(function(c){var h=c.start,g=c.end;if(h.x===g.x){var p={x:h.x,y:n},v=me(p,h,g);if(v){var y=Math.abs(h.x-t);y<i&&(i=y,a=p)}}else if(h.y===g.y){var p={x:t,y:h.y},v=me(p,h,g);if(v){var y=Math.abs(h.y-n);y<i&&(i=y,a=p)}}}),!a){var l=s[0],u=l.start,f=l.end;a={x:u.x+(f.x-u.x)/2,y:u.y+(f.y-u.y)/2}}return a},ti=function(r){return Zt(r,["id","type","sourceNodeId","sourceAnchorId","targetNodeId","targetAnchorId","pointsList","startPoint","endPoint","properties"])},dr=function(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))};function ei(r,e){return typeof e!="function"?function(t,n,o){return Object.assign({type:r.edgeType},o)}:function(t,n,o){var i=e(t,n,o);return i?typeof i=="string"?Object.assign({},o,{type:i}):Object.assign({type:i},o):{type:r.edgeType}}}var ni=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,o=0;return W(e,function(i){var a=Kr(i);o=a>o?a:o}),{width:Math.ceil(o/2)*n+n/4,height:t*(n+2)+n/4}},Gt=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Ce=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))};function te(r,e){return e*Math.round(r/e)||r}function ri(r,e,t){if(!r)return[];var n=Math.min.apply(Math,Ce([],Gt(r.map(function(p){return p[0]})),!1)),o=Math.max.apply(Math,Ce([],Gt(r.map(function(p){return p[0]})),!1)),i=Math.min.apply(Math,Ce([],Gt(r.map(function(p){return p[1]})),!1)),a=Math.max.apply(Math,Ce([],Gt(r.map(function(p){return p[1]})),!1)),s=-n,d=-i,l=r.map(function(p){var v=Gt(p,2),y=v[0],_=v[1];return[y+s,_+d]}),u=o-n,f=a-i,c=e?e/u:1,h=t?t/f:1,g=Math.min(c,h);return l.map(function(p){var v=Gt(p,2),y=v[0],_=v[1];return[y*g,_*g]})}var ln=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},un=function(r,e,t){var n=ln(r,2),o=n[0],i=n[1],a=ln(e,2),s=a[0],d=a[1],l=ln(t,2),u=l[0],f=l[1];return o>s&&o<u&&i>d&&i<f},Jr=function(r,e){var t=e.multipleSelectKey,n=!1;switch(t){case"meta":n=r.metaKey;break;case"alt":n=r.altKey;break;case"shift":n=r.shiftKey;break;case"ctrl":n=r.ctrlKey;break;default:n=!1;break}return n},$n=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}();function lr(r,e){return r instanceof J&&e instanceof J}var Qr=function(r){$n(e,r);function e(t,n,o){var i=r.call(this,3)||this;return i[0]=t,i[1]=n,i[2]=o,i.x=t,i.y=n,i.z=o,Object.setPrototypeOf(i,e.prototype),i}return e.prototype.add=function(t){if(lr(this,t))return new J(this.x+t.x,this.y+t.y);var n=this.z+t.z;return new xn((this.x+t.x)/n,(this.y+t.y)/n)},e.prototype.subtract=function(t){if(lr(this,t))return new J(this.x-t.x,this.y-t.y);var n=this.z-t.z;return n===0?new J(this.x-t.x,this.y-t.y):new xn((this.x-t.x)/n,(this.y-t.y)/n)},e}(Array),J=function(r){$n(e,r);function e(t,n,o){var i=r.call(this,t,n,o??0)||this;return Object.setPrototypeOf(i,e.prototype),i}return e.prototype.toString=function(){return"Vector"},e.prototype.dot=function(t){var n=this;return t.reduce(function(o,i,a){return o+i*n[a]})},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.getLength=function(){return Math.hypot(this.x,this.y)},e.prototype.normalize=function(){var t=this.getLength();return new e(this.x/t,this.y/t)},e.prototype.crossZ=function(t){return this.x*t.y-this.y*t.x},e.prototype.angle=function(t){var n=this.crossZ(t),o=Math.acos(this.normalize().dot(t.normalize()));return n>=0?o:-o},e}(Qr),xn=function(r){$n(e,r);function e(t,n){var o=r.call(this,t,n,1)||this;return Object.setPrototypeOf(o,e.prototype),o}return e.prototype.toString=function(){return"Point"},e}(Qr),tn=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ft=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},fn=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},en=function(r){tn(e,r);function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=r.call(this,t.length)||this;return o.fill(new Array(3)),t.forEach(function(i,a){o[a]=i}),o.columns=t[0].length,o.rows=t.length,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.getRow=function(t){return this[t]},e.prototype.getColumn=function(t){return fn([],Ft(this.map(function(n){return n[t]})),!1)},e.prototype.transpose=function(){for(var t=[],n=0;n<this.columns;n++)t.push(this.getColumn(n));return new(e.bind.apply(e,fn([void 0],Ft(t),!1)))},e.prototype.cross=function(t){var n=new Array(this.rows).fill("").map(function(){return[]});if(this.columns===t.rows)for(var o=0;o<this.rows;o++)for(var i=this.getRow(o),a=function(d){var l=t.getColumn(d);n[o][d]=i.reduce(function(u,f,c){return u+f*l[c]},0)},s=0;s<t.columns;s++)a(s);return new(e.bind.apply(e,fn([void 0],Ft(n),!1)))},e.prototype.to2D=function(){return this.map(function(t){return[t[0],t[1]]})},e.prototype.toPoints=function(){return this.map(function(t){return new xn(t[0],t[1])})},e.prototype.toString=function(){var t=Ft(this[0],2),n=t[0],o=t[1],i=Ft(this[1],2),a=i[0],s=i[1],d=Ft(this[2],2),l=d[0],u=d[1];return"matrix(".concat(n," ").concat(o," ").concat(a," ").concat(s," ").concat(l," ").concat(u,")")},e.prototype.translate=function(t,n){return this.cross(new nn(t,n))},e.prototype.rotate=function(t){return this.cross(new oi(t))},e.prototype.scale=function(t,n){return this.cross(new ii(t,n))},e}(Array),oi=function(r){tn(e,r);function e(t){var n=r.call(this,new J(+Math.cos(t).toFixed(2),+Math.sin(t).toFixed(2),0),new J(-Math.sin(t).toFixed(2),+Math.cos(t).toFixed(2),0),new J(0,0,1))||this;return Object.setPrototypeOf(n,e.prototype),n}return e.prototype.inverse=function(){return this.transpose()},e}(en),ii=function(r){tn(e,r);function e(t,n){var o=r.call(this,new J(t,0,0),new J(0,n,0),new J(0,0,1))||this;return o.sx=t,o.sy=n,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return new e(1/this.sx,1/this.sy)},e}(en),nn=function(r){tn(e,r);function e(t,n){var o=r.call(this,new J(1,0,0),new J(0,1,0),new J(t,n,1))||this;return o.tx=t,o.ty=n,Object.setPrototypeOf(o,e.prototype),o}return e.prototype.inverse=function(){return new e(-this.tx,-this.ty)},e}(en);Mo({isolateGlobalState:!0});var We=function(){return We=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},We.apply(this,arguments)},En=function(r){var e=r.anchors;return e},Ze=function(r,e){for(var t=e.nodes,n,o=t.length-1;o>=0;o--){var i=t[o],a=di(r,i);if(a){var s=i.getTargetAnchor(r);if(s){var d={node:i,anchorIndex:s.index,anchor:s.anchor};(!n||ai(i,n.node,e))&&(n=d)}}}return n},ai=function(r,e,t){return r.zIndex>e.zIndex?!0:t.nodesMap[r.id].index>t.nodesMap[e.id].index},si=function(r,e){for(var t=En(e),n,o=Number.MAX_SAFE_INTEGER,i=0;i<t.length;i++){var a=pt(r.x,r.y,t[i].x,t[i].y);a<o&&(o=a,n={index:i,anchor:We(We({},t[i]),{x:t[i].x,y:t[i].y,id:t[i].id})})}return n},pt=function(r,e,t,n){return Math.hypot(r-t,e-n)},Tt=function(r,e){var t=!1,n=0,o=nt(e);return r.x>=o.minX-n&&r.x<=o.maxX+n&&r.y>=o.minY-n&&r.y<=o.maxY+n&&(t=!0),t},di=function(r,e){var t=!1,n=5,o=nt(e);return r.x>=o.minX-n&&r.x<=o.maxX+n&&r.y>=o.minY-n&&r.y<=o.maxY+n&&(t=!0),t},nt=function(r){var e=r.x,t=r.y,n=r.width,o=r.height;return{minX:e-n/2,minY:t-o/2,maxX:e+n/2,maxY:t+o/2,x:e,y:t,width:n,height:o,centerX:e,centerY:t}},li=function(r){var e=r,t=e.x,n=e.y,o=e.width,i=e.height,a=e.radius;return[{x:t-o/2+a,y:n-i/2+a,r:a},{x:t+o/2-a,y:n-i/2+a,r:a},{x:t-o/2+a,y:n+i/2-a,r:a},{x:t+o/2-a,y:n+i/2-a,r:a}]},ur=function(r,e,t){var n=li(t),o,i=Number.MAX_SAFE_INTEGER;return n.forEach(function(a){var s=pt(r.x,r.y,a.x,a.y);s<i&&(i=s,o=a)}),Mn(r,e,o)},Mn=function(r,e,t){var n,o=t.x,i=t.y,a=t.r;if(e===F.HORIZONTAL){var s=o-Math.sqrt(a*a-(r.y-i)*(r.y-i)),d=o+Math.sqrt(a*a-(r.y-i)*(r.y-i)),l=Math.abs(s-r.x)<Math.abs(d-r.x)?s:d;n={x:l,y:r.y}}else if(e===F.VERTICAL){var u=i-Math.sqrt(a*a-(r.x-o)*(r.x-o)),f=i+Math.sqrt(a*a-(r.x-o)*(r.x-o)),c=Math.abs(u-r.y)<Math.abs(f-r.y)?u:f;n={x:r.x,y:c}}return n},fr=function(r,e){var t=e,n=!1,o=t.x,i=t.y,a=t.width,s=t.height,d=t.radius,l={minX:o-a/2+d,maxX:o+a/2-d,minY:i-s/2+d,maxY:i+s/2-d};return r.y===i+s/2||r.y===i-s/2?n=r.x>l.minX&&r.x<l.maxX:(r.x===o+a/2||r.x===o-a/2)&&(n=r.y>l.minY&&r.y<l.maxY),n},cr=function(r,e,t){var n,o=t,i=o.x,a=o.y,s=o.rx,d=o.ry;if(e===F.HORIZONTAL){var l=i-Math.sqrt(s*s-(r.y-a)*(r.y-a)*s*s/(d*d)),u=i+Math.sqrt(s*s-(r.y-a)*(r.y-a)*s*s/(d*d)),f=Math.abs(l-r.x)<Math.abs(u-r.x)?l:u;n={x:f,y:r.y}}else if(e===F.VERTICAL){var c=a-Math.sqrt(d*d-(r.x-i)*(r.x-i)*d*d/(s*s)),h=a+Math.sqrt(d*d-(r.x-i)*(r.x-i)*d*d/(s*s)),g=Math.abs(c-r.y)<Math.abs(h-r.y)?c:h;n={x:r.x,y:g}}return n},Le=function(r,e,t){for(var n=t.pointsPosition,o=Number.MAX_SAFE_INTEGER,i,a=[],s=0;s<n.length;s++)a.push({start:n[s],end:n[(s+1)%n.length]});return a.forEach(function(d){var l=d.start,u=d.end,f=l,c=u;l.x>u.x&&(f=u,c=l);var h={x:r.x,y:r.y};if(f.x===c.x&&e===F.HORIZONTAL&&(h={x:f.x,y:r.y}),f.y===c.y&&e===F.VERTICAL&&(h={x:r.x,y:f.y}),f.x!==c.x&&f.y!==c.y){var g=(c.y-f.y)/(c.x-f.x),p=(f.x*c.y-c.x*f.y)/(f.x-c.x);e===F.HORIZONTAL?h={x:(r.y-p)/g,y:r.y}:e===F.VERTICAL&&(h={x:r.x,y:g*r.x+p})}var v=me(h,l,u);if(v){var y=pt(h.x,h.y,r.x,r.y);y<o&&(o=y,i=h)}}),i},ui=function(r){var e=Zt(r,["id","type","x","y","text","label","properties","virtual","rotate","resizable","rotatable"]);return e},pr=function(r,e,t,n){var o=r.x,i=r.y;return e.x>r.x?o=r.x+t/2:e.x<r.x&&(o=r.x-t/2),e.y>r.y?i=r.y+n/2:e.y<r.y&&(i=r.y-n/2),{x:o,y:i}},to=function(r){var e=r.rows,t=r.style,n=r.rowsLength,o=r.className,i=document.createElement("div");i.className=o,i.style.fontSize="".concat(t.fontSize),i.style.width="".concat(t.width),i.style.lineHeight="".concat(t.lineHeight),i.style.padding="".concat(t.padding),t.fontFamily&&(i.style.fontFamily="".concat(t.fontFamily)),n>1?e.forEach(function(s){var d=document.createElement("div");d.textContent=s,i.appendChild(d)}):i.textContent=e[0],document.body.appendChild(i);var a=i.clientHeight;return document.body.removeChild(i),a},hr=function(r){var e=r.rows,t=r.rowsLength,n=r.fontSize,o=0;return e&&e.forEach(function(i){var a=Kr(i);o=a>o?a:o}),{width:Math.ceil(o/2)*n+n/4,height:t*(n+2)+n/4}},Ve=function(r){return typeof r!="object"?{isAllPass:!!r,msg:r?"":"不允许连接"}:r},It=function(){return wo()},se=new Map,eo=function(r){var e=It();function t(){r();var o=se.get(e);if(o){var i=window.requestAnimationFrame(t);se.set(e,i)}}var n=window.requestAnimationFrame(t);return se.set(e,n),e},Ke=function(r){var e=se.get(r);e&&(window.cancelAnimationFrame(e),se.delete(r))},Me=function(){return Me=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Me.apply(this,arguments)},fi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function no(r){var e=r.x,t=e===void 0?0:e,n=r.y,o=n===void 0?0:n,i=r.value,a=r.fontSize,s=a===void 0?12:a,d=r.fill,l=d===void 0?"currentColor":d,u=r.overflowMode,f=u===void 0?"default":u,c=r.textWidth,h=c===void 0?void 0:c,g=r.model,p={x:t,y:o,fill:l,fontSize:s,textAnchor:"middle",dominantBaseline:"central"};if(W(Nt(r),function(O){var w=fi(O,2),A=w[0],C=w[1];typeof C!="object"&&(p[A]=C)}),i){var v=String(i).split(/[\r\n]/g),y=v.length;if(f!=="default"){var _=g.BaseType,M=g.modelType;if(_===U.NODE&&M!==j.TEXT_NODE||_===U.EDGE&&h)return ci(r)}if(y>1){var S=v.map(function(O,w){var A=s+2,C=(w-(y-1)/2)*A;return x("tspan",{className:"lf-text-tspan",x:t,y:o+C,children:O})});return x("text",Me({},p,{children:S}))}return x("text",Me({},p,{children:i}))}return null}function ci(r){var e=r.x,t=r.y,n=r.value,o=r.model,i=r.textWidth,a=r.fontSize,s=a===void 0?12:a,d=r.lineHeight,l=r.fontFamily,u=l===void 0?"":l,f=r.wrapPadding,c=f===void 0?"0, 0":f,h=r.overflowMode,g=o.width,p=o.height,v=o.textHeight,y=i||g,_=String(n).split(/[\r\n]/g),M=_.length,S=to({rows:_,style:{fontSize:"".concat(s,"px"),width:"".concat(y,"px"),fontFamily:u,lineHeight:d,padding:c},rowsLength:M,className:"lf-get-text-height"}),O=p>S?p:S;v&&(O=v);var w=h==="ellipsis";return w&&(O=s+2),x("g",{children:x("foreignObject",{width:y,height:O,x:e-y/2,y:t-O/2,style:{overflow:"visible",textAlign:"left"},children:x("div",{className:"lf-node-text-auto-wrap",style:{minHeight:O,width:y,padding:c},children:x("div",{className:w?"lf-node-text-ellipsis-content":"lf-node-text-auto-wrap-content",title:w?_.join(""):"",style:Me({},r),children:_.map(function(A){return x("div",{className:"lf-node-text--auto-wrap-inner",children:A})})})})})})}var On=function(){return On=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},On.apply(this,arguments)},pi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function ee(r){var e={x1:10,y1:10,x2:20,y2:20,stroke:"black"};return W(Nt(r),function(t){var n=pi(t,2),o=n[0],i=n[1];(o==="style"||typeof i!="object")&&(e[o]=i)}),x("line",On({},e))}var Sn=function(){return Sn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Sn.apply(this,arguments)},hi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function mt(r){var e=r.x,t=r.y,n=r.width,o=r.height,i=r.className,a=r.strokeWidth,s=r.radius,d=s===void 0?0:s,l=e-n/2,u=t-o/2,f={};return f["stroke-width"]=a,W(Nt(r),function(c){var h=hi(c,2),g=h[0],p=h[1];typeof p!="object"&&(f[g]=p)}),i?f.className="lf-basic-shape ".concat(i):f.className="lf-basic-shape",d&&(f.rx=d,f.ry=d),f.x=l,f.y=u,x("rect",Sn({},f))}var wn=function(){return wn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},wn.apply(this,arguments)},yi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function Oe(r){var e={d:""};return W(Nt(r),function(t){var n=yi(t,2),o=n[0],i=n[1];(o==="style"||typeof i!="object")&&(e[o]=i)}),x("path",wn({},e))}var An=function(){return An=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},An.apply(this,arguments)},gi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function ne(r){var e=r.x,t=e===void 0?0:e,n=r.y,o=n===void 0?0:n,i=r.r,a=i===void 0?4:i,s=r.className,d={cx:t,cy:o,r:a,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return W(Nt(r),function(l){var u=gi(l,2),f=u[0],c=u[1];typeof c!="object"&&(d[f]=c)}),s?d.className="lf-basic-shape ".concat(s):d.className="lf-basic-shape",x("circle",An({},d))}var Pn=function(){return Pn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Pn.apply(this,arguments)},vi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function _i(r){var e=r.x,t=e===void 0?0:e,n=r.y,o=n===void 0?0:n,i=r.rx,a=i===void 0?4:i,s=r.ry,d=s===void 0?4:s,l=r.className,u={cx:t,cy:o,rx:a,ry:d,fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1};return W(Nt(r),function(f){var c=vi(f,2),h=c[0],g=c[1];typeof g!="object"&&(u[h]=g)}),l?u.className="lf-basic-shape ".concat(l):u.className="lf-basic-shape",x("ellipse",Pn({},u))}var Tn=function(){return Tn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Tn.apply(this,arguments)},mi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function ro(r){var e=r.points,t=e===void 0?[]:e,n=r.className,o={fill:"transparent",fillOpacity:1,strokeWidth:1,stroke:"#000",strokeOpacity:1,points:""};return W(Nt(r),function(i){var a=mi(i,2),s=a[0],d=a[1];typeof d!="object"&&(o[s]=d)}),n?o.classNmae="lf-basic-shape ".concat(n):o.className="lf-basic-shape",o.points=t.map(function(i){return i.join(",")}).join(" "),x("polygon",Tn({},o))}var Nn=function(){return Nn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Nn.apply(this,arguments)},xi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i};function Ei(r){var e=r.className,t={points:"",fill:"none"};return W(Nt(r),function(n){var o=xi(n,2),i=o[0],a=o[1];(i==="style"||typeof a!="object")&&(t[i]=a)}),e&&(t.className="".concat(e)),x("polyline",Nn({},t))}var oo=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Se=function(){return Se=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Se.apply(this,arguments)},Mi=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},Oi=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},k;(function(r){r[r.LEFT_TOP=0]="LEFT_TOP",r[r.RIGHT_TOP=1]="RIGHT_TOP",r[r.RIGHT_BOTTOM=2]="RIGHT_BOTTOM",r[r.LEFT_BOTTOM=3]="LEFT_BOTTOM"})(k||(k={}));var Si=function(r){oo(e,r);function e(t){var n=r.call(this)||this;n.updateEdgePointByAnchors=function(){var s=n.nodeModel,d=s.id,l=s.anchors,u=n.graphModel.getNodeEdges(d);W(u,function(f){if(f.sourceNodeId===d){var c=Bt(l,function(h){return h.id===f.sourceAnchorId});c&&f.updateStartPoint({x:c.x,y:c.y})}else if(f.targetNodeId===d){var c=Bt(l,function(g){return g.id===f.targetAnchorId});c&&f.updateEndPoint({x:c.x,y:c.y})}})},n.triggerResizeEvent=function(s,d,l,u,f,c){n.graphModel.eventCenter.emit(T.NODE_RESIZE,{preData:s,data:d,deltaX:l,deltaY:u,index:f,model:c})},n.recalcResizeInfo=function(s,d,l,u,f){l===void 0&&(l=1),u===void 0&&(u=!1),f===void 0&&(f=!1);var c=b(d),h=c.deltaX,g=c.deltaY,p=c.width,v=c.height,y=c.PCTResizeInfo;if(y){var _=4,M=0,S=0;switch(s){case k.LEFT_TOP:S=(h*-1-g)/_;break;case k.RIGHT_TOP:S=(h-g)/_;break;case k.RIGHT_BOTTOM:S=(h+g)/_;break;case k.LEFT_BOTTOM:S=(h*-1+g)/_;break}S!==0&&(M=Math.round(S/y.ResizeBasis.basisHeight*1e5)/1e3),y.ResizePCT.widthPCT=Math.max(Math.min(y.ResizePCT.widthPCT+M,y.ScaleLimit.maxScaleLimit),y.ScaleLimit.minScaleLimit),y.ResizePCT.heightPCT=Math.max(Math.min(y.ResizePCT.heightPCT+M,y.ScaleLimit.maxScaleLimit),y.ScaleLimit.minScaleLimit);var O=Math.round(y.ResizePCT.widthPCT*y.ResizeBasis.basisWidth/100),w=Math.round(y.ResizePCT.heightPCT*y.ResizeBasis.basisHeight/100);switch(s){case k.LEFT_TOP:h=p-O,g=v-w;break;case k.RIGHT_TOP:h=O-p,g=v-w;break;case k.RIGHT_BOTTOM:h=O-p,g=w-v;break;case k.LEFT_BOTTOM:h=p-O,g=w-v;break}return c}switch(s){case k.LEFT_TOP:c.width=u?p:p-h*l,c.height=f?v:v-g*l;break;case k.RIGHT_TOP:c.width=u?p:p+h*l,c.height=f?v:v-g*l;break;case k.RIGHT_BOTTOM:c.width=u?p:p+h*l,c.height=f?v:v+g*l;break;case k.LEFT_BOTTOM:c.width=u?p:p-h*l,c.height=f?v:v+g*l;break}return c},n.resizeNode=function(s){var d=s.deltaX,l=s.deltaY,u=n.index,f=n.props,c=f.model,h=f.graphModel,g=f.x,p=f.y;Li({x:g,y:p,deltaX:d,deltaY:l,index:u,nodeModel:c,graphModel:h,cancelCallback:function(){n.dragHandler.cancelDrag()}})},n.onDragging=function(s){var d=s.deltaX,l=s.deltaY,u=n.graphModel.transformModel,f=Oi(u.fixDeltaXY(d,l),2),c=f[0],h=f[1];n.resizeNode({deltaX:c,deltaY:h})},n.onDragEnd=function(){var s=n.nodeModel.x,d=n.nodeModel.y;n.nodeModel.moveTo(s,d),n.updateEdgePointByAnchors()};var o=t.index,i=t.model,a=t.graphModel;return n.index=o,n.nodeModel=i,n.graphModel=a,n.dragHandler=new xt({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:a.gridSize}),n}return e.prototype.componentWillUnmount=function(){this.dragHandler.cancelDrag()},e.prototype.render=function(){var t=this.props,n=t.x,o=t.y,i=t.direction,a=t.model,s=a.getResizeControlStyle(),d=s.width,l=s.height,u=Mi(s,["width","height"]);return x("g",{className:"lf-resize-control lf-resize-control-".concat(i),children:[x(mt,Se({className:"lf-resize-control-content",x:n,y:o,width:d??7,height:l??7},u)),x(mt,{className:"lf-resize-control-content",x:n,y:o,width:25,height:25,fill:"transparent",stroke:"transparent",onMouseDown:this.dragHandler.handleMouseDown})]})},e}(V),wi=function(r){oo(e,r);function e(){return r.call(this)||this}return e.prototype.getResizeControl=function(){var t=this.props,n=t.model,o=t.graphModel,i=nt(n),a=i.minX,s=i.minY,d=i.maxX,l=i.maxY,u=[{index:k.LEFT_TOP,direction:"nw",x:a,y:s},{index:k.RIGHT_TOP,direction:"ne",x:d,y:s},{index:k.RIGHT_BOTTOM,direction:"se",x:d,y:l},{index:k.LEFT_BOTTOM,direction:"sw",x:a,y:l}];return Ot(u,function(f){return x(Si,Se({},f,{model:n,graphModel:o}))})},e.prototype.getResizeOutline=function(){var t=this.props.model,n=t.x,o=t.y,i=t.width,a=t.height,s=t.getResizeOutlineStyle();return x(mt,Se({},s,{x:n,y:o,width:i,height:a}))},e.prototype.render=function(){return x("g",{className:"lf-resize-control-group",children:[this.getResizeOutline(),this.getResizeControl()]})},e}(V);function Ai(r,e){var t=r.x,n=r.y,o=e.x,i=e.y,a={x:t+(o-t)/2,y:n+(i-n)/2};return a}function ae(r,e,t){var n=Pi(t),o=r.x-e.x,i=r.y-e.y,a=o*Math.cos(n)-i*Math.sin(n)+e.x,s=o*Math.sin(n)+i*Math.cos(n)+e.y;return{x:a,y:s}}function Pi(r){return r*Math.PI/180}function Ti(r){return r/Math.PI*180}function Ni(r,e,t,n,o,i,a,s,d){s===void 0&&(s=!1),d===void 0&&(d=!1);var l=e.deltaX,u=e.deltaY,f=e.width,c=e.height,h=Ti(t),g={x:n,y:o},p={x:i,y:a},v=ae(g,p,h),y={x:v.x+l,y:v.y+u},_=ji(v,y,p,h,s,d,f,c),M=_.width,S=_.height,O=_.center;return e.width=M*r,e.height=S*r,e.deltaX=(O.x-p.x)*2,e.deltaY=(O.y-p.y)*2,e}var Di=function(r,e,t,n,o,i,a,s,d,l){t===void 0&&(t=1),n===void 0&&(n=!1),o===void 0&&(o=!1),i===void 0&&(i=0);var u=b(e),f=u.deltaX,c=u.deltaY,h=u.width,g=u.height,p=u.PCTResizeInfo;if(p){var v=4,y=0,_=0;switch(r){case k.LEFT_TOP:_=(f*-1-c)/v;break;case k.RIGHT_TOP:_=(f-c)/v;break;case k.RIGHT_BOTTOM:_=(f+c)/v;break;case k.LEFT_BOTTOM:_=(f*-1+c)/v;break}_!==0&&(y=Math.round(_/p.ResizeBasis.basisHeight*1e5)/1e3),p.ResizePCT.widthPCT=Math.max(Math.min(p.ResizePCT.widthPCT+y,p.ScaleLimit.maxScaleLimit),p.ScaleLimit.minScaleLimit),p.ResizePCT.heightPCT=Math.max(Math.min(p.ResizePCT.heightPCT+y,p.ScaleLimit.maxScaleLimit),p.ScaleLimit.minScaleLimit);var M=Math.round(p.ResizePCT.widthPCT*p.ResizeBasis.basisWidth/100),S=Math.round(p.ResizePCT.heightPCT*p.ResizeBasis.basisHeight/100);switch(r){case k.LEFT_TOP:f=h-M,c=g-S;break;case k.RIGHT_TOP:f=M-h,c=g-S;break;case k.RIGHT_BOTTOM:f=M-h,c=S-g;break;case k.LEFT_BOTTOM:f=h-M,c=S-g;break}return u}if(i%(2*Math.PI)!==0&&a!==void 0&&s!==void 0)return Ni(t,u,i,a,s,d,l,n,o);switch(r){case k.LEFT_TOP:u.width=n?h:h-f*t,u.height=o?g:g-c*t;break;case k.RIGHT_TOP:u.width=n?h:h+f*t,u.height=o?g:g-c*t;break;case k.RIGHT_BOTTOM:u.width=n?h:h+f*t,u.height=o?g:g+c*t;break;case k.LEFT_BOTTOM:u.width=n?h:h-f*t,u.height=o?g:g+c*t;break}return u},bi=function(r,e){var t=r.id,n=r.anchors,o=e.getNodeEdges(t);W(o,function(i){if(i.sourceNodeId===t){var a=Bt(n,function(s){return s.id===i.sourceAnchorId});a&&i.updateStartPoint({x:a.x,y:a.y})}else if(i.targetNodeId===t){var a=Bt(n,function(d){return d.id===i.targetAnchorId});a&&i.updateEndPoint({x:a.x,y:a.y})}})},Ci=function(r,e,t,n,o,i,a){a.eventCenter.emit(T.NODE_RESIZE,{preData:r,data:e,deltaX:t,deltaY:n,index:o,model:i})},Li=function(r){var e=r.x,t=r.y,n=r.deltaX,o=r.deltaY,i=r.index,a=r.nodeModel,s=r.graphModel,d=r.cancelCallback,l=a.r,u=a.rx,f=a.ry,c=a.width,h=a.height,g=a.PCTResizeInfo,p=a.minWidth,v=a.minHeight,y=a.maxWidth,_=a.maxHeight,M=a.rotate,S=a.x,O=a.y,w=p===y,A=v===_,C={width:l||u||c,height:l||f||h,deltaX:n,deltaY:o,PCTResizeInfo:g},I=l||u&&f?1/2:1,L=e,G=t,R=Di(i,C,I,w,A,M,L,G,S,O);if(R.width<p||R.width>y||R.height<v||R.height>_){d==null||d();return}(M%(2*Math.PI)==0||g||L===void 0||G===void 0)&&(R.deltaX=w?0:R.deltaX,R.deltaY=A?0:R.deltaY);var Y=a.getData(),H=a.resize(R);Y.x===H.x&&Y.y===H.y||(bi(a,s),Ci(Y,H,n,o,i,a,s))};function ji(r,e,t,n,o,i,a,s){o===void 0&&(o=!1),i===void 0&&(i=!1);var d={x:t.x-(r.x-t.x),y:t.y-(r.y-t.y)},l=Ai(d,e),u=ae(e,l,-n),f=ae(d,l,-n);if(o){var c=Math.abs(u.x-f.x),h=c-a;l.x>u.x?l.x=l.x+h/2:l.x=l.x-h/2}if(i){var g=Math.abs(u.y-f.y),p=g-s;l.y>u.y?l.y=l.y+p/2:l.y=l.y-p/2}if(o||i){var v=ae(f,l,n),y=v.x-d.x,_=v.y-d.y;l.x=l.x-y,l.y=l.y-_,f=ae(d,l,-n),u={x:l.x-(f.x-l.x),y:l.y-(f.y-l.y)}}var M=Math.abs(u.x-f.x),S=Math.abs(u.y-f.y);return o&&(M=a),i&&(S=s),{width:M,height:S,center:l}}var Ri=100,Ii={x:1,y:0,z:0};function Bi(r,e,t,n,o){for(var i=function(h){if(h<0||h>1)throw new RangeError('The value range of parameter "t" is [0,1]');return{x:r.x*Math.pow(1-h,3)+3*e.x*h*Math.pow(1-h,2)+3*t.x*Math.pow(h,2)*(1-h)+n.x*Math.pow(h,3),y:r.y*Math.pow(1-h,3)+3*e.y*h*Math.pow(1-h,2)+3*t.y*Math.pow(h,2)*(1-h)+n.y*Math.pow(h,3)}},a=0,s=2,d=n.x,l=n.y,u=n;a<o&&s<50;){u=i(1-s/Ri);var f=u.x,c=u.y;a=pt(d,l,f,c),s++}return u}function Xi(r,e){return r.x*e.y-r.y*e.x}function Yi(r,e){var t=[r.x,r.y,r.z],n=[e.x,e.y,e.z];return n.reduce(function(o,i,a){return o+i*t[a]})}function Hi(r,e){var t=Xi(r,e),n=Math.acos(Yi(yr(r),yr(e)));return t>=0?n:-n}function yr(r){var e=Math.hypot(r.x,r.y);return{x:r.x/e,y:r.y/e,z:0}}function ki(r){return Hi(Ii,r)}function zi(r){return r*(180/Math.PI)}var Gi={baseNode:{fill:"#fff",stroke:"#000",strokeWidth:2},baseEdge:{stroke:"#000",strokeWidth:2},rect:{},circle:{},diamond:{},ellipse:{},polygon:{},text:{color:"#000",stroke:"none",fontSize:12,background:{fill:"transparent"}},anchor:{stroke:"#000",fill:"#fff",r:4,hover:{r:10,fill:"#949494",fillOpacity:.5,stroke:"#949494"}},anchorLine:{stroke:"#000",strokeWidth:2,strokeDasharray:"3,2"},nodeText:{color:"#000",overflowMode:"default",fontSize:12,lineHeight:1.2},edgeText:{textWidth:100,overflowMode:"default",fontSize:12,background:{fill:"#fff"}},line:{},polyline:{},bezier:{fill:"none",adjustLine:{stroke:"#949494"},adjustAnchor:{r:4,fill:"#949494",fillOpacity:1,stroke:"#949494"}},arrow:{offset:10,verticalLength:5},snapline:{stroke:"#949494",strokeWidth:1},edgeAdjust:{r:4,fill:"#fff",stroke:"#949494",strokeWidth:2},outline:{fill:"transparent",stroke:"#949494",strokeDasharray:"3,3",hover:{stroke:"#949494"}},edgeAnimation:{stroke:"red",strokeDasharray:"10,10",strokeDashoffset:"100%",animationName:"lf_animate_dash",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationDirection:"normal"},rotateControl:{stroke:"#000",fill:"#fff",strokeWidth:1.5},resizeControl:{width:7,height:7,fill:"#fff",stroke:"#000"},resizeOutline:{fill:"none",stroke:"transparent",strokeWidth:1,strokeDasharray:"3,3"}},io=function(r){var e=b(Gi);return r&&(e=Fr(e,r)),e},Fi=io,$i=1e3,Ui=999,Un=function(){return++$i},Wi=function(){return--Ui},Z=function(){return Z=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Z.apply(this,arguments)},N=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},rn=function(){function r(e,t){var n;this.BaseType=U.EDGE,this.id="",this.type="",this.sourceNodeId="",this.targetNodeId="",this.textMode=ht.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this.points="",this.pointsList=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.isAnimation=!1,this.isShowAdjustPoint=!1,this.zIndex=0,this.state=B.DEFAULT,this.modelType=j.EDGE,this.customTextPosition=!1,this.style={},this.arrowConfig={markerEnd:"url(#marker-end-".concat(this.id,")"),markerStart:"url(#marker-start-".concat(this.id,")")},this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initEdgeData(e),this.setAttributes()}return r.prototype.initEdgeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),o=this.createId();e.id=o||n||It()}this.arrowConfig.markerEnd="url(#marker-end-".concat(e.id,")"),this.arrowConfig.markerStart="url(#marker-start-".concat(e.id,")");var i=this.graphModel.editConfigModel.adjustEdgeStartAndEnd;this.isShowAdjustPoint=i,z(this,ti(e));var a=this.graphModel.overlapMode;a===ct.INCREASE&&(this.zIndex=e.zIndex||Un()),this.setAnchors(),this.initPoints(),this.formatText(e)},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.getEdgeStyle=function(){return Z(Z({},this.graphModel.theme.baseEdge),this.style)},r.prototype.getAdjustPointStyle=function(){return Z({},this.graphModel.theme.edgeAdjust)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.edgeText;return b(e)},r.prototype.getEdgeAnimationStyle=function(){var e=this.graphModel.theme.edgeAnimation;return b(e)},r.prototype.getArrowStyle=function(){var e=this.getEdgeStyle(),t=this.getEdgeAnimationStyle(),n=this.graphModel.theme.arrow,o=this.isAnimation?t.stroke:e.stroke;return Z(Z(Z({},e),{fill:o,stroke:o}),n)},r.prototype.getOutlineStyle=function(){var e=this.graphModel,t=e.theme.outline;return b(t)},r.prototype.getTextPosition=function(){return{x:0,y:0}},Object.defineProperty(r.prototype,"sourceNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.sourceNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"targetNode",{get:function(){var e,t;return(t=(e=this.graphModel)===null||e===void 0?void 0:e.nodesMap[this.targetNodeId])===null||t===void 0?void 0:t.model},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textPosition",{get:function(){return this.getTextPosition()},enumerable:!1,configurable:!0}),r.prototype.getBeginAnchor=function(e,t,n){var o,i,a=En(e);if(n){if(o=Bt(a,function(s){return s.id===n}),o)return o;console.warn("未在节点上找到指定的起点锚点".concat(n,"，已使用默认锚点作为起点"))}return a.forEach(function(s){var d=dr(s,t);(i===void 0||d<i)&&(i=d,o=s)}),o},r.prototype.getEndAnchor=function(e,t){var n=this,o,i,a=En(e);if(t){if(o=Bt(a,function(s){return s.id===t}),o)return o;console.warn("未在节点上找到指定的终点锚点".concat(t,"，已使用默认锚点作为终点"))}return a.forEach(function(s){if(n.startPoint){var d=dr(s,n.startPoint);(i===void 0||d<i)&&(i=d,o=s)}}),o},r.prototype.getProperties=function(){return vt(this.properties)},r.prototype.getData=function(){var e=this.properties;Wr(e)&&(e=vt(e));var t={id:this.id,type:this.type,properties:e,sourceNodeId:this.sourceNodeId,targetNodeId:this.targetNodeId,startPoint:z({},this.startPoint),endPoint:z({},this.endPoint)};this.graphModel.overlapMode===ct.INCREASE&&(t.zIndex=this.zIndex);var n=this.text,o=n.x,i=n.y,a=n.value;return a&&(t.text={x:o,y:i,value:a}),t},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.setProperty=function(e,t){Oo(this.properties,e,tt(t)),this.setAttributes()},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setProperties=function(e){this.properties=Z(Z({},vt(this.properties)),tt(e)),this.setAttributes()},r.prototype.changeEdgeId=function(e){var t=this.arrowConfig,n=t.markerEnd,o=t.markerStart;o&&o==="url(#marker-start-".concat(this.id,")")&&(this.arrowConfig.markerStart="url(#marker-start-".concat(e,")")),n&&n==="url(#marker-end-".concat(this.id,")")&&(this.arrowConfig.markerEnd="url(#marker-end-".concat(e,")")),this.id=e},r.prototype.setStyle=function(e,t){var n;this.style=Z(Z({},this.style),(n={},n[e]=tt(t),n))},r.prototype.setStyles=function(e){this.style=Z(Z({},this.style),tt(e))},r.prototype.updateStyles=function(e){this.style=Z({},tt(e))},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,o,i=this.textPosition,a=i.x,s=i.y,d=e.text,l={value:"",x:a,y:s,draggable:!1,editable:!0};d&&(typeof d=="string"?l=Z(Z({},l),{value:d}):(l=Z(Z({},l),{x:(t=d.x)!==null&&t!==void 0?t:a,y:(n=d.y)!==null&&n!==void 0?n:s,value:(o=d.value)!==null&&o!==void 0?o:""}),Qt(d.draggable)||(l.draggable=d.draggable),Qt(d.editable)||(l.editable=d.editable))),this.text=l},r.prototype.resetTextPosition=function(){var e=this.textPosition,t=e.x,n=e.y;this.text.x=t,this.text.y=n},r.prototype.moveText=function(e,t){var n=this.text,o=n.x,i=n.y,a=n.value,s=n.draggable,d=n.editable;this.text={value:a,editable:d,draggable:s,x:o+e,y:i+t}},r.prototype.setText=function(e){e&&z(this.text,e)},r.prototype.updateText=function(e){this.text=Z(Z({},vt(this.text)),{value:e})},r.prototype.setAnchors=function(){if(!this.sourceAnchorId||!this.startPoint){var e=this.getBeginAnchor(this.sourceNode,this.targetNode,this.sourceAnchorId);if(!e)throw new Error("无法获取beginAnchor，请检查anchors相关逻辑，anchors不能为空");this.startPoint||(this.startPoint={x:e.x,y:e.y}),this.sourceAnchorId||(this.sourceAnchorId=e.id)}if(!this.targetAnchorId||!this.endPoint){var e=this.getEndAnchor(this.targetNode,this.targetAnchorId);if(!e)throw new Error("无法获取endAnchor，请检查anchors相关逻辑，anchors不能为空");this.endPoint||(this.endPoint={x:e.x,y:e.y}),this.targetAnchorId||(this.targetAnchorId=e.id)}},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.openEdgeAnimation=function(){this.isAnimation=!0},r.prototype.closeEdgeAnimation=function(){this.isAnimation=!1},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateStartPoint=function(e){this.startPoint=e},r.prototype.moveStartPoint=function(e,t){this.startPoint&&(this.startPoint.x+=e,this.startPoint.y+=t)},r.prototype.updateEndPoint=function(e){this.endPoint=e},r.prototype.moveEndPoint=function(e,t){this.endPoint&&(this.endPoint.x+=e,this.endPoint.y+=t)},r.prototype.setZIndex=function(e){e===void 0&&(e=0),this.zIndex=e},r.prototype.initPoints=function(){},r.prototype.updateAttributes=function(e){z(this,e)},r.prototype.getAdjustStart=function(){return this.startPoint},r.prototype.getAdjustEnd=function(){return this.endPoint},r.prototype.updateAfterAdjustStartAndEnd=function(e){var t=e.startPoint,n=e.endPoint;this.updateStartPoint({x:t.x,y:t.y}),this.updateEndPoint({x:n.x,y:n.y})},r.BaseType=U.EDGE,N([E],r.prototype,"type",void 0),N([E],r.prototype,"sourceNodeId",void 0),N([E],r.prototype,"targetNodeId",void 0),N([E],r.prototype,"startPoint",void 0),N([E],r.prototype,"endPoint",void 0),N([E],r.prototype,"textMode",void 0),N([E],r.prototype,"text",void 0),N([E],r.prototype,"properties",void 0),N([E],r.prototype,"points",void 0),N([E],r.prototype,"pointsList",void 0),N([E],r.prototype,"isSelected",void 0),N([E],r.prototype,"isHovered",void 0),N([E],r.prototype,"isHitable",void 0),N([E],r.prototype,"isHittable",void 0),N([E],r.prototype,"draggable",void 0),N([E],r.prototype,"visible",void 0),N([E],r.prototype,"isAnimation",void 0),N([E],r.prototype,"isShowAdjustPoint",void 0),N([E],r.prototype,"zIndex",void 0),N([E],r.prototype,"state",void 0),N([E],r.prototype,"style",void 0),N([E],r.prototype,"arrowConfig",void 0),N([$],r.prototype,"sourceNode",null),N([$],r.prototype,"targetNode",null),N([$],r.prototype,"textPosition",null),N([m],r.prototype,"setProperty",null),N([m],r.prototype,"deleteProperty",null),N([m],r.prototype,"setProperties",null),N([m],r.prototype,"changeEdgeId",null),N([m],r.prototype,"setStyle",null),N([m],r.prototype,"setStyles",null),N([m],r.prototype,"updateStyles",null),N([m],r.prototype,"setTextMode",null),N([m],r.prototype,"formatText",null),N([m],r.prototype,"resetTextPosition",null),N([m],r.prototype,"moveText",null),N([m],r.prototype,"setText",null),N([m],r.prototype,"updateText",null),N([m],r.prototype,"setAnchors",null),N([m],r.prototype,"setSelected",null),N([m],r.prototype,"setHovered",null),N([m],r.prototype,"setHitable",null),N([m],r.prototype,"setHittable",null),N([m],r.prototype,"openEdgeAnimation",null),N([m],r.prototype,"closeEdgeAnimation",null),N([m],r.prototype,"setElementState",null),N([m],r.prototype,"updateStartPoint",null),N([m],r.prototype,"moveStartPoint",null),N([m],r.prototype,"updateEndPoint",null),N([m],r.prototype,"moveEndPoint",null),N([m],r.prototype,"setZIndex",null),N([m],r.prototype,"initPoints",null),N([m],r.prototype,"updateAttributes",null),N([m],r.prototype,"getAdjustStart",null),N([m],r.prototype,"getAdjustEnd",null),N([m],r.prototype,"updateAfterAdjustStartAndEnd",null),r}(),Zi=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Lt=function(){return Lt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Lt.apply(this,arguments)},dt=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},cn=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},gr=function(r){Zi(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.BEZIER_EDGE,o.path="",o.initEdgeData(t),o.setAttributes(),o}return e.prototype.initEdgeData=function(t){this.offset=100,r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.bezier,n=r.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return Lt(Lt(Lt({},n),b(t)),b(i))},e.prototype.getTextPosition=function(){if(this.pointsList&&this.pointsList.length>0){var t=0,n=0;return this.pointsList.forEach(function(o){var i=o.x,a=o.y;t+=i,n+=a}),{x:t/this.pointsList.length,y:n/this.pointsList.length}}return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(o){var i=o.x,a=o.y;return{x:i,y:a}});return Lt(Lt({},t),{pointsList:n})},e.prototype.getControls=function(){var t=this.startPoint,n=this.endPoint,o=ar({start:t,end:n,sourceNode:this.sourceNode,targetNode:this.targetNode,offset:this.offset});return o},e.prototype.getPath=function(t){var n=cn(t,4),o=n[0],i=n[1],a=n[2],s=n[3];return"M ".concat(o.x," ").concat(o.y,`
    C `).concat(i.x," ").concat(i.y,`,
    `).concat(a.x," ").concat(a.y,`,
    `).concat(s.x," ").concat(s.y)},e.prototype.initPoints=function(){this.pointsList.length>0?this.path=this.getPath(this.pointsList):this.updatePoints()},e.prototype.updatePoints=function(){var t=this.getControls(),n=t.sNext,o=t.ePre;this.updatePath(n,o)},e.prototype.updatePath=function(t,n){t=b(t),n=b(n);var o={x:this.startPoint.x,y:this.startPoint.y},i={x:this.endPoint.x,y:this.endPoint.y};if(!t||!n){var a=this.getControls();t=a.sNext,n=a.ePre}this.pointsList=[o,t,n,i],this.path=this.getPath(this.pointsList)},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n;var o=cn(this.pointsList,3),i=o[1],a=o[2];i.x+=t,i.y+=n,this.updatePath(i,a)},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n;var o=cn(this.pointsList,3),i=o[1],a=o[2];a.x+=t,a.y+=n,this.updatePath(i,a)},e.prototype.updateAdjustAnchor=function(t,n){var o;n==="sNext"?this.pointsList[1]=t:n==="ePre"&&(this.pointsList[2]=t),this.path=this.getPath(this.pointsList),!((o=this.text)===null||o===void 0)&&o.value&&this.setText(z({},this.text,this.textPosition))},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,o=t.endPoint,i=t.sourceNode,a=t.targetNode,s=ar({start:n,end:o,sourceNode:i,targetNode:a,offset:this.offset}),d=s.sNext,l=s.ePre;this.pointsList=[n,d,l,o],this.initPoints()},dt([E],e.prototype,"path",void 0),dt([m],e.prototype,"initPoints",null),dt([m],e.prototype,"updatePoints",null),dt([m],e.prototype,"updateStartPoint",null),dt([m],e.prototype,"updateEndPoint",null),dt([m],e.prototype,"moveStartPoint",null),dt([m],e.prototype,"moveEndPoint",null),dt([m],e.prototype,"updateAdjustAnchor",null),dt([m],e.prototype,"getAdjustStart",null),dt([m],e.prototype,"getAdjustEnd",null),dt([m],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(rn),Vi=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),de=function(){return de=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},de.apply(this,arguments)},Ki=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},qi=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},vr=function(r){Vi(e,r);function e(){var t=r.apply(this,qi([],Ki(arguments),!1))||this;return t.modelType=j.LINE_EDGE,t}return e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.line,n=r.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return de(de(de({},n),b(t)),b(i))},e.prototype.getTextPosition=function(){return{x:(this.startPoint.x+this.endPoint.x)/2,y:(this.startPoint.y+this.endPoint.y)/2}},e}(rn),Ji=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),le=function(){return le=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},le.apply(this,arguments)},Q=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},_r=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Qi=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},mr=function(r){Ji(e,r);function e(){var t=r.apply(this,Qi([],_r(arguments),!1))||this;return t.modelType=j.POLYLINE_EDGE,t.draggingPointList=[],t}return e.prototype.initEdgeData=function(t){this.offset=30,r.prototype.initEdgeData.call(this,t)},e.prototype.getEdgeStyle=function(){var t=this.graphModel.theme.polyline,n=r.prototype.getEdgeStyle.call(this),o=this.properties.style,i=o===void 0?{}:o;return le(le(le({},n),b(t)),b(i))},e.prototype.getTextPosition=function(){var t,n=(t=this.text)===null||t===void 0?void 0:t.value;if(this.dbClickPosition&&!n){var o=this.dbClickPosition,i=o.x,a=o.y;return{x:i,y:a}}var s=Xt(this.points),d=_r(qo(s),2),l=d[0],u=d[1];return{x:(l.x+u.x)/2,y:(l.y+u.y)/2}},e.prototype.getAfterAnchor=function(t,n,o){var i,a;return o.forEach(function(s){var d;t===F.HORIZONTAL?d=Math.abs(n.y-s.y):t===F.VERTICAL&&(d=Math.abs(n.x-s.x)),(!a||a>d)&&(a=d,i=s)}),i},e.prototype.getCrossPoint=function(t,n,o){var i;return t===F.HORIZONTAL?i={x:o.x,y:n.y}:t===F.VERTICAL&&(i={x:n.x,y:o.y}),i},e.prototype.removeCrossPoints=function(t,n,o){var i=o.map(function(y){return y});if(t===1){var a=i[t],s=i[n],d=i[t-1],l=nr(d,a,this.sourceNode);if(l){var u=rr(a,s,this.sourceNode);if(u){var f=or(a,s,this.sourceNode);f&&(i[t]=f,i.splice(t-1,1),t--,n--)}}else{var c=this.sourceNode.anchors;c.forEach(function(y){if(y.x===d.x&&y.x===a.x||y.y===d.y&&y.y===a.y){var _=pt(y.x,y.y,a.x,a.y),M=pt(d.x,d.y,a.x,a.y);_<M&&(i[t-1]=y)}})}}if(n===o.length-2){var h=i[t],g=i[n],p=i[n+1],v=nr(g,p,this.targetNode);if(v){var u=rr(h,g,this.targetNode);if(u){var f=or(h,g,this.targetNode);f&&(i[n]=f,i.splice(n+1,1))}}else{var c=this.targetNode.anchors;c.forEach(function(_){if(_.x===p.x&&_.x===g.x||_.y===p.y&&_.y===g.y){var M=pt(_.x,_.y,g.x,g.y),S=pt(p.x,p.y,g.x,g.y);M<S&&(i[n+1]=_)}})}}return i},e.prototype.getDraggingPoints=function(t,n,o,i,a){var s=a.map(function(u){return u}),d=this.getAfterAnchor(t,o,i),l=this.getCrossPoint(t,o,d);return n==="start"?(s.unshift(l),s.unshift(d)):(s.push(l),s.push(d)),s},e.prototype.updateCrossPoints=function(t){var n=t.map(function(_){return _}),o=t[0],i=t[1],a=t[n.length-2],s=t[n.length-1],d=this,l=d.sourceNode,u=d.targetNode,f=l.modelType,c=u.modelType,h=Ue(o,i),g=n[0];switch(f){case j.RECT_NODE:if(l.radius!==0){var p=fr(o,l);p||(g=ur(o,h,l))}break;case j.CIRCLE_NODE:g=Mn(o,h,l);break;case j.ELLIPSE_NODE:g=cr(o,h,l);break;case j.DIAMOND_NODE:g=Le(o,h,l);break;case j.POLYGON_NODE:g=Le(o,h,l);break}g&&(n[0]=g);var v=Ue(a,s),y=n[n.length-1];switch(c){case j.RECT_NODE:if(u.radius!==0){var p=fr(s,u);p||(y=ur(s,v,u))}break;case j.CIRCLE_NODE:y=Mn(s,v,u);break;case j.ELLIPSE_NODE:y=cr(s,v,u);break;case j.DIAMOND_NODE:y=Le(s,v,u);break;case j.POLYGON_NODE:y=Le(s,v,u);break}return y&&(n[n.length-1]=y),n},e.prototype.getData=function(){var t=r.prototype.getData.call(this),n=this.pointsList.map(function(o){var i=o.x,a=o.y;return{x:i,y:a}});return Object.assign({},t,{pointsList:n})},e.prototype.initPoints=function(){this.pointsList.length>0?this.points=this.pointsList.map(function(t){return"".concat(t.x,",").concat(t.y)}).join(" "):this.updatePoints()},e.prototype.updatePoints=function(){var t=er({x:this.startPoint.x,y:this.startPoint.y},{x:this.endPoint.x,y:this.endPoint.y},this.sourceNode,this.targetNode,this.offset||0);this.pointsList=t,this.points=t.map(function(n){return"".concat(n.x,",").concat(n.y)}).join(" ")},e.prototype.updateStartPoint=function(t){this.startPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveStartPoint=function(t,n){this.startPoint.x+=t,this.startPoint.y+=n,this.updatePoints()},e.prototype.updateEndPoint=function(t){this.endPoint=Object.assign({},t),this.updatePoints()},e.prototype.moveEndPoint=function(t,n){this.endPoint.x+=t,this.endPoint.y+=n,this.updatePoints()},e.prototype.updatePointsList=function(t,n){this.pointsList.forEach(function(a){a.x+=t,a.y+=n});var o=this.pointsList[0];this.startPoint=Object.assign({},o);var i=this.pointsList[this.pointsList.length-1];this.endPoint=Object.assign({},i),this.initPoints()},e.prototype.dragAppendStart=function(){this.draggingPointList=this.pointsList.map(function(t){return t})},e.prototype.dragAppendSimple=function(t,n){var o;this.isDragging=!0;var i=t.start,a=t.end,s=t.startIndex,d=t.endIndex,l=t.direction,u=this.pointsList,f=u;return l===F.HORIZONTAL?(u[s]={x:i.x,y:i.y+n.y},u[d]={x:a.x,y:a.y+n.y},f=this.pointsList.map(function(c){return c})):l===F.VERTICAL&&(u[s]={x:i.x+n.x,y:i.y},u[d]={x:a.x+n.x,y:a.y},f=this.pointsList.map(function(c){return c})),this.updatePointsAfterDrag(f),this.draggingPointList=f,!((o=this.text)===null||o===void 0)&&o.value&&this.setText(z({},this.text,this.textPosition)),{start:z({},u[s]),end:z({},u[d]),startIndex:s,endIndex:d,direction:l}},e.prototype.dragAppend=function(t,n){var o;this.isDragging=!0;var i=t.start,a=t.end,s=t.startIndex,d=t.endIndex,l=t.direction,u=this.pointsList;if(l===F.HORIZONTAL){u[s]={x:i.x,y:i.y+n.y},u[d]={x:a.x,y:a.y+n.y};var f=this.pointsList.map(function(v){return v});if(s!==0&&d!==this.pointsList.length-1&&(f=this.removeCrossPoints(s,d,f)),s===0){var c={x:i.x,y:i.y+n.y},h=Tt(c,this.sourceNode);if(!h){var g=this.sourceNode.anchors;f=this.getDraggingPoints(l,"start",c,g,f)}}if(d===this.pointsList.length-1){var p={x:a.x,y:a.y+n.y},h=Tt(p,this.targetNode);if(!h){var g=this.targetNode.anchors;f=this.getDraggingPoints(l,"end",p,g,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}else if(l===F.VERTICAL){u[s]={x:i.x+n.x,y:i.y},u[d]={x:a.x+n.x,y:a.y};var f=this.pointsList.map(function(y){return y});if(s!==0&&d!==this.pointsList.length-1&&(f=this.removeCrossPoints(s,d,f)),s===0){var c={x:i.x+n.x,y:i.y},h=Tt(c,this.sourceNode);if(!h){var g=this.sourceNode.anchors;f=this.getDraggingPoints(l,"start",c,g,f)}}if(d===this.pointsList.length-1){var p={x:a.x+n.x,y:a.y},h=Tt(p,this.targetNode);if(!h){var g=this.targetNode.anchors;f=this.getDraggingPoints(l,"end",p,g,f)}}this.updatePointsAfterDrag(f),this.draggingPointList=f}return!((o=this.text)===null||o===void 0)&&o.value&&this.setText(z({},this.text,this.textPosition)),{start:z({},u[s]),end:z({},u[d]),startIndex:s,endIndex:d,direction:l}},e.prototype.dragAppendEnd=function(){if(this.draggingPointList){var t=Vr(Xt(this.points));this.pointsList=t.map(function(i){return i}),this.draggingPointList=[];var n=t[0];this.startPoint=z({},n);var o=t[t.length-1];this.endPoint=z({},o)}this.isDragging=!1},e.prototype.updatePointsAfterDrag=function(t){var n=this.updateCrossPoints(t);this.points=n.map(function(o){return"".concat(o.x,",").concat(o.y)}).join(" ")},e.prototype.getAdjustStart=function(){return this.pointsList[0]||this.startPoint},e.prototype.getAdjustEnd=function(){var t=this.pointsList;return t[t.length-1]||this.endPoint},e.prototype.updateAfterAdjustStartAndEnd=function(t){var n=t.startPoint,o=t.endPoint,i=t.sourceNode,a=t.targetNode;this.pointsList=er({x:n.x,y:n.y},{x:o.x,y:o.y},i,a,this.offset||0),this.initPoints()},Q([E],e.prototype,"dbClickPosition",void 0),Q([m],e.prototype,"initPoints",null),Q([m],e.prototype,"updatePoints",null),Q([m],e.prototype,"updateStartPoint",null),Q([m],e.prototype,"moveStartPoint",null),Q([m],e.prototype,"updateEndPoint",null),Q([m],e.prototype,"moveEndPoint",null),Q([m],e.prototype,"updatePointsList",null),Q([m],e.prototype,"dragAppendStart",null),Q([m],e.prototype,"dragAppendSimple",null),Q([m],e.prototype,"dragAppend",null),Q([m],e.prototype,"dragAppendEnd",null),Q([m],e.prototype,"updatePointsAfterDrag",null),Q([m],e.prototype,"getAdjustStart",null),Q([m],e.prototype,"getAdjustEnd",null),Q([m],e.prototype,"updateAfterAdjustStartAndEnd",null),e}(rn),K=function(){return K=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},K.apply(this,arguments)},D=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},xr=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ta=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Dt=function(){function r(e,t){var n;this.BaseType=U.NODE,this.id="",this.type="",this.x=0,this.y=0,this.textMode=ht.TEXT,this.text={value:"",x:0,y:0,draggable:!1,editable:!0},this._width=100,this._height=80,this.minWidth=30,this.minHeight=30,this.maxWidth=2e3,this.maxHeight=2e3,this.anchorsOffset=[],this.virtual=!1,this.isSelected=!1,this.isHovered=!1,this.isShowAnchor=!1,this.isDragging=!1,this.isHitable=!0,this.isHittable=!0,this.draggable=!0,this.visible=!0,this.rotatable=!0,this.resizable=!0,this.zIndex=1,this.state=B.DEFAULT,this.autoToFront=!0,this.style={},this._rotate=0,this.modelType=j.NODE,this.additionStateData={},this.targetRules=[],this.sourceRules=[],this.moveRules=[],this.resizeRules=[],this.hasSetTargetRules=!1,this.hasSetSourceRules=!1,this.graphModel=t,this.properties=(n=e.properties)!==null&&n!==void 0?n:{},this.initNodeData(e),this.setAttributes()}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e;var t=this,n=t.x,o=n===void 0?0:n,i=t.y,a=i===void 0?0:i;this.transform=new nn(-o,-a).rotate(e).translate(o,a).toString()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"incoming",{get:function(){return{nodes:this.graphModel.getNodeIncomingNode(this.id),edges:this.graphModel.getNodeIncomingEdge(this.id)}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outgoing",{get:function(){return{nodes:this.graphModel.getNodeOutgoingNode(this.id),edges:this.graphModel.getNodeOutgoingEdge(this.id)}},enumerable:!1,configurable:!0}),r.prototype.initNodeData=function(e){if(e.properties||(e.properties={}),!e.id){var t=this.graphModel.idGenerator,n=t&&t(e.type),o=this.createId();e.id=o||n||It()}this.formatText(e),z(this,ui(e));var i=this.graphModel.overlapMode;i===ct.INCREASE&&(this.zIndex=e.zIndex||Un())},r.prototype.setAttributes=function(){},r.prototype.createId=function(){return null},r.prototype.setTextMode=function(e){this.textMode=e},r.prototype.formatText=function(e){var t,n,o,i=e.x,a=e.y,s=e.text,d={value:"",x:i,y:a,draggable:!1,editable:!0};s&&(typeof s=="string"?d.value=s:(d=K(K({},d),{x:(t=s.x)!==null&&t!==void 0?t:i,y:(n=s.y)!==null&&n!==void 0?n:a,value:(o=s.value)!==null&&o!==void 0?o:""}),Qt(s.draggable)||(d.draggable=s.draggable),Qt(s.editable)||(d.editable=s.editable))),e.text=d},r.prototype.resize=function(e){var t=e.width,n=e.height,o=e.deltaX,i=e.deltaY,a=this.isAllowResizeNode(o,i,t,n);return a?(this.move(o/2,i/2),this.width=t,this.height=n,this.setProperties({width:t,height:n}),this.getData()):this.getData()},r.prototype.proportionalResize=function(){},r.prototype.getData=function(){var e=this.text,t=e.x,n=e.y,o=e.value,i=this.properties;Wr(i)&&(i=vt(i)),Jt(i.width)&&(i.width=this.width),Jt(i.height)&&(i.height=this.height);var a={id:this.id,type:this.type,x:this.x,y:this.y,properties:i};return this.rotate&&(a.rotate=this.rotate),this.graphModel.overlapMode===ct.INCREASE&&(a.zIndex=this.zIndex),o&&(a.text={x:t,y:n,value:o}),a},r.prototype.getHistoryData=function(){return this.getData()},r.prototype.getProperties=function(){return vt(this.properties)},r.prototype.getOuterGAttributes=function(){return{className:""}},r.prototype.getNodeStyle=function(){return K(K({},this.graphModel.theme.baseNode),this.style)},r.prototype.getTextStyle=function(){var e=this.graphModel.theme.nodeText,t=this.properties.textStyle,n=t===void 0?{}:t;return K(K({},b(e)),b(n))},r.prototype.getRotateControlStyle=function(){var e=this.graphModel.theme.rotateControl;return b(e)},r.prototype.getResizeControlStyle=function(){var e=this.graphModel.theme.resizeControl;return b(e)},r.prototype.getResizeOutlineStyle=function(){var e=this.graphModel.theme.resizeOutline;return b(e)},r.prototype.getAnchorStyle=function(e){var t=this.graphModel.theme.anchor;return b(t)},r.prototype.getAnchorLineStyle=function(e){var t=this.graphModel.theme.anchorLine;return b(t)},r.prototype.getOutlineStyle=function(){var e=this.graphModel.theme.outline;return b(e)},r.prototype.isAllowConnectedAsSource=function(e,t,n,o){var i=this.hasSetSourceRules?this.sourceRules:this.getConnectedSourceRules();this.hasSetSourceRules=!0;for(var a=!0,s="",d=0;d<i.length;d++){var l=i[d];if(!l.validate.call(this,this,e,t,n,o)){a=!1,s=l.message;break}}return{isAllPass:a,msg:s}},r.prototype.getConnectedSourceRules=function(){return this.sourceRules},r.prototype.isAllowConnectedAsTarget=function(e,t,n,o){var i=this.hasSetTargetRules?this.targetRules:this.getConnectedTargetRules();this.hasSetTargetRules=!0;for(var a=!0,s="",d=0;d<i.length;d++){var l=i[d];if(!l.validate.call(this,e,this,t,n,o)){a=!1,s=l.message;break}}return{isAllPass:a,msg:s}},r.prototype.isAllowMoveNode=function(e,t){var n,o,i=!0,a=!0,s=this.moveRules.concat(this.graphModel.nodeMoveRules);try{for(var d=xr(s),l=d.next();!l.done;l=d.next()){var u=l.value,f=u(this,e,t);if(!f)return!1;if(typeof f=="object"){var c=f;if(!c.x&&!c.y)return!1;i=i&&c.x,a=a&&c.y}}}catch(h){n={error:h}}finally{try{l&&!l.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}return{x:i,y:a}},r.prototype.getConnectedTargetRules=function(){return this.targetRules},r.prototype.getAnchorsByOffset=function(){var e=this,t=e.anchorsOffset,n=e.id,o=e.x,i=e.y;return t&&t.length>0?t.map(function(a,s){return a.length?(a=a,{id:"".concat(n,"_").concat(s),x:o+a[0],y:i+a[1]}):(a=a,K(K({},a),{x:o+a.x,y:i+a.y,id:a.id||"".concat(n,"_").concat(s)}))}):this.getDefaultAnchor()},r.prototype.getDefaultAnchor=function(){return[]},r.prototype.getTargetAnchor=function(e){return si(e,this)},r.prototype.getBounds=function(){return{minX:this.x-this.width/2,minY:this.y-this.height/2,maxX:this.x+this.width/2,maxY:this.y+this.height/2}},Object.defineProperty(r.prototype,"anchors",{get:function(){var e=this.getAnchorsByOffset(),t=this,n=t.x,o=t.y,i=t.rotate;return e.forEach(function(a){var s=a.x,d=a.y,l=ta(new en([s,d,1]).translate(-n,-o).rotate(i).translate(n,o)[0],2),u=l[0],f=l[1];a.x=u,a.y=f}),e},enumerable:!1,configurable:!0}),r.prototype.getAnchorInfo=function(e){if(!Jt(e))for(var t=0;t<this.anchors.length;t++){var n=this.anchors[t];if(n.id===e)return n}},r.prototype.addNodeMoveRules=function(e){this.moveRules.includes(e)||this.moveRules.push(e)},r.prototype.isAllowMoveByXORY=function(e,t,n){var o,i;if(n)o=!0,i=!0;else{var a=this.isAllowMoveNode(e,t);typeof a=="boolean"?(o=a,i=a):(o=a.x,i=a.y)}return{isAllowMoveX:o,isAllowMoveY:i}},r.prototype.move=function(e,t,n){n===void 0&&(n=!1);var o=this.isAllowMoveByXORY(e,t,n),i=o.isAllowMoveX,a=o.isAllowMoveY;return i&&(this.x=this.x+e,this.text&&this.moveText(e,0)),a&&(this.y=this.y+t,this.text&&this.moveText(0,t)),(i||a)&&(this.rotate=this._rotate),i||a},r.prototype.getMoveDistance=function(e,t,n){n===void 0&&(n=!1);var o=this.isAllowMoveByXORY(e,t,n),i=o.isAllowMoveX,a=o.isAllowMoveY,s=0,d=0;return i&&e&&(this.x=this.x+e,this.text&&this.moveText(e,0),s=e),a&&t&&(this.y=this.y+t,this.text&&this.moveText(0,t),d=t),[s,d]},r.prototype.moveTo=function(e,t,n){n===void 0&&(n=!1);var o=e-this.x,i=t-this.y;return!n&&!this.isAllowMoveNode(o,i)?!1:(this.text&&this.moveText(o,i),this.x=e,this.y=t,!0)},r.prototype.moveText=function(e,t){var n=this.text,o=n.x,i=n.y,a=n.value,s=n.draggable,d=n.editable;this.text={value:a,editable:d,draggable:s,x:o+e,y:i+t}},r.prototype.updateText=function(e){this.text=K(K({},vt(this.text)),{value:e})},r.prototype.addNodeResizeRules=function(e){this.resizeRules.includes(e)||this.resizeRules.push(e)},r.prototype.isAllowResizeNode=function(e,t,n,o){var i,a,s=this.resizeRules.concat(this.graphModel.nodeResizeRules);try{for(var d=xr(s),l=d.next();!l.done;l=d.next()){var u=l.value,f=u(this,e,t,n,o);if(!f)return!1}}catch(c){i={error:c}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}return!0},r.prototype.setSelected=function(e){e===void 0&&(e=!0),this.isSelected=e},r.prototype.setHovered=function(e){e===void 0&&(e=!0),this.isHovered=e,this.setIsShowAnchor(e)},r.prototype.setIsShowAnchor=function(e){e===void 0&&(e=!0),this.isShowAnchor=e},r.prototype.setRotatable=function(e){e===void 0&&(e=!0),this.rotatable=e},r.prototype.setResizable=function(e){e===void 0&&(e=!0),this.resizable=e},r.prototype.setHitable=function(e){e===void 0&&(e=!0),this.isHitable=e},r.prototype.setHittable=function(e){e===void 0&&(e=!0),this.isHittable=e},r.prototype.setElementState=function(e,t){this.state=e,this.additionStateData=t},r.prototype.updateProperties=function(e,t){var n=vt(this.properties);this.properties=e,this.setAttributes(),this.graphModel.eventCenter.emit(T.NODE_PROPERTIES_CHANGE,{id:this.id,keys:t,preProperties:n,properties:e})},r.prototype.setProperty=function(e,t){var n=vt(this.properties),o=b(n);po(o,e,tt(t)),this.updateProperties(o,[e])},r.prototype.setProperties=function(e){var t=vt(this.properties),n=K(K({},t),tt(e)),o=[];ho(e,function(i,a){(Wn(t,a)&&t[a]!==i||!Wn(t,a))&&o.push(a)}),this.updateProperties(n,o)},r.prototype.deleteProperty=function(e){delete this.properties[e],this.setAttributes()},r.prototype.setStyle=function(e,t){var n;this.style=K(K({},this.style),(n={},n[e]=tt(t),n))},r.prototype.setStyles=function(e){this.style=K(K({},this.style),tt(e))},r.prototype.updateStyles=function(e){this.style=K({},tt(e))},r.prototype.setZIndex=function(e){e===void 0&&(e=1),this.zIndex=e},r.prototype.updateAttributes=function(e){z(this,e)},r.BaseType=U.NODE,D([E],r.prototype,"type",void 0),D([E],r.prototype,"x",void 0),D([E],r.prototype,"y",void 0),D([E],r.prototype,"textMode",void 0),D([E],r.prototype,"text",void 0),D([E],r.prototype,"properties",void 0),D([E],r.prototype,"_width",void 0),D([E],r.prototype,"_height",void 0),D([E],r.prototype,"anchorsOffset",void 0),D([E],r.prototype,"isSelected",void 0),D([E],r.prototype,"isHovered",void 0),D([E],r.prototype,"isShowAnchor",void 0),D([E],r.prototype,"isDragging",void 0),D([E],r.prototype,"isHitable",void 0),D([E],r.prototype,"isHittable",void 0),D([E],r.prototype,"draggable",void 0),D([E],r.prototype,"visible",void 0),D([E],r.prototype,"rotatable",void 0),D([E],r.prototype,"resizable",void 0),D([E],r.prototype,"zIndex",void 0),D([E],r.prototype,"state",void 0),D([E],r.prototype,"autoToFront",void 0),D([E],r.prototype,"style",void 0),D([E],r.prototype,"transform",void 0),D([E],r.prototype,"_rotate",void 0),D([$],r.prototype,"incoming",null),D([$],r.prototype,"outgoing",null),D([m],r.prototype,"setTextMode",null),D([m],r.prototype,"addNodeMoveRules",null),D([m],r.prototype,"move",null),D([m],r.prototype,"getMoveDistance",null),D([m],r.prototype,"moveTo",null),D([m],r.prototype,"moveText",null),D([m],r.prototype,"updateText",null),D([m],r.prototype,"addNodeResizeRules",null),D([m],r.prototype,"setSelected",null),D([m],r.prototype,"setHovered",null),D([m],r.prototype,"setIsShowAnchor",null),D([m],r.prototype,"setRotatable",null),D([m],r.prototype,"setResizable",null),D([m],r.prototype,"setHitable",null),D([m],r.prototype,"setHittable",null),D([m],r.prototype,"setElementState",null),D([m],r.prototype,"setProperty",null),D([m],r.prototype,"setProperties",null),D([m],r.prototype,"deleteProperty",null),D([m],r.prototype,"setStyle",null),D([m],r.prototype,"setStyles",null),D([m],r.prototype,"updateStyles",null),D([m],r.prototype,"setZIndex",null),D([m],r.prototype,"updateAttributes",null),r}(),ea=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ue=function(){return ue=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ue.apply(this,arguments)},pn=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Er=function(r){ea(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.CIRCLE_NODE,o.r=50,o.initNodeData(t),o.setAttributes(),o}return Object.defineProperty(e.prototype,"width",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.r*2},enumerable:!1,configurable:!0}),e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties.r;t&&(this.r=t)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.circle,o=this.properties.style,i=o===void 0?{}:o;return ue(ue(ue({},t),b(n)),b(i))},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,o=t.y,i=t.r;return[{x:n,y:o-i,id:"".concat(this.id,"_0")},{x:n+i,y:o,id:"".concat(this.id,"_1")},{x:n,y:o+i,id:"".concat(this.id,"_2")},{x:n-i,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,o=t.deltaX,i=t.deltaY;return this.move(o/2,i/2),this.r=n,this.setProperties({r:n}),this.getData()},pn([E],e.prototype,"r",void 0),pn([$],e.prototype,"width",null),pn([$],e.prototype,"height",null),e}(Dt),na=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),fe=function(){return fe=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},fe.apply(this,arguments)},$t=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},je=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Mr=function(r){na(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.DIAMOND_NODE,o.rx=30,o.ry=50,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,o=t.ry;n&&(this.rx=n),o&&(this.ry=o)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.diamond,o=this.properties.style,i=o===void 0?{}:o;return fe(fe(fe({},t),b(n)),b(i))},Object.defineProperty(e.prototype,"points",{get:function(){var t=this,n=t.x,o=t.y,i=t.rx,a=t.ry;return[[n,o-a],[n+i,o],[n,o+a],[n-i,o]]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsPosition",{get:function(){return Ot(this.points,function(t){var n=je(t,2),o=n[0],i=n[1];return{x:o,y:i}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return W(this.points,function(o){var i=je(o,1),a=i[0];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return W(this.points,function(o){var i=je(o,2),a=i[1];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this;return Ot(this.points,function(n,o){var i=je(n,2),a=i[0],s=i[1];return{x:a,y:s,id:"".concat(t.id,"_").concat(o)}})},e.prototype.resize=function(t){var n=t.width,o=t.height,i=t.deltaX,a=t.deltaY;return this.move(i/2,a/2),this.rx=n,this.ry=o,this.setProperties({rx:n,ry:o}),this.getData()},$t([E],e.prototype,"rx",void 0),$t([E],e.prototype,"ry",void 0),$t([$],e.prototype,"points",null),$t([$],e.prototype,"pointsPosition",null),$t([$],e.prototype,"width",null),$t([$],e.prototype,"height",null),e}(Dt),ra=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ce=function(){return ce=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ce.apply(this,arguments)},Re=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Or=function(r){ra(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.ELLIPSE_NODE,o.rx=30,o.ry=45,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.rx,o=t.ry;n&&(this.rx=n),o&&(this.ry=o)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.ellipse,o=this.properties.style,i=o===void 0?{}:o;return ce(ce(ce({},t),b(n)),b(i))},Object.defineProperty(e.prototype,"width",{get:function(){return this.rx*2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ry*2},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,o=t.y,i=t.rx,a=t.ry;return[{x:n,y:o-a,id:"".concat(this.id,"_0")},{x:n+i,y:o,id:"".concat(this.id,"_1")},{x:n,y:o+a,id:"".concat(this.id,"_2")},{x:n-i,y:o,id:"".concat(this.id,"_3")}]},e.prototype.resize=function(t){var n=t.width,o=t.height,i=t.deltaX,a=t.deltaY;return this.move(i/2,a/2),this.rx=n,this.ry=o,this.setProperties({rx:n,ry:o}),this.getData()},Re([E],e.prototype,"rx",void 0),Re([E],e.prototype,"ry",void 0),Re([$],e.prototype,"width",null),Re([$],e.prototype,"height",null),e}(Dt),oa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),pe=function(){return pe=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},pe.apply(this,arguments)},Ie=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Be=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Sr=function(r){oa(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.POLYGON_NODE,o.points=[[50,0],[100,50],[50,100],[0,50]],o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.points,o=t.width,i=t.height,a=n||this.points;this.points=ri(a,o,i)},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.polygon,o=this.properties.style,i=o===void 0?{}:o;return pe(pe(pe({},t),b(n)),b(i))},Object.defineProperty(e.prototype,"pointsPosition",{get:function(){var t=this,n=t.x,o=t.y,i=t.width,a=t.height;return this.points.map(function(s){return{x:s[0]+n-i/2,y:s[1]+o-a/2}})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var i=Be(o,1),a=i[0];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;return this.points.forEach(function(o){var i=Be(o,2),a=i[1];a<t&&(t=a),a>n&&(n=a)}),n-t},enumerable:!1,configurable:!0}),e.prototype.getDefaultAnchor=function(){var t=this,n=this,o=n.x,i=n.y,a=n.width,s=n.height,d=n.points;return d.map(function(l,u){var f=Be(l,2),c=f[0],h=f[1];return{x:o+c-a/2,y:i+h-s/2,id:"".concat(t.id,"_").concat(u)}})},e.prototype.resize=function(t){var n=this,o=t.width,i=t.height,a=t.deltaX,s=t.deltaY;this.move(a/2,s/2);var d=Ot(this.points,function(l){var u=Be(l,2),f=u[0],c=u[1];return[f*o/n.width,c*i/n.height]});return this.points=d,this.properties.points=d,this.getData()},Ie([E],e.prototype,"points",void 0),Ie([$],e.prototype,"pointsPosition",null),Ie([$],e.prototype,"width",null),Ie([$],e.prototype,"height",null),e}(Dt),ia=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),he=function(){return he=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},he.apply(this,arguments)},aa=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},wr=function(r){ia(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.RECT_NODE,o.radius=0,o.initNodeData(t),o.setAttributes(),o}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,o=t.height,i=t.radius;Jt(n)||(this.width=n),Jt(o)||(this.height=o),Jt(i)||(this.radius=i)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,o=t.y,i=t.width,a=t.height;return[{x:n,y:o-a/2,id:"".concat(this.id,"_0")},{x:n+i/2,y:o,id:"".concat(this.id,"_1")},{x:n,y:o+a/2,id:"".concat(this.id,"_2")},{x:n-i/2,y:o,id:"".concat(this.id,"_3")}]},e.prototype.getNodeStyle=function(){var t=r.prototype.getNodeStyle.call(this),n=this.graphModel.theme.rect,o=this.properties.style,i=o===void 0?{}:o;return he(he(he({},t),b(n)),b(i))},aa([E],e.prototype,"radius",void 0),e}(Dt),sa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ye=function(){return ye=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ye.apply(this,arguments)},Ar=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},da=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},la=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},Pr=function(r){sa(e,r);function e(){var t=r.apply(this,la([],da(arguments),!1))||this;return t.modelType=j.TEXT_NODE,t}return e.prototype.getTextStyle=function(){var t=r.prototype.getTextStyle.call(this),n=this.graphModel.theme.text,o=this.properties.textStyle;return ye(ye(ye({},t),b(n)),b(o))},Object.defineProperty(e.prototype,"width",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,o=hr({rows:t,fontSize:n,rowsLength:t.length}).width;return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=String(this.text.value).split(/[\r\n]/g),n=this.getTextStyle().fontSize,o=hr({rows:t,fontSize:n,rowsLength:t.length}).height;return o},enumerable:!1,configurable:!0}),Ar([$],e.prototype,"width",null),Ar([$],e.prototype,"height",null),e}(Dt),ua=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Tr=function(r){ua(e,r);function e(t,n){var o=r.call(this,t,n)||this;return o.modelType=j.HTML_NODE,o.setAttributes(),o}return e.prototype.setAttributes=function(){r.prototype.setAttributes.call(this);var t=this.properties,n=t.width,o=t.height;n&&(this.width=n),o&&(this.height=o)},e.prototype.getDefaultAnchor=function(){var t=this,n=t.x,o=t.y,i=t.width,a=t.height;return[{x:n,y:o-a/2,id:"".concat(this.id,"_0")},{x:n+i/2,y:o,id:"".concat(this.id,"_1")},{x:n,y:o+a/2,id:"".concat(this.id,"_2")},{x:n-i/2,y:o,id:"".concat(this.id,"_3")}]},e}(Dt),X=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},fa={stopZoomGraph:!1,stopScrollGraph:!1,stopMoveGraph:!1,adjustEdge:!1,adjustEdgeStartAndEnd:!1,adjustNodePosition:!1,hideAnchors:!0,allowRotate:!1,allowResize:!1,nodeSelectedOutline:!0,textEdit:!1,nodeTextEdit:!1,edgeTextEdit:!1,textDraggable:!1,nodeTextDraggable:!1,edgeTextDraggable:!1},Xe=["isSilentMode","stopZoomGraph","stopScrollGraph","stopMoveGraph","adjustEdge","adjustEdgeMiddle","adjustEdgeStartAndEnd","adjustEdgeStart","adjustEdgeEnd","adjustNodePosition","hideAnchors","allowRotate","allowResize","autoExpand","hoverOutline","nodeSelectedOutline","edgeSelectedOutline","textEdit","nodeTextEdit","edgeTextEdit","textDraggable","nodeTextDraggable","edgeTextDraggable","multipleSelectKey","textMode","nodeTextMode","edgeTextMode","nodeTextMultiple","edgeTextMultiple","nodeTextVertical","edgeTextVertical"],ca=function(){function r(e){this.isSilentMode=!1,this.stopZoomGraph=!1,this.stopMoveGraph=!1,this.stopScrollGraph=!1,this.textMode=ht.TEXT,this.textEdit=!0,this.textDraggable=!1,this.nodeTextEdit=!0,this.nodeTextDraggable=!1,this.nodeTextMultiple=!1,this.nodeTextVertical=!1,this.nodeTextMode=ht.TEXT,this.edgeTextMode=ht.TEXT,this.edgeTextEdit=!0,this.edgeTextDraggable=!1,this.edgeTextMultiple=!1,this.edgeTextVertical=!1,this.hideAnchors=!1,this.allowRotate=!1,this.allowResize=!1,this.hoverOutline=!0,this.nodeSelectedOutline=!0,this.adjustNodePosition=!0,this.autoExpand=!1,this.adjustEdge=!0,this.adjustEdgeMiddle=!1,this.adjustEdgeStartAndEnd=!1,this.adjustEdgeStart=!1,this.adjustEdgeEnd=!1,this.edgeSelectedOutline=!0,this.multipleSelectKey="",z(this,this.computeConfig(e))}return r.prototype.updateEditConfig=function(e){var t=this.computeConfig(e);z(this,t)},r.prototype.computeConfig=function(e){var t=e.isSilentMode,n=e.textDraggable,o=e.textMode,i=e.textEdit,a=e.adjustEdgeStartAndEnd,s={};if(t===!1&&z(s,this.stagedConfig),t===!0&&t!==this.isSilentMode){var d=Zt(fa,Xe);this.stagedConfig=Zt(this,Xe),z(s,d)}Qt(i)||z(s,{nodeTextEdit:i,edgeTextEdit:i}),Qt(n)||z(s,{nodeTextDraggable:n,edgeTextDraggable:n}),o&&z(s,{nodeTextMode:o,edgeTextMode:o}),yo(a)&&z(s,{adjustEdgeStart:a,adjustEdgeEnd:a});var l=Zt(e,Xe);return z(s,l)},r.prototype.updateTextMode=function(e){this.textMode=e,this.edgeTextMode=e,this.nodeTextMode=e},r.prototype.getConfig=function(){return Zt(this,Xe)},X([E],r.prototype,"isSilentMode",void 0),X([E],r.prototype,"stopZoomGraph",void 0),X([E],r.prototype,"stopMoveGraph",void 0),X([E],r.prototype,"stopScrollGraph",void 0),X([E],r.prototype,"textMode",void 0),X([E],r.prototype,"textEdit",void 0),X([E],r.prototype,"textDraggable",void 0),X([E],r.prototype,"nodeTextEdit",void 0),X([E],r.prototype,"nodeTextDraggable",void 0),X([E],r.prototype,"nodeTextMultiple",void 0),X([E],r.prototype,"nodeTextVertical",void 0),X([E],r.prototype,"nodeTextMode",void 0),X([E],r.prototype,"edgeTextMode",void 0),X([E],r.prototype,"edgeTextEdit",void 0),X([E],r.prototype,"edgeTextDraggable",void 0),X([E],r.prototype,"edgeTextMultiple",void 0),X([E],r.prototype,"edgeTextVertical",void 0),X([E],r.prototype,"hideAnchors",void 0),X([E],r.prototype,"allowRotate",void 0),X([E],r.prototype,"allowResize",void 0),X([E],r.prototype,"hoverOutline",void 0),X([E],r.prototype,"nodeSelectedOutline",void 0),X([E],r.prototype,"adjustNodePosition",void 0),X([E],r.prototype,"autoExpand",void 0),X([E],r.prototype,"adjustEdge",void 0),X([E],r.prototype,"adjustEdgeMiddle",void 0),X([E],r.prototype,"adjustEdgeStartAndEnd",void 0),X([E],r.prototype,"adjustEdgeStart",void 0),X([E],r.prototype,"adjustEdgeEnd",void 0),X([E],r.prototype,"edgeSelectedOutline",void 0),X([m],r.prototype,"updateEditConfig",null),X([m],r.prototype,"updateTextMode",null),r}(),pa="*",ha=function(){function r(){this._events={}}return r.prototype.on=function(e,t,n){var o=this;e==null||e.split(",").forEach(function(i){i=i.trim(),o._events[i]||(o._events[i]=[]),o._events[i].push({callback:t,once:!!n})})},r.prototype.once=function(e,t){var n=this;e==null||e.split(",").forEach(function(o){o=o.trim(),n.on(o,t,!0)})},r.prototype.emit=function(e,t){var n=this;e==null||e.split(",").forEach(function(o){var i=n._events[o]||[],a=n._events[pa]||[],s=function(d){for(var l=d.length,u=0;u<l;u++)if(d[u]){var f=d[u],c=f.callback,h=f.once;h&&(d.splice(u,1),d.length===0&&delete n._events[o],l--,u--),c.apply(n,[t])}};s(i),s(a)})},r.prototype.off=function(e,t){var n=this;e||(this._events={}),e.split(",").forEach(function(o){if(!t)delete n._events[o];else{for(var i=n._events[o]||[],a=i.length,s=0;s<a;s++)i[s].callback===t&&(i.splice(s,1),a--,s--);i.length===0&&delete n._events[o]}})},r.prototype.getEvents=function(){return this._events},r}(),Kt=function(){return Kt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Kt.apply(this,arguments)},P=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},q=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},ot=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},ya=function(){function r(e){this.modelMap=new Map,this.nodeModelMap=new Map,this.edgeModelMap=new Map,this.elementsModelMap=new Map,this.nodeMoveRules=[],this.nodeResizeRules=[],this.nodes=[],this.edges=[],this.overlapMode=ct.DEFAULT,this.gridSize=1,this.partial=!1;var t=e.container,n=e.partial,o=e.background,i=o===void 0?{}:o,a=e.grid,s=e.idGenerator,d=e.edgeGenerator,l=e.animation,u=e.customTrajectory;this.rootEl=t,this.partial=!!n,this.background=i,typeof a=="object"&&(this.gridSize=a.size||1),this.theme=io(e.style),this.edgeType=e.edgeType||"polyline",this.animation=bo(l),this.overlapMode=e.overlapMode||ct.DEFAULT,this.width=e.width||this.rootEl.getBoundingClientRect().width,this.height=e.height||this.rootEl.getBoundingClientRect().height,this.eventCenter=new ha,this.editConfigModel=new ca(e),this.transformModel=new _a(this.eventCenter,e),this.flowId=It(),this.idGenerator=s,this.edgeGenerator=ei(this,d),this.customTrajectory=u}return Object.defineProperty(r.prototype,"nodesMap",{get:function(){return this.nodes.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"edgesMap",{get:function(){return this.edges.reduce(function(e,t,n){return e[t.id]={index:n,model:t},e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelsMap",{get:function(){return ot(ot([],q(this.nodes),!1),q(this.edges),!1).reduce(function(e,t){return e[t.id]=t,e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sortElements",{get:function(){for(var e=ot(ot([],q(this.nodes),!1),q(this.edges),!1).sort(function(s,d){return s.zIndex-d.zIndex}),t=[],n=[-200,-200],o=[this.width+Kn,this.height+Kn],i=0;i<e.length;i++){var a=e[i];a.visible&&(!this.partial||a.isSelected||this.isElementInArea(a,n,o,!1,!1))&&t.push(a)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"textEditElement",{get:function(){var e=this.nodes.find(function(n){return n.state===B.TEXT_EDIT}),t=this.edges.find(function(n){return n.state===B.TEXT_EDIT});return e||t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectElements",{get:function(){var e=new Map;return this.nodes.forEach(function(t){t.isSelected&&e.set(t.id,t)}),this.edges.forEach(function(t){t.isSelected&&e.set(t.id,t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"selectNodes",{get:function(){var e=[];return this.nodes.forEach(function(t){t.isSelected&&e.push(t)}),e},enumerable:!1,configurable:!0}),r.prototype.getAreaElement=function(e,t,n,o,i){var a=this;n===void 0&&(n=!0),o===void 0&&(o=!0),i===void 0&&(i=!1);var s=[];return W(ot(ot([],q(this.nodes),!1),q(this.edges),!1),function(d){var l=a.isElementInArea(d,e,t,n,o);(!i||d.visible)&&l&&s.push(d)}),s},r.prototype.getModel=function(e){return this.modelMap.get(e)},r.prototype.getNodeModelById=function(e){var t;return this.fakeNode&&e===this.fakeNode.id?this.fakeNode:(t=this.nodesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getPointByClient=function(e){var t=e.x,n=e.y,o=this.rootEl.getBoundingClientRect(),i={x:t-o.left,y:n-o.top},a=q(this.transformModel.HtmlPointToCanvasPoint([i.x,i.y]),2),s=a[0],d=a[1],l={x:s,y:d};return{domOverlayPosition:i,canvasOverlayPosition:l}},r.prototype.isElementInArea=function(e,t,n,o,i){var a;if(o===void 0&&(o=!0),i===void 0&&(i=!0),e.BaseType===U.NODE){e=e;for(var s=nt(e),d=s.minX,l=s.minY,u=s.maxX,f=s.maxY,c=[{x:d,y:l},{x:u,y:l},{x:u,y:f},{x:d,y:f}],h=i,g=0;g<c.length;g++){var p=c[g],v=p.x,y=p.y;if(a=q(this.transformModel.CanvasPointToHtmlPoint([v,y]),2),v=a[0],y=a[1],un([v,y],t,n)!==i){h=!i;break}}return h}if(e.BaseType===U.EDGE){e=e;var _=e.startPoint,M=e.endPoint,S=this.transformModel.CanvasPointToHtmlPoint([_.x,_.y]),O=this.transformModel.CanvasPointToHtmlPoint([M.x,M.y]),w=un(S,t,n),A=un(O,t,n);return o?w&&A:w||A}return!1},r.prototype.graphDataToModel=function(e){var t=this;if((!this.width||!this.height)&&this.resize(),!e){this.nodes=[],this.edges=[];return}if(e.nodes?this.nodes=Ot(e.nodes,function(o){return t.getModelAfterSnapToGrid(o)}):this.nodes=[],e.edges){var n=this.edgeType;this.edges=Ot(e.edges,function(o){var i,a=t.getModel((i=o.type)!==null&&i!==void 0?i:n);if(!a)throw new Error("找不到".concat(o.type,"对应的边。"));var s=new a(o,t);return t.edgeModelMap.set(s.id,s),t.elementsModelMap.set(s.id,s),s})}else this.edges=[]},r.prototype.modelToGraphData=function(){var e=[];this.edges.forEach(function(n){var o=n.getData();o&&!n.virtual&&e.push(o)});var t=[];return this.nodes.forEach(function(n){var o=n.getData();o&&!n.virtual&&t.push(o)}),{nodes:t,edges:e}},r.prototype.modelToHistoryData=function(){for(var e=!1,t=[],n=0;n<this.nodes.length;n++){var o=this.nodes[n];if(o.isDragging){e=!0;break}else t.push(o.getHistoryData())}if(e)return!1;for(var i=!1,a=[],s=0;s<this.edges.length;s++){var d=this.edges[s];if(d.isDragging){i=!0;break}else a.push(d.getHistoryData())}return i?!1:{nodes:t,edges:a}},r.prototype.getEdgeModelById=function(e){var t;return(t=this.edgesMap[e])===null||t===void 0?void 0:t.model},r.prototype.getElement=function(e){return this.modelsMap[e]},r.prototype.getNodeEdges=function(e){for(var t=[],n=0;n<this.edges.length;n++){var o=this.edges[n],i=o.sourceNodeId===e,a=o.targetNodeId===e;(i||a)&&t.push(o)}return t},r.prototype.getSelectElements=function(e){e===void 0&&(e=!0);var t=this.selectElements,n={nodes:[],edges:[]};return t.forEach(function(o){if(o.BaseType===U.NODE&&n.nodes.push(o.getData()),o.BaseType===U.EDGE){var i=o.getData(),a=t.get(i.sourceNodeId)&&t.get(i.targetNodeId);(e||a)&&n.edges.push(i)}}),n},r.prototype.updateAttributes=function(e,t){var n=this.getElement(e);n==null||n.updateAttributes(t)},r.prototype.changeNodeId=function(e,t){return t||(t=It()),this.nodesMap[t]?(console.warn("当前流程图已存在节点".concat(t,", 修改失败")),""):this.nodesMap[e]?(this.edges.forEach(function(n){n.sourceNodeId===e&&(n.sourceNodeId=t),n.targetNodeId===e&&(n.targetNodeId=t)}),this.nodesMap[e].model.id=t,this.nodesMap[t]=this.nodesMap[e],t):(console.warn("当前流程图找不到节点".concat(e,", 修改失败")),"")},r.prototype.changeEdgeId=function(e,t){return t||(t=It()),this.edgesMap[t]?(console.warn("当前流程图已存在边: ".concat(t,", 修改失败")),""):this.edgesMap[e]?(this.edges.forEach(function(n){n.id===e&&n.changeEdgeId(t)}),t):(console.warn("当前流程图找不到边: ".concat(t,", 修改失败")),"")},r.prototype.getTextModel=function(e){var t=this.editConfigModel,n=t.textMode,o=t.nodeTextMode,i=t.edgeTextMode;if(e.BaseType===U.NODE)return e.textMode||o||n||ht.TEXT;if(e.BaseType===U.EDGE)return e.textMode||i||n||ht.TEXT},r.prototype.setTextMode=function(e,t){this.editConfigModel.updateEditConfig({textMode:e})},r.prototype.setFakeNode=function(e){this.fakeNode=e},r.prototype.removeFakeNode=function(){this.fakeNode=null},r.prototype.setModel=function(e,t){return this.modelMap.set(e,t)},r.prototype.toFront=function(e){var t,n,o,i=((t=this.nodesMap[e])===null||t===void 0?void 0:t.model)||((n=this.edgesMap[e])===null||n===void 0?void 0:n.model);i&&(this.overlapMode===ct.DEFAULT&&((o=this.topElement)===null||o===void 0||o.setZIndex(),i.setZIndex(Lo),this.topElement=i),this.overlapMode===ct.INCREASE&&this.setElementZIndex(e,"top"))},r.prototype.setElementZIndex=function(e,t){var n,o,i=((n=this.nodesMap[e])===null||n===void 0?void 0:n.model)||((o=this.edgesMap[e])===null||o===void 0?void 0:o.model);if(i){var a=void 0;typeof t=="number"?a=t:(t==="top"&&(a=Un()),t==="bottom"&&(a=Wi())),i.setZIndex(a)}},r.prototype.deleteNode=function(e){var t=this.nodesMap[e].model.getData();this.deleteEdgeBySource(e),this.deleteEdgeByTarget(e),this.nodes.splice(this.nodesMap[e].index,1),this.eventCenter.emit(T.NODE_DELETE,{data:t})},r.prototype.addNode=function(e,t,n){t===void 0&&(t=T.NODE_ADD);var o=tt(e),i=o.id;i&&this.nodesMap[i]&&delete o.id;var a=this.getModelAfterSnapToGrid(o);this.nodes.push(a);var s=a.getData(),d={data:s};return n&&(d.e=n),this.eventCenter.emit(t,d),a},r.prototype.getModelAfterSnapToGrid=function(e){var t=this.getModel(e.type);if(!t)throw new Error("找不到".concat(e.type,"对应的节点，请确认是否已注册此类型节点。"));var n=e.x,o=e.y;n&&o&&(e.x=te(n,this.gridSize),e.y=te(o,this.gridSize),typeof e.text=="object"&&e.text!==null&&(e.text.x+=e.x-n,e.text.y+=e.y-o));var i=new t(e,this);return this.nodeModelMap.set(i.id,i),this.elementsModelMap.set(i.id,i),i},r.prototype.cloneNode=function(e){var t=this.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){n.x+=30,n.y+=30,n.id="",typeof n.text=="object"&&n.text!==null&&(n.text.x+=30,n.text.y+=30);var o=this.addNode(n);return o.setSelected(!0),t==null||t.setSelected(!1),o.getData()}},r.prototype.moveNode=function(e,t,n,o){var i;o===void 0&&(o=!1);var a=this.nodesMap[e];if(!a){console.warn("不存在id为".concat(e,"的节点"));return}var s=a.model;i=q(s.getMoveDistance(t,n,o),2),t=i[0],n=i[1],this.moveEdge(e,t,n)},r.prototype.moveNode2Coordinate=function(e,t,n,o){o===void 0&&(o=!1);var i=this.nodesMap[e];if(!i){console.warn("不存在id为".concat(e,"的节点"));return}var a=i.model,s=a.x,d=a.y,l=t-s,u=n-d;this.moveNode(e,l,u,o)},r.prototype.editText=function(e){this.setElementStateById(e,B.TEXT_EDIT)},r.prototype.addEdge=function(e){var t=tt(e),n=t.type;n||(n=this.edgeType),t.id&&this.edgesMap[t.id]&&delete t.id;var o=this.getModel(n);if(!o)throw new Error("找不到".concat(n,"对应的边，请确认是否已注册此类型边。"));var i=new o(Kt(Kt({},t),{type:n}),this);this.edgeModelMap.set(i.id,i),this.elementsModelMap.set(i.id,i);var a=i.getData();return this.edges.push(i),this.eventCenter.emit(T.EDGE_ADD,{data:a}),i},r.prototype.moveEdge=function(e,t,n){for(var o=0;o<this.edges.length;o++){var i=this.edges[o],a=i.textPosition,s=a.x,d=a.y,l=this.edges[o].sourceNodeId===e,u=this.edges[o].targetNodeId===e;l&&i.moveStartPoint(t,n),u&&i.moveEndPoint(t,n),(l||u)&&this.handleEdgeTextMove(i,s,d)}},r.prototype.handleEdgeTextMove=function(e,t,n){var o;if(e.customTextPosition){e.resetTextPosition();return}if(e.modelType===j.POLYLINE_EDGE&&(!((o=e.text)===null||o===void 0)&&o.value)){var i=e.text,a=qr(i,e.points);e.moveText(a.x-i.x,a.y-i.y)}var s=e.textPosition,d=s.x,l=s.y;e.moveText(d-t,l-n)},r.prototype.deleteEdgeBySourceAndTarget=function(e,t){for(var n=0;n<this.edges.length;n++)if(this.edges[n].sourceNodeId===e&&this.edges[n].targetNodeId===t){var o=this.edges[n].getData();this.edges.splice(n,1),n--,this.eventCenter.emit(T.EDGE_DELETE,{data:o})}},r.prototype.deleteEdgeById=function(e){var t=this.edgesMap[e];if(t){var n=this.edgesMap[e].index,o=this.edgesMap[e].model.getData();this.edges.splice(n,1),this.eventCenter.emit(T.EDGE_DELETE,{data:o})}},r.prototype.deleteEdgeBySource=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].sourceNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(T.EDGE_DELETE,{data:n})}},r.prototype.deleteEdgeByTarget=function(e){for(var t=0;t<this.edges.length;t++)if(this.edges[t].targetNodeId===e){var n=this.edges[t].getData();this.edges.splice(t,1),t--,this.eventCenter.emit(T.EDGE_DELETE,{data:n})}},r.prototype.setElementStateById=function(e,t,n){this.nodes.forEach(function(o){o.id===e?o.setElementState(t,n):o.setElementState(B.DEFAULT)}),this.edges.forEach(function(o){o.id===e?o.setElementState(t,n):o.setElementState(B.DEFAULT)})},r.prototype.updateText=function(e,t){var n=Bt(ot(ot([],q(this.nodes),!1),q(this.edges),!1),function(o){return o.id===e});n==null||n.updateText(t)},r.prototype.selectNodeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var o=(n=this.nodesMap[e])===null||n===void 0?void 0:n.model;o==null||o.setSelected(!0)},r.prototype.selectEdgeById=function(e,t){var n;t===void 0&&(t=!1),t||this.clearSelectElements();var o=(n=this.edgesMap[e])===null||n===void 0?void 0:n.model;o==null||o.setSelected(!0)},r.prototype.selectElementById=function(e,t){t===void 0&&(t=!1),t||this.clearSelectElements();var n=this.getElement(e);n==null||n.setSelected(!0)},r.prototype.clearSelectElements=function(){var e;this.selectElements.forEach(function(t){t==null||t.setSelected(!1)}),this.selectElements.clear(),this.overlapMode===ct.DEFAULT&&((e=this.topElement)===null||e===void 0||e.setZIndex())},r.prototype.moveNodes=function(e,t,n,o){var i,a,s,d=this;o===void 0&&(o=!1);for(var l=e.reduce(function(M,S){var O,w=(O=d.nodesMap[S])===null||O===void 0?void 0:O.model;return w&&(M[S]=w.getMoveDistance(t,n,o)),M},{}),u=0;u<this.edges.length;u++){var f=this.edges[u],c=f.textPosition,h=c.x,g=c.y,p=l[f.sourceNodeId],v=l[f.targetNodeId],y=void 0,_=void 0;p&&v&&f.modelType===j.POLYLINE_EDGE?(i=q(p,2),y=i[0],_=i[1],f.updatePointsList(y,_)):(p&&(a=q(p,2),y=a[0],_=a[1],f.moveStartPoint(y,_)),v&&(s=q(v,2),y=s[0],_=s[1],f.moveEndPoint(y,_))),(p||v)&&this.handleEdgeTextMove(f,h,g)}},r.prototype.addNodeMoveRules=function(e){this.nodeMoveRules.includes(e)||this.nodeMoveRules.push(e)},r.prototype.addNodeResizeRules=function(e){this.nodeResizeRules.includes(e)||this.nodeResizeRules.push(e)},r.prototype.setDefaultEdgeType=function(e){this.edgeType=e},r.prototype.changeNodeType=function(e,t){var n=this.getNodeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的节点"));return}var o=n.getData();o.type=t;var i=this.getModel(t);if(!i)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));var a=new i(o,this);this.nodes.splice(this.nodesMap[e].index,1,a);var s=this.getNodeEdges(e);s.forEach(function(d){if(d.sourceNodeId===e){var l=pr(a,d.startPoint,a.width,a.height);d.updateStartPoint(l)}if(d.targetNodeId===e){var l=pr(a,d.endPoint,a.width,a.height);d.updateEndPoint(l)}})},r.prototype.changeEdgeType=function(e,t){var n=this.getEdgeModelById(e);if(!n){console.warn("找不到id为".concat(e,"的边"));return}if(n.type!==t){var o=n.getData();o.type=t;var i=this.getModel(t);if(!i)throw new Error("找不到".concat(t,"对应的节点，请确认是否已注册此类型节点。"));delete o.pointsList;var a=new i(o,this);this.edges.splice(this.edgesMap[e].index,1,a)}},r.prototype.getNodeIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetNodeId===e&&t.push(n)}),t},r.prototype.getNodeOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceNodeId===e&&t.push(n)}),t},r.prototype.getAnchorIncomingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.targetAnchorId===e&&t.push(n)}),t},r.prototype.getAnchorOutgoingEdge=function(e){var t=[];return this.edges.forEach(function(n){n.sourceAnchorId===e&&t.push(n)}),t},r.prototype.getNodeIncomingNode=function(e){var t=this,n=[];return this.edges.forEach(function(o){var i;o.targetNodeId===e&&n.push((i=t.nodesMap[o.sourceNodeId])===null||i===void 0?void 0:i.model)}),n},r.prototype.getNodeOutgoingNode=function(e){var t=this,n=[];return this.edges.forEach(function(o){o.sourceNodeId===e&&n.push(t.nodesMap[o.targetNodeId].model)}),n},r.prototype.setTheme=function(e){this.theme=Fi(Kt(Kt({},this.theme),e))},r.prototype.resize=function(e,t){this.width=e||this.rootEl.getBoundingClientRect().width,this.height=t||this.rootEl.getBoundingClientRect().height,(!this.width||!this.height)&&console.warn("渲染画布的时候无法获取画布宽高，请确认在container已挂载到DOM。@see https://github.com/didi/LogicFlow/issues/675")},r.prototype.clearData=function(){this.nodes=[],this.edges=[]},r.prototype.getVirtualRectSize=function(){var e=this.nodes,t=[],n=[];e.forEach(function(c){var h=c.x,g=c.y,p=c.width,v=c.height,y=c.getNodeStyle().strokeWidth,_=y===void 0?0:y,M=h+p/2+_,S=h-p/2-_,O=g+v/2+_,w=g-v/2-_;t=t.concat([M,S].filter(function(A){return!Number.isNaN(A)})),n=n.concat([O,w].filter(function(A){return!Number.isNaN(A)}))});var o=Math.min.apply(Math,ot([],q(t),!1)),i=Math.max.apply(Math,ot([],q(t),!1)),a=Math.min.apply(Math,ot([],q(n),!1)),s=Math.max.apply(Math,ot([],q(n),!1)),d=i-o||0,l=s-a||0,u=o+d/2,f=a+l/2;return{width:d,height:l,x:u,y:f}},r.prototype.translateCenter=function(){var e=this,t=e.nodes,n=e.width,o=e.height,i=e.rootEl,a=e.transformModel;if(t.length){var s=n||i.clientWidth,d=o||i.clientHeight,l=this.getVirtualRectSize(),u=l.x,f=l.y;a.focusOn(u,f,s,d)}},r.prototype.fitView=function(e,t){e===void 0&&(e=20),t===void 0&&(t=20);var n=this,o=n.nodes,i=n.width,a=n.height,s=n.rootEl,d=n.transformModel;if(o.length){var l=i||s.clientWidth,u=a||s.clientHeight,f=this.getVirtualRectSize(),c=f.width,h=f.height,g=f.x,p=f.y,v=(c+t)/l,y=(h+e)/u,_=1/Math.max(v,y),M=[l/2,u/2];d.zoom(_,M),d.focusOn(g,p,l,u)}},r.prototype.openEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.openEdgeAnimation()},r.prototype.closeEdgeAnimation=function(e){var t=this.getEdgeModelById(e);t==null||t.closeEdgeAnimation()},r.prototype.getPartial=function(){return this.partial},r.prototype.setPartial=function(e){this.partial=e},P([E],r.prototype,"width",void 0),P([E],r.prototype,"height",void 0),P([E],r.prototype,"edgeType",void 0),P([E],r.prototype,"nodes",void 0),P([E],r.prototype,"edges",void 0),P([E],r.prototype,"fakeNode",void 0),P([E],r.prototype,"overlapMode",void 0),P([E],r.prototype,"background",void 0),P([E],r.prototype,"gridSize",void 0),P([E],r.prototype,"transformModel",void 0),P([E],r.prototype,"editConfigModel",void 0),P([E],r.prototype,"partial",void 0),P([$],r.prototype,"nodesMap",null),P([$],r.prototype,"edgesMap",null),P([$],r.prototype,"modelsMap",null),P([$],r.prototype,"sortElements",null),P([$],r.prototype,"textEditElement",null),P([$],r.prototype,"selectElements",null),P([$],r.prototype,"selectNodes",null),P([m],r.prototype,"setTextMode",null),P([m],r.prototype,"setFakeNode",null),P([m],r.prototype,"removeFakeNode",null),P([m],r.prototype,"setModel",null),P([m],r.prototype,"toFront",null),P([m],r.prototype,"setElementZIndex",null),P([m],r.prototype,"deleteNode",null),P([m],r.prototype,"addNode",null),P([m],r.prototype,"cloneNode",null),P([m],r.prototype,"moveNode",null),P([m],r.prototype,"moveNode2Coordinate",null),P([m],r.prototype,"editText",null),P([m],r.prototype,"addEdge",null),P([m],r.prototype,"moveEdge",null),P([m],r.prototype,"deleteEdgeBySourceAndTarget",null),P([m],r.prototype,"deleteEdgeById",null),P([m],r.prototype,"deleteEdgeBySource",null),P([m],r.prototype,"deleteEdgeByTarget",null),P([m],r.prototype,"setElementStateById",null),P([m],r.prototype,"updateText",null),P([m],r.prototype,"selectNodeById",null),P([m],r.prototype,"selectEdgeById",null),P([m],r.prototype,"selectElementById",null),P([m],r.prototype,"clearSelectElements",null),P([m],r.prototype,"moveNodes",null),P([m],r.prototype,"setDefaultEdgeType",null),P([m],r.prototype,"changeNodeType",null),P([m],r.prototype,"changeEdgeType",null),P([m],r.prototype,"getNodeIncomingEdge",null),P([m],r.prototype,"getNodeOutgoingEdge",null),P([m],r.prototype,"getAnchorIncomingEdge",null),P([m],r.prototype,"getAnchorOutgoingEdge",null),P([m],r.prototype,"getNodeIncomingNode",null),P([m],r.prototype,"getNodeOutgoingNode",null),P([m],r.prototype,"setTheme",null),P([m],r.prototype,"resize",null),P([m],r.prototype,"clearData",null),P([m],r.prototype,"translateCenter",null),P([m],r.prototype,"fitView",null),P([m],r.prototype,"openEdgeAnimation",null),P([m],r.prototype,"closeEdgeAnimation",null),P([m],r.prototype,"setPartial",null),r}(),jt=function(){return jt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},jt.apply(this,arguments)},oe=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},ga=function(){function r(e){this.isShowHorizontal=!1,this.isShowVertical=!1,this.position={x:0,y:0},this.graphModel=e}return r.prototype.getStyle=function(){return jt({},this.graphModel.theme.snapline)},r.prototype.getCenterSnapLine=function(e,t){for(var n=e.x,o=e.y,i=!1,a=!1,s=0;s<t.length;s++){var d=t[s];if(d.id!==e.id&&(n===d.x&&(i=!0),o===d.y&&(a=!0),i&&a))break}return{isShowVertical:i,isShowHorizontal:a,position:{x:n,y:o}}},r.prototype.getHorizontalSnapline=function(e,t){var n=!1,o=0,i=e.id,a;if(i){var s=this.graphModel.fakeNode;if(s&&s.id===i)a=nt(s);else{var d=this.graphModel.getNodeModelById(i);d&&(a=nt(d))}}for(var l=0;l<t.length;l++){var u=t[l];if(u.id!==e.id){var f=nt(u);if(f.minY===(a==null?void 0:a.minY)||f.maxY===(a==null?void 0:a.minY)){n=!0,o=a.minY;break}if(f.minY===(a==null?void 0:a.maxY)||f.maxY===(a==null?void 0:a.maxY)){n=!0,o=a.maxY;break}}}return{isShowHorizontal:n,isShowVertical:this.isShowVertical,position:jt(jt({},this.position),{y:o})}},r.prototype.getVerticalSnapline=function(e,t){var n=!1,o=0,i=e.id,a;if(i){var s=this.graphModel.fakeNode;if(s&&s.id===i)a=nt(s);else{var d=this.graphModel.getNodeModelById(i);d&&(a=nt(d))}}for(var l=0;l<t.length;l++){var u=t[l];if(u.id!==e.id){var f=nt(u);if(f.minX===(a==null?void 0:a.minX)||f.maxX===(a==null?void 0:a.minX)){n=!0,o=a.minX;break}if(f.minX===(a==null?void 0:a.maxX)||f.maxX===(a==null?void 0:a.maxX)){n=!0,o=a.maxX;break}}}return{isShowHorizontal:this.isShowHorizontal,isShowVertical:n,position:jt(jt({},this.position),{x:o})}},r.prototype.getSnapLinePosition=function(e,t){var n=this.getCenterSnapLine(e,t),o=n.isShowHorizontal,i=n.isShowVertical;if(!o){var a=this.getHorizontalSnapline(e,t);a.isShowHorizontal&&(n.isShowHorizontal=a.isShowHorizontal,n.position.y=a.position.y)}if(!i){var s=this.getVerticalSnapline(e,t);s.isShowVertical&&(n.isShowVertical=s.isShowVertical,n.position.x=s.position.x)}return n},r.prototype.setSnaplineInfo=function(e){var t=e.isShowHorizontal,n=e.isShowVertical,o=e.position;this.position=o,this.isShowHorizontal=t,this.isShowVertical=n},r.prototype.clearSnapline=function(){this.position={x:0,y:0},this.isShowHorizontal=!1,this.isShowVertical=!1},r.prototype.setNodeSnapLine=function(e){var t=this.graphModel.nodes,n=this.getSnapLinePosition(e,t);this.setSnaplineInfo(n)},oe([E],r.prototype,"isShowHorizontal",void 0),oe([E],r.prototype,"isShowVertical",void 0),oe([E],r.prototype,"position",void 0),oe([m],r.prototype,"clearSnapline",null),oe([m],r.prototype,"setNodeSnapLine",null),r}(),lt=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ut=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},va={false:[-1/0,-1/0,1/0,1/0],true:[-1/0,-1/0,1/0,1/0],vertical:[-1/0,0,1/0,0],horizontal:[0,-1/0,0,1/0]},_a=function(){function r(e,t){this.MINI_SCALE_SIZE=.2,this.MAX_SCALE_SIZE=16,this.SCALE_X=1,this.SKEW_Y=0,this.SKEW_X=0,this.SCALE_Y=1,this.TRANSLATE_X=0,this.TRANSLATE_Y=0,this.ZOOM_SIZE=.04,this.translateLimitMinX=-1/0,this.translateLimitMinY=-1/0,this.translateLimitMaxX=1/0,this.translateLimitMaxY=1/0,this.eventCenter=e;var n=t.stopMoveGraph,o=n===void 0?!1:n;this.updateTranslateLimits(o)}return r.prototype.setZoomMiniSize=function(e){this.MINI_SCALE_SIZE=e},r.prototype.setZoomMaxSize=function(e){this.MAX_SCALE_SIZE=e},r.prototype.HtmlPointToCanvasPoint=function(e){var t=Ut(e,2),n=t[0],o=t[1];return[(n-this.TRANSLATE_X)/this.SCALE_X,(o-this.TRANSLATE_Y)/this.SCALE_Y]},r.prototype.CanvasPointToHtmlPoint=function(e){var t=Ut(e,2),n=t[0],o=t[1];return[n*this.SCALE_X+this.TRANSLATE_X,o*this.SCALE_Y+this.TRANSLATE_Y]},r.prototype.moveCanvasPointByHtml=function(e,t,n){var o=Ut(e,2),i=o[0],a=o[1];return[i+t/this.SCALE_X,a+n/this.SCALE_Y]},r.prototype.fixDeltaXY=function(e,t){return[e/this.SCALE_X,t/this.SCALE_Y]},r.prototype.getTransformStyle=function(){var e=[this.SCALE_X,this.SKEW_Y,this.SKEW_X,this.SCALE_Y,this.TRANSLATE_X,this.TRANSLATE_Y].join(",");return{transform:"matrix(".concat(e,")")}},r.prototype.zoom=function(e,t){e===void 0&&(e=!1);var n=this.SCALE_X,o=this.SCALE_Y;return typeof e=="number"?(n=e,o=e):e?(n+=this.ZOOM_SIZE,o+=this.ZOOM_SIZE):(n-=this.ZOOM_SIZE,o-=this.ZOOM_SIZE),n<this.MINI_SCALE_SIZE||n>this.MAX_SCALE_SIZE?"".concat(this.SCALE_X*100,"%"):(t&&(this.TRANSLATE_X-=(n-this.SCALE_X)*t[0],this.TRANSLATE_Y-=(o-this.SCALE_Y)*t[1]),this.SCALE_X=n,this.SCALE_Y=o,this.emitGraphTransform("zoom"),"".concat(this.SCALE_X*100,"%"))},r.prototype.emitGraphTransform=function(e){this.eventCenter.emit(T.GRAPH_TRANSFORM,{type:e,transform:{SCALE_X:this.SCALE_X,SKEW_Y:this.SKEW_Y,SKEW_X:this.SKEW_X,SCALE_Y:this.SCALE_Y,TRANSLATE_X:this.TRANSLATE_X,TRANSLATE_Y:this.TRANSLATE_Y}})},r.prototype.resetZoom=function(){this.SCALE_X=1,this.SCALE_Y=1,this.emitGraphTransform("resetZoom")},r.prototype.translate=function(e,t){this.TRANSLATE_X+e<=this.translateLimitMaxX&&this.TRANSLATE_X+e>=this.translateLimitMinX&&(this.TRANSLATE_X+=e),this.TRANSLATE_Y+t<=this.translateLimitMaxY&&this.TRANSLATE_Y+t>=this.translateLimitMinY&&(this.TRANSLATE_Y+=t),this.emitGraphTransform("translate")},r.prototype.focusOn=function(e,t,n,o){var i=Ut(this.CanvasPointToHtmlPoint([e,t]),2),a=i[0],s=i[1],d=Ut([n/2-a,o/2-s],2),l=d[0],u=d[1];this.TRANSLATE_X+=l,this.TRANSLATE_Y+=u,this.emitGraphTransform("focusOn")},r.prototype.updateTranslateLimits=function(e){var t;t=Ut(Array.isArray(e)&&e.length===4?e:va[e.toString()],4),this.translateLimitMinX=t[0],this.translateLimitMinY=t[1],this.translateLimitMaxX=t[2],this.translateLimitMaxY=t[3]},lt([E],r.prototype,"SCALE_X",void 0),lt([E],r.prototype,"SKEW_Y",void 0),lt([E],r.prototype,"SKEW_X",void 0),lt([E],r.prototype,"SCALE_Y",void 0),lt([E],r.prototype,"TRANSLATE_X",void 0),lt([E],r.prototype,"TRANSLATE_Y",void 0),lt([E],r.prototype,"ZOOM_SIZE",void 0),lt([m],r.prototype,"zoom",null),lt([m],r.prototype,"resetZoom",null),lt([m],r.prototype,"translate",null),lt([m],r.prototype,"focusOn",null),r}(),ma=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Dn=function(){return Dn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Dn.apply(this,arguments)},xa=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ea=function(r){ma(e,r);function e(t){var n=r.call(this)||this;n.stepScrollX=0,n.stepScrollY=0,n.onDragging=function(s){var d=s.deltaX,l=s.deltaY;n.setState({isDragging:!0});var u=n.props.graphModel,f=u.transformModel,c=u.editConfigModel;c.stopMoveGraph!==!0&&f.translate(d,l)},n.onDragEnd=function(){n.setState({isDragging:!1})},n.zoomHandler=function(s){var d=n.props,l=d.graphModel,u=l.editConfigModel,f=l.transformModel,c=l.gridSize,h=d.graphModel,g=s.deltaX,p=s.deltaY;if(!u.stopScrollGraph&&!s.ctrlKey&&!s.metaKey){if(s.preventDefault(),n.stepScrollX+=g,n.stepScrollY+=p,Math.abs(n.stepScrollX)>=c){var v=n.stepScrollX%c,y=n.stepScrollX-v;f.translate(-y*f.SCALE_X,0),n.stepScrollX=v}if(Math.abs(n.stepScrollY)>=c){var _=n.stepScrollY%c,M=n.stepScrollY-_;f.translate(0,-M*f.SCALE_Y),n.stepScrollY=_}return}if(!u.stopZoomGraph){s.preventDefault();var S=h.getPointByClient({x:s.clientX,y:s.clientY}),O=S.canvasOverlayPosition,w=O.x,A=O.y;f.zoom(s.deltaY<0,[w,A])}},n.clickHandler=function(s){var d=s.target;if(d.getAttribute("name")==="canvas-overlay"){var l=n.props.graphModel,u=l.selectElements;u.size>0&&l.clearSelectElements(),l.eventCenter.emit(T.BLANK_CLICK,{e:s})}},n.handleContextMenu=function(s){var d=s.target;if(d.getAttribute("name")==="canvas-overlay"){s.preventDefault();var l=n.props.graphModel,u=l.getPointByClient({x:s.clientX,y:s.clientY});l.eventCenter.emit(T.BLANK_CONTEXTMENU,{e:s,position:u})}},n.mouseDownHandler=function(s){var d=n.props.graphModel,l=d.eventCenter,u=d.editConfigModel,f=d.transformModel.SCALE_X,c=d.gridSize,h=s.target,g=!u.adjustEdge&&!u.adjustNodePosition;(h.getAttribute("name")==="canvas-overlay"||g)&&(u.stopMoveGraph!==!0?(n.stepDrag.setStep(c*f),n.stepDrag.handleMouseDown(s)):l.emit(T.BLANK_MOUSEDOWN,{e:s}),n.clickHandler(s))};var o=t.graphModel,i=o.gridSize,a=o.eventCenter;return n.stepDrag=new xt({onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:i,eventType:"BLANK",isStopPropagation:!1,eventCenter:a,model:void 0}),n.state={isDragging:!1},n}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,o=this.props,i=o.children,a=o.dnd,s=this.state.isDragging;return x("svg",Dn({xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",name:"canvas-overlay",onWheel:this.zoomHandler,onMouseDown:this.mouseDownHandler,onContextMenu:this.handleContextMenu,className:s?"lf-canvas-overlay lf-dragging":"lf-canvas-overlay lf-drag-able"},a.eventMap(),{children:x("g",{transform:n,children:i})}))},e=xa([at],e),e}(V),ao=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),we=function(){return we=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},we.apply(this,arguments)},Ma=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Oa=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Nr=function(r){ao(e,r);function e(){var t=r.call(this)||this;return t.onDragging=function(n){var o=n.event,i=t.props,a=i.graphModel,s=i.bezierModel,d=i.type,l=a.getPointByClient({x:o.clientX,y:o.clientY}).canvasOverlayPosition,u=l.x,f=l.y;s.updateAdjustAnchor({x:u,y:f},d),a.eventCenter.emit(T.EDGE_ADJUST,{data:s.getData()})},t.onDragEnd=function(){var n=t.props.bezierModel;n.isDragging=!1},t.dragHandler=new xt({onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.render=function(){var t=this,n=this.props.position,o=n.x,i=n.y,a=this.props.bezierModel,s=a.getEdgeStyle().adjustAnchor;return x(ne,we({className:"lf-bezier-adjust-anchor",x:o,y:i},s,{onMouseDown:function(d){t.dragHandler.handleMouseDown(d)}}))},e}(V),Sa=function(r){ao(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBezierAdjust=function(t,n){var o=t.path,i=t.id,a=Fn(o),s=Oa(a,4),d=s[0],l=s[1],u=s[2],f=s[3],c=t.getEdgeStyle().adjustLine,h=[];return h.push(x(ee,we({x1:d.x,y1:d.y,x2:l.x,y2:l.y},c))),h.push(x(Nr,{position:l,bezierModel:t,graphModel:n,type:"sNext"},"".concat(i,"_ePre"))),h.push(x(ee,we({x1:f.x,y1:f.y,x2:u.x,y2:u.y},c))),h.push(x(Nr,{position:u,bezierModel:t,graphModel:n,type:"ePre"},"".concat(i,"_sNext"))),h},e.prototype.selectedBezierEdge=function(){for(var t=this.props.graphModel,n=t.edges,o=[],i=0;i<n.length;i++){var a=n[i];a.isSelected&&a.modelType===j.BEZIER_EDGE&&a.draggable&&o.push(this.getBezierAdjust(a,t))}return o},e.prototype.render=function(){return x("g",{className:"lf-bezier-adjust",children:this.selectedBezierEdge()})},e=Ma([at],e),e}(V),wa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Aa=function(r){wa(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.background;return x("div",{className:"lf-background",children:x("div",{style:t,className:"lf-background-area"})})},e}(V),Pa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ta=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Na=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Da=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},qe=function(r){Pa(e,r);function e(){var t=r.apply(this,Da([],Na(arguments),!1))||this;return t.id=It(),t}return e.prototype.renderDot=function(){var t=this.props,n=t.config,o=t.size,i=o===void 0?1:o,a=t.visible,s=n??{},d=s.color,l=s.thickness,u=l===void 0?2:l,f=Math.min(Math.max(2,u),i/4),c=a?1:0;return x("g",{fill:d,opacity:c,children:[x("circle",{cx:0,cy:0,r:f/2}),x("circle",{cx:0,cy:i,r:f/2}),x("circle",{cx:i,cy:0,r:f/2}),x("circle",{cx:i,cy:i,r:f/2})]})},e.prototype.renderMesh=function(){var t=this.props,n=t.config,o=t.size,i=o===void 0?1:o,a=t.visible,s=n??{},d=s.color,l=s.thickness,u=l===void 0?1:l,f=Math.min(Math.max(1,u),i/2),c="M 0 0 H ".concat(i," V ").concat(i," H 0 Z"),h=a?1:0;return x("path",{d:c,stroke:d,strokeWidth:f,opacity:h,fill:"transparent"})},e.prototype.render=function(){var t=this.props,n=t.type,o=t.size,i=o===void 0?1:o,a=t.graphModel.transformModel,s=a.SCALE_X,d=a.SKEW_Y,l=a.SKEW_X,u=a.SCALE_Y,f=a.TRANSLATE_X,c=a.TRANSLATE_Y,h=[s,d,l,u,f,c].join(","),g="matrix(".concat(h,")");return x("div",{className:"lf-grid",children:x("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",children:[x("defs",{children:x("pattern",{id:this.id,patternUnits:"userSpaceOnUse",patternTransform:g,x:"0",y:"0",width:i,height:i,children:[n==="dot"&&this.renderDot(),n==="mesh"&&this.renderMesh()]})}),x("rect",{width:"100%",height:"100%",fill:"url(#".concat(this.id,")")})]})})},e=Ta([at],e),e}(V);(function(r){r.defaultProps={size:jo,visible:!0,type:"dot",config:{color:"#ababab",thickness:1}};function e(t){var n=b(r.defaultProps);return typeof t=="number"?z(n,{size:t}):typeof t=="boolean"?z(n,{visible:t}):z(n,t)}r.getGridOptions=e})(qe||(qe={}));var ba=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ca=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},La=function(r){ba(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.graphModel.transformModel,n=t.getTransformStyle().transform,o=this.props.children;return x("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%",className:"modification-overlay",children:x("g",{transform:n,children:o})})},e=Ca([at],e),e}(V),ja=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),St=function(){return St=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},St.apply(this,arguments)},Ra=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ia=function(r){ja(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getNodesOutline=function(){var t=this.props.graphModel,n=t.nodes,o=t.editConfigModel,i=o.hoverOutline,a=o.nodeSelectedOutline,s=[];return n.forEach(function(d){if(d.isHovered||d.isSelected){var l=d.isHovered,u=d.isSelected,f=d.x,c=d.y,h=d.width,g=d.height;if(a&&u||i&&l){var p=d.getOutlineStyle(),v={};if(Object.keys(p).forEach(function(_){_!=="hover"&&(v[_]=p[_])}),l){var y=p.hover;v=St(St({},v),y)}s.push(x(mt,St({transform:d.transform,className:"lf-outline-node",x:f,y:c,width:h+10,height:g+10},v)))}}}),s},e.prototype.getEdgeOutline=function(){for(var t=this.props.graphModel,n=t.edges,o=t.editConfigModel,i=o.edgeSelectedOutline,a=o.hoverOutline,s=[],d=0;d<n.length;d++){var l=n[d];(i&&l.isSelected||a&&l.isHovered)&&(l.modelType===j.LINE_EDGE?s.push(this.getLineOutline(l)):l.modelType===j.POLYLINE_EDGE?s.push(this.getPolylineOutline(l)):l.modelType===j.BEZIER_EDGE&&s.push(this.getBezierOutline(l)))}return s},e.prototype.getLineOutline=function(t){var n=t.startPoint,o=t.endPoint,i=(n.x+o.x)/2,a=(n.y+o.y)/2,s=Math.abs(n.x-o.x)+10,d=Math.abs(n.y-o.y)+10,l=t.getOutlineStyle();return x(mt,St({className:"lf-outline-edge",x:i,y:a,width:s,height:d},l))},e.prototype.getPolylineOutline=function(t){var n=t.points,o=Xt(n),i=Ee(o,8),a=i.x,s=i.y,d=i.width,l=i.height,u=t.getOutlineStyle();return x(mt,St({className:"lf-outline",x:a,y:s,width:d,height:l},u))},e.prototype.getBezierOutline=function(t){var n=t.path,o=Fn(n),i=Ee(o,8),a=i.x,s=i.y,d=i.width,l=i.height,u=t.getOutlineStyle();return x(mt,St({className:"lf-outline",x:a,y:s,width:d,height:l},u))},e.prototype.render=function(){return x("g",{className:"lf-outline",children:[this.getNodesOutline(),this.getEdgeOutline()]})},e=Ra([at],e),e}(V),Ba=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),wt=function(){return wt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},wt.apply(this,arguments)},Xa=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ya=function(r){Ba(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(){var t=this.props.snaplineModel,n=t??{},o=n.position,i=n.isShowHorizontal,a=n.isShowVertical,s=t==null?void 0:t.getStyle(),d=o??{},l=d.x,u=l===void 0?0:l,f=d.y,c=f===void 0?0:f,h=wt(wt({x1:-1e5,y1:c,x2:1e5,y2:c},s),{stroke:i?s==null?void 0:s.stroke:"none"}),g=wt(wt({x1:u,y1:-1e5,x2:u,y2:1e5},s),{stroke:a?s==null?void 0:s.stroke:"none"});return x("g",{className:"lf-snapline",children:[x(ee,wt({},h)),x(ee,wt({},g))]})},e=Xa([at],e),e}(V),Ha=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ka=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},za=function(r){Ha(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.componentDidMount=function(){this.triggerToolRender()},e.prototype.componentDidUpdate=function(){this.triggerToolRender()},e.prototype.getTools=function(){var t=this.props,n=t.tool,o=t.graphModel,i=o.textEditElement,a=n.getTools(),s=a.map(function(d){return Gr(d,{textEditElement:i,graphModel:o,lf:n.instance})});return n.components=s,s},e.prototype.triggerToolRender=function(){var t=this.props,n=t.tool,o=t.graphModel,i=document.querySelector("#ToolOverlay_".concat(o.flowId)),a=n.getInstance();a.components.forEach(function(s){return s(a,i)}),a.components=[]},e.prototype.render=function(){var t=this.props.graphModel;return x("div",{className:"lf-tool-overlay",id:"ToolOverlay_".concat(t.flowId),children:this.getTools()})},e=ka([at],e),e}(V),Ga=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),bn=function(){return bn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},bn.apply(this,arguments)},Fa=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},$a=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Ua=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},Wa=function(r){Ga(e,r);function e(){var t=r.apply(this,Ua([],$a(arguments),!1))||this;return t.handleResize=function(){t.props.graphModel.resize()},t.throttleResize=function(){return go(t.handleResize,200)},t}return e.prototype.componentDidMount=function(){window.addEventListener("resize",this.throttleResize)},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel.modelToGraphData();this.props.graphModel.eventCenter.emit(T.GRAPH_UPDATED,{data:t})},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.throttleResize)},e.prototype.getComponent=function(t,n,o){o===void 0&&(o="canvas-overlay");var i=this.props.getView,a=i(t.type);return a?x(a,{model:t,graphModel:n,overlay:o},t.id):null},e.prototype.render=function(){var t=this,n=this.props,o=n.graphModel,i=n.tool,a=n.options,s=n.dnd,d=n.snaplineModel;a.width&&"".concat(o.width,"px"),a.height&&"".concat(o.height,"px");var l=a.grid&&qe.getGridOptions(a.grid),u=o.fakeNode,f=o.editConfigModel,c=f.adjustEdge;return x("div",{className:"lf-graph","flow-id":o.flowId,children:[x(Ea,{graphModel:o,dnd:s,children:[x("g",{className:"lf-base",children:Ot(o.sortElements,function(h){return t.getComponent(h,o)})}),u?this.getComponent(u,o):""]}),x(La,{graphModel:o,children:[x(Ia,{graphModel:o}),c?x(Sa,{graphModel:o}):"",a.snapline!==!1?x(Ya,{snaplineModel:d}):""]}),x(za,{graphModel:o,tool:i}),a.background&&x(Aa,{background:a.background}),l&&x(qe,bn({},l,{graphModel:o}))]})},e=Fa([at],e),e}(V),Za=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gt=function(){return gt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},gt.apply(this,arguments)},Va=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Ka=function(r){Za(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(n){var o=n.event,i=t.props,a=i.anchorData,s=i.nodeModel,d=i.graphModel;d.selectNodeById(s.id),s.autoToFront&&d.toFront(s.id),d.eventCenter.emit(T.ANCHOR_DRAGSTART,{data:a,e:o,nodeModel:s}),t.setState({startX:a.x,startY:a.y,endX:a.x,endY:a.y})},t.onDragging=function(n){var o=n.event,i=t.props,a=i.graphModel,s=i.nodeModel,d=i.anchorData,l=a.transformModel,u=a.eventCenter,f=a.width,c=a.height,h=a.editConfigModel,g=h.autoExpand,p=h.stopMoveGraph;if(o){var v=o.clientX,y=o.clientY,_=a.getPointByClient({x:v,y}),M=_.domOverlayPosition,S=M.x,O=M.y,w=_.canvasOverlayPosition,A=w.x,C=w.y;t.t&&Ke(t.t);var I=[],L=10;S<10?I=[L,0]:S+10>f?I=[-10,0]:O<10?I=[0,L]:O+10>c&&(I=[0,-10]),t.setState({endX:A,endY:C,dragging:!0}),t.moveAnchorEnd(A,C),I.length>0&&!p&&g&&(t.t=eo(function(){var G=Va(I,2),R=G[0],Y=G[1];l.translate(R,Y);var H=t.state,rt=H.endX,st=H.endY;t.setState({endX:rt-R,endY:st-Y}),t.moveAnchorEnd(rt-R,st-Y)})),u.emit(T.ANCHOR_DRAG,{data:d,e:o,nodeModel:s})}},t.onDragEnd=function(n){var o=n.event;t.t&&Ke(t.t);var i=t.checkEnd(o);t.setState({startX:0,startY:0,endX:0,endY:0,dragging:!1}),t.sourceRuleResults.clear(),t.targetRuleResults.clear();var a=t.props,s=a.graphModel,d=a.nodeModel,l=a.anchorData;i&&s.eventCenter.emit(T.ANCHOR_DRAGEND,{data:l,e:o,nodeModel:d,edgeModel:i})},t.checkEnd=function(n){var o,i=t.props,a=i.graphModel,s=i.nodeModel,d=i.anchorData,l=d.x,u=d.y,f=d.id,c=t.state,h=c.endX,g=c.endY,p=c.dragging,v=Ze({x:h,y:g},a);if(t.preTargetNode&&t.preTargetNode.state!==B.DEFAULT&&t.preTargetNode.setElementState(B.DEFAULT),!!p&&v&&v.node){var y=v.node,_=v.anchor.id,M="".concat(s.id,"_").concat(y.id,"_").concat(_,"_").concat(f),S=t.sourceRuleResults.get(M)||{},O=S.isAllPass,w=S.msg,A=t.targetRuleResults.get(M)||{},C=A.isAllPass,I=A.msg;if(O&&C){y.setElementState(B.DEFAULT);var L=a.getNodeModelById(v.node.id),G=(o=a.edgeGenerator)===null||o===void 0?void 0:o.call(a,s.getData(),L==null?void 0:L.getData()),R=a.addEdge(gt(gt({},G),{sourceNodeId:s.id,sourceAnchorId:f,startPoint:{x:l,y:u},targetNodeId:v.node.id,targetAnchorId:v.anchor.id,endPoint:{x:v.anchor.x,y:v.anchor.y}})),Y=t.props.anchorData;return a.eventCenter.emit(T.ANCHOR_DROP,{data:Y,e:n,nodeModel:s,edgeModel:R}),R}var H=y.getData();return a.eventCenter.emit(T.CONNECTION_NOT_ALLOWED,{data:H,msg:I||w||"不允许添加连线"}),null}},t.sourceRuleResults=new Map,t.targetRuleResults=new Map,t.state={startX:0,startY:0,endX:0,endY:0,dragging:!1},t.dragHandler=new xt({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd}),t}return e.prototype.getAnchorShape=function(){var t=this.props,n=t.anchorData,o=t.style,i=t.node,a=i.getAnchorShape(n);if(a)return a;var s=n.x,d=n.y,l=gt(gt({},o),o==null?void 0:o.hover);return x("g",{children:[x(ne,gt({className:"lf-node-anchor-hover"},l,{x:s,y:d})),x(ne,gt({className:"lf-node-anchor"},o,{x:s,y:d}))]})},Object.defineProperty(e.prototype,"customTrajectory",{get:function(){var t=this.props.graphModel.customTrajectory;return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relateEdges",{get:function(){var t=this.props,n=t.graphModel,o=n.getAnchorIncomingEdge,i=n.getAnchorOutgoingEdge,a=t.anchorData.id;return{incomingEdgeList:o(a),outgoingEdgeList:i(a)}},enumerable:!1,configurable:!0}),e.prototype.moveAnchorEnd=function(t,n){var o,i,a=this.props,s=a.graphModel,d=a.nodeModel,l=a.anchorData,u=Ze({x:t,y:n},s);if(u){var f=u.node,c=u.anchor.id;if(this.preTargetNode&&this.preTargetNode!==u.node&&this.preTargetNode.setElementState(B.DEFAULT),l.id===c)return;this.preTargetNode=f;var h="".concat(d.id,"_").concat(f.id,"_").concat(c,"_").concat(l.id);if(!this.targetRuleResults.has(h)){var g=u.anchor,p=d.isAllowConnectedAsSource(f,l,g),v=f.isAllowConnectedAsTarget(d,l,g);this.sourceRuleResults.set(h,Ve(p)),this.targetRuleResults.set(h,Ve(v))}var y=((o=this.sourceRuleResults.get(h))!==null&&o!==void 0?o:{}).isAllPass,_=((i=this.targetRuleResults.get(h))!==null&&i!==void 0?i:{}).isAllPass;y&&_?f.setElementState(B.ALLOW_CONNECT):f.setElementState(B.NOT_ALLOW_CONNECT)}else this.preTargetNode&&this.preTargetNode.state!==B.DEFAULT&&this.preTargetNode.setElementState(B.DEFAULT)},e.prototype.isShowLine=function(){var t=this.state,n=t.startX,o=t.startY,i=t.endX,a=t.endY,s=pt(n,o,i,a);return s>10},e.prototype.render=function(){var t=this,n=this.state,o=n.startX,i=n.startY,a=n.endX,s=n.endY,d=this.props,l=d.anchorData.edgeAddable,u=d.edgeStyle;return x("g",{className:"lf-anchor",children:[x("g",{onMouseDown:function(f){l!==!1&&t.dragHandler.handleMouseDown(f)},children:this.getAnchorShape()}),this.isShowLine()&&(this.customTrajectory?this.customTrajectory(gt({sourcePoint:{x:o,y:i},targetPoint:{x:a,y:s}},u)):x(ee,gt({x1:o,y1:i,x2:a,y2:s},u,{"pointer-events":"none"})))]})},e}(V),qa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Cn=function(){return Cn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Cn.apply(this,arguments)},Ja=function(r){qa(e,r);function e(t){var n=r.call(this,t)||this;return n.style={},n.onDragging=function(o){var i,a=o.event,s=n.props,d=s.graphModel,l=s.nodeModel,u=s.eventCenter,f=d.selectNodes,c=l.x,h=l.y,g=a.clientX,p=a.clientY,v=d.getPointByClient({x:g,y:p}).canvasOverlayPosition,y=v.x,_=v.y,M=new J(y-c,_-h),S=((i=n.normal)===null||i===void 0?void 0:i.angle(M))-n.defaultAngle,O=new nn(-c,-h).rotate(S).translate(c,h).toString();l.transform=O,l.rotate=S;var w=Ot(f,function(C){return C.id});w.indexOf(l.id)===-1&&(w=[l.id]);var A=vo(w,function(C,I){var L=d.getNodeModelById(I);return C[I]=L==null?void 0:L.getMoveDistance(0,0,!1),C},{});w.forEach(function(C){var I=d.getNodeEdges(C);I.forEach(function(L){if(A[L.sourceNodeId]){var G=d.getNodeModelById(L.sourceNodeId),R=G.anchors.find(function(Y){return Y.id===L.sourceAnchorId});L.updateStartPoint(R)}if(A[L.targetNodeId]){var G=d.getNodeModelById(L.targetNodeId),R=G.anchors.find(function(rt){return rt.id===L.targetAnchorId});L.updateEndPoint(R)}})}),u.emit(T.NODE_ROTATE,{e:a,model:l,data:l.getData()})},n.style=t.style,n.stepperDrag=new xt({onDragging:n.onDragging}),n}return e.prototype.render=function(){var t=this,n=this.props.nodeModel,o=n.x,i=n.y,a=n.width,s=n.height,d=o+a/2+20,l=i-s/2-20;return this.normal=new J(1,0),this.defaultAngle=this.normal.angle(new J(d-o,l-i)),n.defaultAngle=this.defaultAngle,x("g",{className:"lf-rotate-control",children:x("g",{onMouseDown:function(u){t.stepperDrag.handleMouseDown(u)},children:x(ne,Cn({},this.style,{cx:d,cy:l}))})})},e}(V),Qa=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ln=function(){return Ln=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Ln.apply(this,arguments)},ts=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},so=function(r){Qa(e,r);function e(t){var n=r.call(this)||this;n.mouseDownHandler=function(i){var a=n.props,s=a.draggable,d=a.model,l=a.graphModel,u=l.editConfigModel.nodeTextDraggable;(s??u)&&(n.stepperDrag.model=d,n.stepperDrag.handleMouseDown(i))},n.onDragging=function(i){var a=i.deltaX,s=i.deltaY,d=n.props,l=d.model,u=d.graphModel.transformModel;if(a&&s){var f=ts(u.fixDeltaXY(a,s),2),c=f[0],h=f[1];l.moveText(c,h)}},n.dbClickHandler=function(){var i=n.props,a=i.editable,s=i.graphModel.eventCenter,d=i.model;a&&d.setElementState(B.TEXT_EDIT),s.emit(T.TEXT_DBCLICK,{data:d.text,model:d})};var o=t.draggable;return n.stepperDrag=new xt({onDragging:n.onDragging,step:1,eventType:"TEXT",isStopPropagation:o}),n}return e.prototype.getShape=function(){var t=this.props,n=t.model,o=t.graphModel,i=o.editConfigModel,a=n.text,s=a.value,d=a.x,l=a.y,u=a.editable,f=a.draggable,c={x:d,y:l,className:"",value:s},h=n.getTextStyle(),g=i.nodeTextDraggable||f;return x(no,Ln({},c,h,{className:Ao({"lf-element-text":u,"lf-text-draggable":!u&&g,"lf-text-disabled":!u&&!g}),model:n}))},e.prototype.render=function(){var t=this.props.model.text;if(t)return x("g",{onMouseDown:this.mouseDownHandler,onDblClick:this.dbClickHandler,children:this.getShape()})},e}(V),es=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ut=function(){return ut=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ut.apply(this,arguments)},Ye=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},ns=function(r){es(e,r);function e(t){var n=r.call(this,t)||this;return n.setHoverOn=function(){n.setState({isHovered:!0})},n.setHoverOff=function(){n.setState({isHovered:!1})},n.state={isHovered:!1},n}return e.prototype.getBackground=function(){var t=this.state.isHovered,n=this.props.model,o=n.text,i=n.getTextStyle(),a=i.background||{};if(t&&i.hover&&i.hover.background&&(a=ut(ut({},a),i.hover.background)),o!=null&&o.value&&(a==null?void 0:a.fill)!=="transparent"){var s=i.fontSize,d=i.textWidth,l=i.lineHeight,u=i.overflowMode,f=a.wrapPadding,c=o==null?void 0:o.value.split(/[\r\n]/g),h=c.length,g=o.x,p=o.y,v={};if(u==="autoWrap"&&d){var y=to({rows:c,style:{fontSize:"".concat(s,"px"),width:"".concat(d,"px"),lineHeight:l,padding:f},rowsLength:h,className:"lf-get-text-height"});v=ut(ut({},a),{x:g,y:p,width:d,height:y})}else{var _=ni({rows:c,rowsLength:h,fontSize:s}),M=_.width,S=_.height;if(u==="ellipsis"&&(M=d,S=s+2),typeof a.wrapPadding=="string"){var O=a.wrapPadding.split(",").filter(function(et){return et.trim()}).map(function(et){return parseFloat(et.trim())});if(O.length>0&&O.length<=4){if(O.length===1){var w=Ye(O,1),A=w[0];O=[A,A,A,A]}else if(O.length===2){var C=Ye(O,2),I=C[0],L=C[1];O=[I,L,I,L]}else if(O.length===3){var G=Ye(O,3),R=G[0],L=G[1],Y=G[2];O=[R,L,Y,L]}var H=Ye(O,4),rt=H[0],st=H[1],Ct=H[2],Yt=H[3];M+=st+Yt,S+=rt+Ct,g=g+(st-Yt)/2,p=p+(Ct-rt)/2}}v=ut(ut({},a),{x:g-1,y:p-1,width:M,height:S})}return x(mt,ut({},v))}return null},e.prototype.getShape=function(){var t=this.props.model,n=t.text,o=n.x,i=n.y,a=n.value;if(!a)return null;var s=t.getTextStyle(),d=ut({x:o,y:i,value:a,model:t,className:"lf-element-text"},s);return x("g",{className:"lf-line-text",onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getBackground(),x(no,ut({},d))]})},e}(so),rs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Je=function(){return Je=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Je.apply(this,arguments)},os=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},He=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},bt=function(r){rs(e,r);function e(t){var n=r.call(this)||this;n.onDragStart=function(d){var l=d.event,u=n.props,f=u.model,c=u.graphModel;if(l){var h=c.getPointByClient({x:l.clientX,y:l.clientY}).canvasOverlayPosition,g=h.x,p=h.y;n.moveOffset={dx:f.x-g,dy:f.y-p}}},n.onDragging=function(d){var l,u,f,c,h=d.event,g=n.props,p=g.model,v=g.graphModel,y=v.editConfigModel,_=y.stopMoveGraph,M=y.autoExpand,S=v.transformModel,O=v.selectNodes,w=v.width,A=v.height,C=v.gridSize;p.isDragging=!0;var I=h,L=I.clientX,G=I.clientY,R=v.getPointByClient({x:L,y:G}).canvasOverlayPosition,Y=R.x,H=R.y,rt=He(S.CanvasPointToHtmlPoint([Y,H]),2),st=rt[0],Ct=rt[1];if(Y=Y+((u=(l=n.moveOffset)===null||l===void 0?void 0:l.dx)!==null&&u!==void 0?u:0),H=H+((c=(f=n.moveOffset)===null||f===void 0?void 0:f.dy)!==null&&c!==void 0?c:0),Y=te(Y,C),H=te(H,C),!w||!A){v.moveNode2Coordinate(p.id,Y,H);return}var Yt=st<0||Ct<0||st>w||Ct>A;if(!(M&&!_&&Yt)){var et=He(S.CanvasPointToHtmlPoint([Y-p.width/2,H-p.height/2]),2),Et=et[0],re=et[1],Ae=He(S.CanvasPointToHtmlPoint([Y+p.width/2,H+p.height/2]),2),an=Ae[0],sn=Ae[1],Pe=Math.max(C,20),Ht=[];Et<0?Ht=[Pe,0]:an>v.width?Ht=[-Pe,0]:re<0?Ht=[0,Pe]:sn>v.height&&(Ht=[0,-Pe]),n.t&&Ke(n.t),p.transform=new nn(-Y,-H).rotate(p.rotate).translate(Y,H).toString();var Te=O.map(function(Ne){return Ne.id});Te.indexOf(p.id)===-1&&(Te=[p.id]),Ht.length>0&&!_&&M?n.t=eo(function(){var Ne=He(Ht,2),kt=Ne[0],zt=Ne[1];S.translate(kt??0,zt??0);var lo=-(kt??0)/S.SCALE_X,uo=-(zt??0)/S.SCALE_X;v.moveNodes(Te,lo,uo)}):v.moveNodes(Te,Y-p.x,H-p.y)}},n.onDragEnd=function(){n.t&&Ke(n.t);var d=n.props.model;d.isDragging=!1},n.onMouseOut=function(d){Co()&&n.setHoverOff(d)},n.handleMouseUp=function(){var d=n.props.model;n.mouseUpDrag=d.isDragging},n.handleClick=function(d){var l=n.mouseUpDrag===!1;if(n.startTime){var u=n.props,f=u.model,c=u.graphModel;if(l){var h=f.getData(),g=c.getPointByClient({x:d.clientX,y:d.clientY}),p={data:h,e:d,position:g,isSelected:!1,isMultiple:!1},v=d.button===2,y=d.detail===2;if(!v){var _=c.editConfigModel,M=Jr(d,_);p.isMultiple=M,f.isSelected&&!y&&M?(p.isSelected=!1,f.setSelected(!1)):(c.selectNodeById(f.id,M),p.isSelected=!0,n.toFront()),y?(_.nodeTextEdit&&f.text.editable&&(f.setSelected(!1),c.setElementStateById(f.id,B.TEXT_EDIT)),c.eventCenter.emit(T.NODE_DBCLICK,p)):(c.eventCenter.emit(T.ELEMENT_CLICK,p),c.eventCenter.emit(T.NODE_CLICK,p))}}}},n.handleContextMenu=function(d){d.preventDefault();var l=n.props,u=l.model,f=l.graphModel,c=u.getData(),h=f.getPointByClient({x:d.clientX,y:d.clientY});f.setElementStateById(u.id,B.SHOW_MENU,h.domOverlayPosition),u.isSelected||f.selectNodeById(u.id),f.eventCenter.emit(T.NODE_CONTEXTMENU,{data:c,e:d,position:h}),n.toFront()},n.handleMouseDown=function(d){var l=n.props,u=l.model,f=l.graphModel;n.startTime=new Date().getTime();var c=f.editConfigModel;c.adjustNodePosition&&u.draggable&&n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.setHoverOn=function(d){var l=n.props,u=l.model,f=l.graphModel;if(!u.isHovered){var c=u.getData();u.setHovered(!0),f.eventCenter.emit(T.NODE_MOUSEENTER,{data:c,e:d})}},n.setHoverOff=function(d){var l=n.props,u=l.model,f=l.graphModel,c=u.getData();u.isHovered&&(u.setHovered(!1),f.eventCenter.emit(T.NODE_MOUSELEAVE,{data:c,e:d}))};var o=t.graphModel,i=o.gridSize,a=o.eventCenter,s=t.model;return n.stepDrag=new xt({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,step:i,eventType:"NODE",isStopPropagation:!1,eventCenter:a,model:s}),n.modelDisposer=So(function(){return n.props},function(d){d&&d.model&&n.stepDrag.setModel(d.model)}),n}return e.prototype.componentWillUnmount=function(){this.modelDisposer&&this.modelDisposer()},e.prototype.componentDidMount=function(){},e.prototype.componentDidUpdate=function(){},e.prototype.getAnchorShape=function(t){return null},e.prototype.getAnchors=function(){var t=this,n=this.props,o=n.model,i=n.graphModel,a=o.isSelected,s=o.isHitable,d=o.isDragging,l=o.isShowAnchor;return s&&(a||l)&&!d?Ot(o.anchors,function(u,f){var c=o.getAnchorLineStyle(u),h=o.getAnchorStyle(u);return x(Ka,{anchorData:u,node:t,style:h,edgeStyle:c,anchorIndex:f,nodeModel:o,graphModel:i,setHoverOff:t.setHoverOff})}):[]},e.prototype.getRotateControl=function(){var t=this.props,n=t.model,o=t.graphModel,i=o.editConfigModel,a=i.isSilentMode,s=i.allowRotate,d=n.isSelected,l=n.isHitable,u=n.rotatable,f=n.isHovered,c=s&&u,h=n.getRotateControlStyle();if(!a&&l&&(d||f)&&c)return x(Ja,{graphModel:o,nodeModel:n,eventCenter:o.eventCenter,style:h})},e.prototype.getResizeControl=function(){var t=this.props,n=t.model,o=t.graphModel,i=o.editConfigModel,a=i.isSilentMode,s=i.allowResize,d=n.isSelected,l=n.isHitable,u=n.resizable,f=n.isHovered,c=s&&u,h=n.getResizeControlStyle();return!a&&l&&(d||f)&&c?x(wi,{style:h,model:n,graphModel:o}):null},e.prototype.getText=function(){var t,n=this.props,o=n.model,i=n.graphModel,a=i.editConfigModel;if(a.nodeTextMode!==ht.TEXT||o.state===B.TEXT_EDIT)return null;if(o.text){var s=!1;return a.nodeTextDraggable&&o.text.draggable&&(s=!0),x(so,{editable:a.nodeTextEdit&&((t=o.text.editable)!==null&&t!==void 0?t:!0),model:o,graphModel:i,draggable:s})}return null},e.prototype.getStateClassName=function(){var t=this.props.model,n=t.state,o=t.isDragging,i=t.isSelected,a="lf-node";switch(n){case B.ALLOW_CONNECT:a+=" lf-node-allow";break;case B.NOT_ALLOW_CONNECT:a+=" lf-node-not-allow";break;default:a+=" lf-node-default";break}return o&&(a+=" lf-dragging"),i&&(a+=" lf-node-selected"),a},e.prototype.toFront=function(){var t=this.props,n=t.model,o=t.graphModel;n.autoToFront&&o.toFront(n.id)},e.prototype.render=function(){var t=this.props,n=t.model,o=t.graphModel,i=o.editConfigModel,a=i.hideAnchors,s=i.adjustNodePosition,d=i.allowRotate,l=i.allowResize,u=o.gridSize,f=o.transformModel.SCALE_X,c=n.isHitable,h=n.draggable,g=n.transform,p=n.getOuterGAttributes(),v=p.className,y=v===void 0?"":v,_=os(p,["className"]),M=x("g",{className:"lf-node-content",children:[x("g",{transform:g,children:[this.getShape(),this.getText(),d&&this.getRotateControl(),l&&this.getResizeControl()]}),!a&&this.getAnchors()]}),S;return c?(s&&h&&this.stepDrag.setStep(u*f),S=x("g",Je({className:"".concat(this.getStateClassName()," ").concat(y),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onClick:this.handleClick,onMouseEnter:this.setHoverOn,onMouseOver:this.setHoverOn,onMouseLeave:this.setHoverOff,onMouseOut:this.onMouseOut,onContextMenu:this.handleContextMenu},_,{children:M}))):S=x("g",Je({className:"".concat(this.getStateClassName()," ").concat(y)},_,{children:M})),S},e.isObserved=!1,e}(V),is=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),jn=function(){return jn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},jn.apply(this,arguments)},Dr=function(r){is(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return x(mt,jn({},n,{x:t.x,y:t.y,width:t.width,height:t.height,radius:t.radius}))},e}(bt),as=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Rn=function(){return Rn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Rn.apply(this,arguments)},br=function(r){as(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.x,o=t.y,i=t.r,a=t.getNodeStyle();return x(ne,Rn({},a,{x:n,y:o,r:i}))},e}(bt),ss=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Qe=function(){return Qe=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Qe.apply(this,arguments)},Cr=function(r){ss(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t,o=n.x,i=n.y,a=n.width,s=n.height,d=n.points,l=t.getNodeStyle(),u={transform:"matrix(1 0 0 1 ".concat(o-a/2," ").concat(i-s/2,")")};return x("g",Qe({},u,{children:x(ro,Qe({},l,{points:d,x:o,y:i}))}))},e}(bt),ds=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),In=function(){return In=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},In.apply(this,arguments)},Lr=function(r){ds(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return x("g",{children:x(ro,In({},n,{points:t.points,x:t.x,y:t.y}))})},e}(bt),ls=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Bn=function(){return Bn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Bn.apply(this,arguments)},jr=function(r){ls(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getShape=function(){var t=this.props.model,n=t.getNodeStyle();return x(_i,Bn({},n,{x:t.x,y:t.y,rx:t.rx,ry:t.ry}))},e}(bt),us=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ge=function(){return ge=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ge.apply(this,arguments)},Rr=function(r){us(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getBackground=function(){var t=this.props.model,n=t.getTextStyle(),o=t.width,i=t.height,a=t.x,s=t.y,d=ge(ge({},n.background),{x:a,y:s,width:o,height:i});return x(mt,ge({},d))},e.prototype.getResizeControl=function(){return null},e.prototype.getShape=function(){return x("g",{children:this.getBackground()})},e}(bt),fs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Xn=function(){return Xn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Xn.apply(this,arguments)},cs=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},ps=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},Ir=function(r){fs(e,r);function e(){var t=r.apply(this,ps([],cs(arguments),!1))||this;return t.ref=Gn(),t}return Object.defineProperty(e.prototype,"rootEl",{get:function(){return this.ref.current},enumerable:!1,configurable:!0}),e.prototype.setHtml=function(t){t.appendChild(document.createElement("div"))},e.prototype.confirmUpdate=function(t){this.setHtml(t)},e.prototype.shouldUpdate=function(){return this.preProperties&&this.preProperties===this.currentProperties?!1:(this.preProperties=this.currentProperties,!0)},e.prototype.componentDidMount=function(){this.shouldUpdate()&&this.rootEl&&this.setHtml(this.rootEl)},e.prototype.componentDidUpdate=function(){this.shouldUpdate()&&this.rootEl&&this.confirmUpdate(this.rootEl)},e.prototype.componentWillUnmount=function(){this.rootEl.innerHTML=""},e.prototype.getShape=function(){var t=this.props.model,n=t.x,o=t.y,i=t.height,a=t.width,s=t.getNodeStyle();return this.currentProperties=JSON.stringify(t.properties),x("foreignObject",Xn({},s,{x:n-a/2,y:o-i/2,width:a,height:i,ref:this.ref}))},e}(bt),hs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ft=function(){return ft=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ft.apply(this,arguments)},ys=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},gs=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},_t;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(_t||(_t={}));var Br=function(r){hs(e,r);function e(t){var n=r.call(this)||this;n.handleMouseDown=function(d){n.stepDrag&&n.stepDrag.handleMouseDown(d)},n.onDragStart=function(){var d=n.props,l=d.x,u=d.y,f=d.edgeModel,c=f.startPoint,h=f.endPoint,g=f.pointsList;n.oldEdge={startPoint:c,endPoint:h,pointsList:g},n.setState({endX:l,endY:u,dragging:!0})},n.onDragging=function(d){var l=d.deltaX,u=d.deltaY,f=n.state,c=f.endX,h=f.endY,g=n.props,p=g.graphModel,v=g.type,y=p.transformModel,_=p.editConfigModel,M=gs(y.moveCanvasPointByHtml([c,h],l,u),2),S=M[0],O=M[1];n.setState({endX:S,endY:O,dragging:!0});var w=n.props.edgeModel,A=Ze({x:c,y:h},p);if(A&&A.node&&n.isAllowAdjust(A).pass){var C=w.startPoint,I=w.endPoint,L=w.sourceNode,G=w.targetNode,R=v===_t.SOURCE?{startPoint:{x:A.anchor.x,y:A.anchor.y},endPoint:{x:I.x,y:I.y},sourceNode:A.node,targetNode:G}:{startPoint:{x:C.x,y:C.y},endPoint:{x:A.anchor.x,y:A.anchor.y},sourceNode:L,targetNode:A.node};w.updateAfterAdjustStartAndEnd(R)}else v===_t.SOURCE?w.updateStartPoint({x:S,y:O}):w.updateEndPoint({x:S,y:O});w.text.value&&_.adjustEdge&&w.setText(Object.assign({},w.text,w.textPosition))},n.onDragEnd=function(d){var l,u,f,c=d.event;try{n.setState({dragging:!1});var h=n.props,g=h.graphModel,p=h.edgeModel,v=h.type,y=n.state,_=y.endX,M=y.endY,S=y.dragging,O=Ze({x:_,y:M},g);if(!S)return;var w=!1,A=void 0;if(O&&O.node){var C=n.isAllowAdjust(O),I=C.pass,L=C.msg,G=C.newTargetNode;if(I){var R=p.getData(),Y=R.text,H=R.sourceAnchorId,rt=H===void 0?"":H,st=R.targetAnchorId,Ct=st===void 0?"":st,Yt=ys(R,["text","sourceAnchorId","targetAnchorId"]);if(A=ft(ft({sourceAnchorId:rt,targetAnchorId:Ct},Yt),{text:(Y==null?void 0:Y.value)||""}),v===_t.SOURCE){var et=g.getNodeModelById(O.node.id),Et=g.getNodeModelById(p.targetNodeId),re=(l=g.edgeGenerator)===null||l===void 0?void 0:l.call(g,et==null?void 0:et.getData(),Et==null?void 0:Et.getData(),A);A=ft(ft({},re),{sourceNodeId:O.node.id,sourceAnchorId:O.anchor.id,startPoint:{x:O.anchor.x,y:O.anchor.y},targetNodeId:p.targetNodeId,endPoint:ft({},p.endPoint)}),p.sourceNodeId===O.node.id&&p.sourceAnchorId===O.anchor.id&&(w=!0)}else if(v===_t.TARGET){var et=g.getNodeModelById(p.sourceNodeId),Et=g.getNodeModelById(O.node.id),re=(u=g.edgeGenerator)===null||u===void 0?void 0:u.call(g,et==null?void 0:et.getData(),Et==null?void 0:Et.getData(),A);A=ft(ft({},re),{sourceNodeId:p.sourceNodeId,startPoint:ft({},p.startPoint),targetNodeId:O.node.id,targetAnchorId:O.anchor.id,endPoint:{x:O.anchor.x,y:O.anchor.y}}),p.targetNodeId===O.node.id&&p.targetAnchorId===O.anchor.id&&(w=!0)}}else{w=!0;var Ae=G.getData();g.eventCenter.emit(T.CONNECTION_NOT_ALLOWED,{data:Ae,msg:L})}}else w=!0;if(w)n.recoveryEdge();else{var an=p.getData();g.deleteEdgeById(p.id);var sn=g.addEdge(ft({},A));g.eventCenter.emit(T.EDGE_EXCHANGE_NODE,{data:{newEdge:sn.getData(),oldEdge:an}})}(f=n.preTargetNode)===null||f===void 0||f.setElementState(B.DEFAULT)}finally{var g=n.props.graphModel;g.eventCenter.emit(T.ADJUST_POINT_DRAGEND,{e:c,data:n.stepDragData})}},n.recoveryEdge=function(){var d=n.props.edgeModel,l=n.oldEdge,u=l.startPoint,f=l.endPoint,c=l.pointsList;d.updateStartPoint(u),d.updateEndPoint(f),d.modelType!==j.LINE_EDGE&&(d.pointsList=c??[],d.initPoints())},n.getAdjustPointStyle=function(){var d=n.props.graphModel.theme,l=d.edgeAdjust;return l},n.state={dragging:!1,endX:0,endY:0},n.targetRuleResults=new Map,n.sourceRuleResults=new Map;var o=t.type,i=t.edgeModel,a=t.graphModel,s=a.eventCenter;return n.stepDragData={type:o,edgeData:i.getData()},n.stepDrag=new xt({onDragStart:n.onDragStart,onDragging:n.onDragging,onDragEnd:n.onDragEnd,eventType:"ADJUST_POINT",isStopPropagation:!1,eventCenter:s,data:n.stepDragData}),n}return e.prototype.isAllowAdjust=function(t){var n=this.props,o=n.edgeModel,i=o.id,a=o.sourceNode,s=o.targetNode,d=o.sourceAnchorId,l=o.targetAnchorId,u=n.type,f,c,h,g;if(u===_t.SOURCE?(f=t.node,c=s,h=t.anchor,g=s.getAnchorInfo(l)):(f=a,c=t.node,g=t.anchor,h=a.getAnchorInfo(d)),this.preTargetNode&&this.preTargetNode!==t.node&&this.preTargetNode.setElementState(B.DEFAULT),this.preTargetNode=t.node,g.id===h.id)return{pass:!1,msg:"",newTargetNode:c};var p="".concat(f.id,"_").concat(c.id,"_").concat(h.id,"_").concat(g.id);if(!this.targetRuleResults.has(p)){var v=f.isAllowConnectedAsSource(c,h,g,i),y=c.isAllowConnectedAsTarget(f,h,g,i);this.sourceRuleResults.set(p,Ve(v)),this.targetRuleResults.set(p,Ve(y))}var _=this.sourceRuleResults.get(p),M=_.isAllPass,S=_.msg,O=this.targetRuleResults.get(p),w=O.isAllPass,A=O.msg,C=M&&w?B.ALLOW_CONNECT:B.NOT_ALLOW_CONNECT;return u===_t.SOURCE?f.setElementState(C):c.setElementState(C),{pass:M&&w,msg:A||S,newTargetNode:c}},e.prototype.render=function(){var t=this.props,n=t.x,o=t.y,i=t.getAdjustPointShape,a=t.edgeModel,s=this.state.dragging;return x("g",{pointerEvents:s?"none":"",onMouseDown:this.handleMouseDown,children:s?"":i(n,o,a)})},e}(V),vs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Yn=function(){return Yn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Yn.apply(this,arguments)};(function(r){vs(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getArrowAttributes=function(){var t=this.props,n=t.arrowInfo,o=t.style,i=n.start,a=n.end,s={start:i,end:a,offset:o.offset,verticalLength:o.verticalLength,type:"end"},d=xe(s),l=d.leftX,u=d.leftY,f=d.rightX,c=d.rightY;return Yn({d:"M".concat(l," ").concat(u," L").concat(a.x," ").concat(a.y," L").concat(f," ").concat(c," z")},o)},e.prototype.getShape=function(){var t=this.getArrowAttributes(),n=t.d,o=t.strokeWidth,i=t.stroke,a=t.fill;return x(Oe,{d:n,fill:a,strokeWidth:o,stroke:i})},e.prototype.render=function(){return x("g",{className:"lf-arrow",children:this.getShape()})},e})(V);var _s=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ve=function(){return ve=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},ve.apply(this,arguments)},ms=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},on=function(r){_s(e,r);function e(){var t=r.call(this)||this;return t.textRef=Gn(),t.handleHover=function(n,o){var i=t.props,a=i.model,s=i.graphModel.eventCenter;a.setHovered(n);var d=n?T.EDGE_MOUSEENTER:T.EDGE_MOUSELEAVE,l=a.getData();s.emit(d,{data:l,e:o})},t.setHoverOn=function(n){var o=t.props.model.isHovered;o||(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOn(),t.handleHover(!0,n))},t.setHoverOff=function(n){var o=t.props.model.isHovered;o&&(t.textRef&&t.textRef.current&&t.textRef.current.setHoverOff(),t.handleHover(!1,n))},t.handleContextMenu=function(n){n.preventDefault(),t.contextMenuTime=new Date().getTime(),t.clickTimer&&clearTimeout(t.clickTimer);var o=t.props,i=o.model,a=o.graphModel,s=a.getPointByClient({x:n.clientX,y:n.clientY});a.setElementStateById(i.id,B.SHOW_MENU,s.domOverlayPosition),t.toFront(),i.isSelected||a.selectEdgeById(i.id);var d=i==null?void 0:i.getData();a.eventCenter.emit(T.EDGE_CONTEXTMENU,{data:d,e:n,position:s})},t.handleMouseDown=function(n){n.stopPropagation(),t.startTime=new Date().getTime()},t.handleMouseUp=function(n){if(t.startTime){var o=new Date().getTime()-t.startTime;if(!(o>200)){var i=n.button===2;if(!i){var a=n.detail===2,s=t.props,d=s.model,l=s.graphModel,u=d==null?void 0:d.getData(),f=l.getPointByClient({x:n.clientX,y:n.clientY});if(a){var c=l.editConfigModel,h=l.textEditElement,g=d.id,p=d.text,v=d.modelType;if(h&&h.id===g&&l.setElementStateById(g,B.DEFAULT),c.edgeTextEdit&&p.editable&&(d.setSelected(!1),l.setElementStateById(g,B.TEXT_EDIT)),v===j.POLYLINE_EDGE){var y=d,_=l.getPointByClient({x:n.x,y:n.y}).canvasOverlayPosition,M=_.x,S=_.y;y.dbClickPosition=qr({x:M,y:S},y.points)}l.eventCenter.emit(T.EDGE_DBCLICK,{data:u,e:n,position:f})}else l.eventCenter.emit(T.ELEMENT_CLICK,{data:u,e:n,position:f}),l.eventCenter.emit(T.EDGE_CLICK,{data:u,e:n,position:f});var O=l.editConfigModel;l.selectEdgeById(d.id,Jr(n,O)),t.toFront()}}}},t}return e.prototype.getShape=function(){return x("g",{children:this.getEdge()})},e.prototype.getTextStyle=function(){},e.prototype.getText=function(){var t,n=this.props,o=n.model,i=n.graphModel,a=i.editConfigModel;if(a.edgeTextMode!==ht.TEXT||o.state===B.TEXT_EDIT)return null;if(o.text){var s=!1;return a.edgeTextDraggable&&o.text.draggable&&(s=!0),x(ns,{ref:this.textRef,editable:a.edgeTextEdit&&((t=o.text.editable)!==null&&t!==void 0?t:!0),model:o,graphModel:i,draggable:s})}return null},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.startPoint,o=t.endPoint,i=t.isSelected,a=this.state.hover;return{start:n,end:o,hover:a,isSelected:i}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.startPoint,o=t.endPoint;return[n,o]},e.prototype.getArrowStyle=function(){return console.error("getArrowStyle is deprecated in 1.2.0, please use model.getArrowStyle"),null},e.prototype.getArrow=function(){var t=this.props.model,n=t.id,o=t.getArrowStyle(),i=o.refY,a=i===void 0?0:i,s=o.refX,d=s===void 0?2:s,l=ms(this.getLastTwoPoints(),2),u=l[0],f=l[1],c="auto";return u!==null&&f!==null&&(c=zi(ki({x:f.x-u.x,y:f.y-u.y,z:0}))),x("g",{children:x("defs",{children:[x("marker",{id:"marker-start-".concat(n),refX:-d,refY:a,overflow:"visible",orient:"auto",markerUnits:"userSpaceOnUse",children:this.getStartArrow()}),x("marker",{id:"marker-end-".concat(n),refX:d,refY:a,overflow:"visible",orient:c,markerUnits:"userSpaceOnUse",children:this.getEndArrow()})]})})},e.prototype.getStartArrow=function(){return x("path",{})},e.prototype.getEndArrow=function(){var t=this.props.model,n=t.getArrowStyle(),o=n.stroke,i=n.strokeWidth,a=n.offset,s=n.verticalLength;return x("path",{stroke:o,fill:o,strokeWidth:i,transform:"rotate(180)",d:"M 0 0 L ".concat(a," -").concat(s," L ").concat(a," ").concat(s," Z")})},e.prototype.getAdjustPointShape=function(t,n,o){var i=o.getAdjustPointStyle();return x(ne,ve({className:"lf-edge-adjust-point"},i,{x:t,y:n}))},e.prototype.getAdjustPoints=function(){var t=this.props,n=t.model,o=t.graphModel,i=o.editConfigModel,a=i.adjustEdgeStartAndEnd,s=i.adjustEdgeStart,d=i.adjustEdgeEnd,l=n.getAdjustStart(),u=n.getAdjustEnd();return x("g",{children:[a&&s&&x(Br,ve({type:_t.SOURCE},l,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:o})),a&&d&&x(Br,ve({type:_t.TARGET},u,{getAdjustPointShape:this.getAdjustPointShape,edgeModel:n,graphModel:o}))]})},e.prototype.getAnimation=function(){console.error("getAnimation is deprecated in 1.2.0, please use model.getEdgeAnimationStyle")},e.prototype.getAppendWidth=function(){return x("g",{})},e.prototype.getAppend=function(){return x("g",{className:"lf-edge-append",children:this.getAppendWidth()})},e.prototype.getEdge=function(){return null},e.prototype.toFront=function(){var t=this.props,n=t.graphModel,o=t.model;n.toFront(o.id)},e.prototype.render=function(){var t=this.props.model,n=t.isSelected,o=t.isHitable,i=t.isShowAdjustPoint;return x("g",{children:[x("g",{className:["lf-edge",!o&&"pointer-none",n&&"lf-edge-selected"].filter(Boolean).join(" "),onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onContextMenu:this.handleContextMenu,onMouseOver:this.setHoverOn,onMouseEnter:this.setHoverOn,onMouseLeave:this.setHoverOff,children:[this.getShape(),this.getAppend(),this.getText(),this.getArrow()]}),i&&n?this.getAdjustPoints():""]})},e.isObserved=!1,e}(V),xs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Hn=function(){return Hn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Hn.apply(this,arguments)},Es=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Xr=function(r){xs(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.getEdgeStyle(),o=t,i=o.path,a=o.isAnimation,s=o.arrowConfig,d=t.getEdgeAnimationStyle(),l=d.strokeDasharray,u=d.stroke,f=d.strokeDashoffset,c=d.animationName,h=d.animationDuration,g=d.animationIterationCount,p=d.animationTimingFunction,v=d.animationDirection;return x(Oe,Hn({d:i},n,s,a?{strokeDasharray:l,stroke:u,style:{strokeDashoffset:f,animationName:c,animationDuration:h,animationIterationCount:g,animationTimingFunction:p,animationDirection:v}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model.path;return x(Oe,{d:t,strokeWidth:10,stroke:"transparent",fill:"none"})},e.prototype.getArrowInfo=function(){var t=this.props.model,n=this.state.hover,o=t.isSelected,i=t.getArrowStyle().offset,a=t.pointsList.map(function(f){return{x:f.x,y:f.y}}),s=Es(sr(a,i),2),d=s[0],l=s[1],u={start:d,end:l,hover:n,isSelected:o};return u},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.getArrowStyle().offset,o=t.pointsList.map(function(i){return{x:i.x,y:i.y}});return sr(o,n)},e}(on),Ms=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),kn=function(){return kn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},kn.apply(this,arguments)},Yr=function(r){Ms(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEdge=function(){var t=this.props.model,n=t.startPoint,o=t.endPoint,i=t.isAnimation,a=t.arrowConfig,s=t.getEdgeStyle(),d=t.getEdgeAnimationStyle(),l=d.strokeDasharray,u=d.stroke,f=d.strokeDashoffset,c=d.animationName,h=d.animationDuration,g=d.animationIterationCount,p=d.animationTimingFunction,v=d.animationDirection;return x(ee,kn({},s,{x1:n.x,y1:n.y,x2:o.x,y2:o.y},a,i?{strokeDasharray:l,stroke:u,style:{strokeDashoffset:f,animationName:c,animationDuration:h,animationIterationCount:g,animationTimingFunction:p,animationDirection:v}}:{}))},e.prototype.getAppendWidth=function(){var t=this.props.model,n=t.startPoint,o=t.endPoint,i={start:n,end:o},a=Qo(i),s=a.d,d=a.strokeWidth,l=a.fill,u=a.strokeDasharray,f=a.stroke;return x(Oe,{d:s,fill:l,strokeWidth:d,stroke:f,strokeDasharray:u})},e}(on),Os=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Rt=function(){return Rt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Rt.apply(this,arguments)},Ss=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Hr=function(r){Os(e,r);function e(){var t=r.call(this)||this;return t.onDragStart=function(){var n=t.props.model;n.dragAppendStart(),t.isShowAdjustPointTemp=n.isShowAdjustPoint,n.isShowAdjustPoint=!1},t.onDragging=function(n){var o=n.deltaX,i=n.deltaY,a=t.props,s=a.model,d=a.graphModel;t.isDragging=!0;var l=d.transformModel,u=d.editConfigModel,f=Ss(l.fixDeltaXY(o,i),2),c=f[0],h=f[1],g=s,p=u.adjustEdgeMiddle;p?t.appendInfo=g.dragAppendSimple(t.appendInfo,{x:c,y:h}):t.appendInfo=g.dragAppend(t.appendInfo,{x:c,y:h})},t.onDragEnd=function(){var n,o=t.props,i=o.model,a=o.graphModel.eventCenter,s=i;s.dragAppendEnd(),t.isDragging=!1,s.isShowAdjustPoint=(n=t.isShowAdjustPointTemp)!==null&&n!==void 0?n:!1,t.appendInfo=void 0,a.emit(T.EDGE_ADJUST,{data:s.getData()})},t.beforeDragStart=function(n,o){o.draggable&&t.drag.handleMouseDown(n),t.appendInfo=o},t.drag=new xt({onDragStart:t.onDragStart,onDragging:t.onDragging,onDragEnd:t.onDragEnd,isStopPropagation:!1}),t}return e.prototype.getEdge=function(){var t=this.props.model,n=t.points,o=t.isAnimation,i=t.arrowConfig,a=t.getEdgeStyle(),s=t.getEdgeAnimationStyle(),d=s.strokeDasharray,l=s.stroke,u=s.strokeDashoffset,f=s.animationName,c=s.animationDuration,h=s.animationIterationCount,g=s.animationTimingFunction,p=s.animationDirection;return x(Ei,Rt({points:n},a,i,o?{strokeDasharray:d,stroke:l,style:{strokeDashoffset:u,animationName:f,animationDuration:c,animationIterationCount:h,animationTimingFunction:g,animationDirection:p}}:{}))},e.prototype.getArrowInfo=function(){var t=this.props.model,n=t.points,o=t.isSelected,i=this.state.hover,a=Xt(n),s=a[0],d=a[0];return a.length>=2&&(s=a[a.length-2],d=a[a.length-1]),{start:s,end:d,hover:i,isSelected:o}},e.prototype.getLastTwoPoints=function(){var t=this.props.model,n=t.points,o=Xt(n),i=o[0],a=o[0];return o.length>=2&&(i=o[o.length-2],a=o[o.length-1]),[i,a]},e.prototype.getAppendAttributes=function(t){var n=t.start,o=t.end,i;if(n.x===o.x&&n.y===o.y)i="";else{var a={start:n,end:o,offset:10,verticalLength:5},s=xe(Rt(Rt({},a),{type:"start"})),d=xe(Rt(Rt({},a),{type:"end"}));i="M".concat(s.leftX," ").concat(s.leftY,`
      L`).concat(s.rightX," ").concat(s.rightY,`
      L`).concat(d.rightX," ").concat(d.rightY,`
      L`).concat(d.leftX," ").concat(d.leftY," z")}return{d:i,fill:"transparent",stroke:"transparent",strokeWidth:1,strokeDasharray:"4, 4"}},e.prototype.getAppendShape=function(t){var n=this.getAppendAttributes(t),o=n.d,i=n.strokeWidth,a=n.fill,s=n.strokeDasharray,d=n.stroke;return x(Oe,{d:o,fill:a,strokeWidth:i,stroke:d,strokeDasharray:s})},e.prototype.getAppendWidth=function(){for(var t=this,n=this.props,o=n.model,i=n.graphModel,a=o.pointsList,s=o.draggable,d=[],l=a.length,u=function(h){var g="lf-polyline-append",p={start:{x:a[h].x,y:a[h].y},end:{x:a[h+1].x,y:a[h+1].y},startIndex:h,endIndex:h+1,direction:F.HORIZONTAL,draggable:!0},v=x("g",{className:g,children:f.getAppendShape(p)}),y=i.editConfigModel,_=y.adjustEdge,M=y.adjustEdgeMiddle;if(_&&s){var S=p.startIndex,O=p.endIndex,w=M&&(S===0||O===l-1);p.draggable=!w,p.start.x===p.end.x?(p.draggable&&(g+="-ew-resize"),p.direction=F.VERTICAL):p.start.y===p.end.y&&(p.draggable&&(g+="-ns-resize"),p.direction=F.HORIZONTAL),v=x("g",{className:f.isDragging?"lf-dragging":"lf-drag-able",onMouseDown:function(A){return t.beforeDragStart(A,p)},children:x("g",{className:g,children:f.getAppendShape(p)})})}d.push(v)},f=this,c=0;c<l-1;c++)u(c);return x("g",{children:d})},e}(on),qt=function(){return qt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},qt.apply(this,arguments)},ws=function(){function r(e){var t=this;this.nodeConfig=null,this.fakeNode=null,this.stopDrag=function(){t.nodeConfig=null,window.document.removeEventListener("mouseup",t.stopDrag)},this.dragEnter=function(o){!t.nodeConfig||t.fakeNode||(t.fakeNode=t.lf.createFakeNode(qt(qt({},t.nodeConfig),t.clientToLocalPoint({x:o.clientX,y:o.clientY}))))},this.onDragOver=function(o){if(o.preventDefault(),t.fakeNode){var i=t.clientToLocalPoint({x:o.clientX,y:o.clientY}),a=i.x,s=i.y;t.fakeNode.moveTo(a,s);var d=t.fakeNode.getData();t.lf.setNodeSnapLine(d),t.lf.graphModel.eventCenter.emit(T.NODE_DND_DRAG,{data:d})}return!1},this.onDragLeave=function(){t.fakeNode&&(t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)},this.onDrop=function(o){!t.lf.graphModel||!o||!t.nodeConfig||(t.lf.addNode(qt(qt({},t.nodeConfig),t.clientToLocalPoint({x:o.clientX,y:o.clientY})),T.NODE_DND_ADD,o),o.preventDefault(),o.stopPropagation(),t.nodeConfig=null,t.lf.removeNodeSnapLine(),t.lf.graphModel.removeFakeNode(),t.fakeNode=null)};var n=e.lf;this.lf=n}return r.prototype.clientToLocalPoint=function(e){var t=e.x,n=e.y,o=$r(this.lf.options,["grid","size"]),i=this.lf.graphModel.getPointByClient({x:t,y:n}),a=i.canvasOverlayPosition,s=a.x,d=a.y;return{x:te(s,o),y:te(d,o)}},r.prototype.startDrag=function(e){var t=this.lf.graphModel.editConfigModel;t!=null&&t.isSilentMode||(this.nodeConfig=e,window.document.addEventListener("mouseup",this.stopDrag))},r.prototype.eventMap=function(){return{onMouseEnter:this.dragEnter,onMouseOver:this.dragEnter,onMouseMove:this.onDragOver,onMouseLeave:this.onDragLeave,onMouseUp:this.onDrop}},r}();function As(r,e){r.on("node:mousemove",function(t){var n=t.data;e.setNodeSnapLine(n)}),r.on("node:mouseup",function(){e.clearSnapline()})}var Ps=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Mt=function(){return Mt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},Mt.apply(this,arguments)},Ts=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Ns=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Ds=function(r){Ps(e,r);function e(t){var n=r.call(this,t)||this;return n.ref=Gn(),n.__prevText={type:"",text:"",id:""},n.keyupHandler=function(o){var i=n.props.graphModel.textEditElement;o.key==="Enter"&&o.altKey&&(i==null||i.setElementState(B.DEFAULT))},n.inputHandler=function(o){var i=o.target.innerText,a=n.props.graphModel.textEditElement;a&&(n.__prevText={type:a.type,text:i.replace(/(\r\n)+$|(\n)+$/,""),id:a.id})},n.keydownHandler=function(o){o.stopPropagation()},n.state={style:{left:0,top:0}},n}return e.getDerivedStateFromProps=function(t){var n,o=t.textEditElement,i=t.graphModel,a=i.transformModel,s=i.theme,d=s.inputText,l;if(o){if(!(!((n=o.text)===null||n===void 0)&&n.value)&&o.BaseType===U.EDGE){var u=o.text,f=o.textPosition,c=f.x,h=f.y;u.x=c,u.y=h,o.setText(u)}var g={resize:"auto",whiteSpace:"normal",wordBreak:"break-all"};if(o.BaseType===U.EDGE){var p=s.edgeText,v=p.overflowMode,y=p.lineHeight,_=p.wrapPadding,M=p.textWidth;M&&v==="autoWrap"&&(l=Mt(Mt({},g),{width:M,minWidth:M,lineHeight:y,padding:_}))}else if(o.BaseType===U.NODE){var S=s.nodeText,v=S.overflowMode,y=S.lineHeight,_=S.wrapPadding,M=S.textWidth,O=o.width,w=o.modelType,A=o.textWidth,C=A||M||O;(w!==j.TEXT_NODE&&v==="autoWrap"||w===j.TEXT_NODE&&M)&&(l=Mt(Mt({},g),{width:C,minWidth:C,lineHeight:y,padding:_}))}var I=o.text,L=I.x,G=I.y,R=Ns(a.CanvasPointToHtmlPoint([L,G]),2),Y=R[0],H=R[1];return{style:Mt(Mt({left:Y,top:H},l),d)}}return null},e.prototype.componentDidUpdate=function(){var t=this.props.graphModel;if(this.ref.current&&(this.ref.current.focus(),this.placeCaretAtEnd(this.ref.current)),this.__prevText.id!==""){var n=this.__prevText,o=n.text,i=n.id;t.updateText(i,o),t.eventCenter.emit(T.TEXT_UPDATE,{data:Mt({},this.__prevText)}),this.__prevText.id="",this.__prevText.text="",this.__prevText.type=""}},e.prototype.placeCaretAtEnd=function(t){if(window.getSelection!==void 0&&document.createRange!==void 0){var n=document.createRange();n.selectNodeContents(t),n.collapse(!1);var o=window.getSelection();o==null||o.removeAllRanges(),o==null||o.addRange(n)}},e.prototype.render=function(){var t,n=this.props.graphModel.textEditElement,o=this.state.style;return n?x("div",{contentEditable:!0,className:"lf-text-input",style:o,ref:this.ref,onKeyUp:this.keyupHandler,onKeyDown:this.keydownHandler,onKeyPress:this.keydownHandler,onInput:this.inputHandler,children:(t=n.text)===null||t===void 0?void 0:t.value},n.id):null},e.toolName="text-edit-tool",e=Ts([at],e),e}(V),bs=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Cs=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},hn=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},Ls=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},js=function(r){bs(e,r);function e(t){var n=r.call(this,t)||this;n.handleMouseDown=function(s){n.stepDrag.handleMouseDown(s)},n.handleWheelEvent=function(s){var d,l;s.preventDefault();var u=s.deltaX,f=s.deltaY,c=s.clientX,h=s.clientY,g=s.ctrlKey,p=new WheelEvent("wheel",{deltaX:u,deltaY:f,clientX:c,clientY:h,ctrlKey:g});(l=(d=n.props.lf.container)===null||d===void 0?void 0:d.querySelector('.lf-canvas-overlay[name="canvas-overlay"]'))===null||l===void 0||l.dispatchEvent(p)},n.onDragging=function(s){var d=s.deltaX,l=s.deltaY,u=n.props,f=u.graphModel,c=u.lf,h=c.getTransform(),g=h.SCALE_X,p=h.SCALE_Y,v=f.getSelectElements(!0);f.moveNodes(v.nodes.map(function(y){return y.id}),d/g,l/p)},n.handleContextMenu=function(s){s.preventDefault();var d=n.props,l=d.graphModel,u=d.graphModel,f=u.eventCenter,c=u.selectElements,h=l.getPointByClient({x:s.clientX,y:s.clientY}),g={nodes:[],edges:[]},p=Ls([],hn(c.values()),!1);p.forEach(function(v){v.BaseType===U.NODE&&g.nodes.push(v.getData()),v.BaseType===U.EDGE&&g.edges.push(v.getData())}),f.emit(T.SELECTION_CONTEXTMENU,{data:g,e:s,position:h})};var o=t.graphModel,i=o.gridSize,a=o.eventCenter;return n.stepDrag=new xt({onDragging:n.onDragging,step:i,eventType:"SELECTION",eventCenter:a}),n}return e.prototype.render=function(){var t,n,o=this.props.graphModel,i=o.selectElements,a=o.transformModel,s=this.props.lf.getTransform(),d=s.SCALE_X,l=s.SCALE_Y;if(!(i.size<=1)){var u=Number.MAX_SAFE_INTEGER,f=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;i.forEach(function(p){var v;p.BaseType===U.NODE&&(v=Io(p)),p.BaseType===U.EDGE&&(v=Ho(p)),v!==void 0&&(u=Math.min(u,v.x),f=Math.min(f,v.y),c=Math.max(c,v.x1),h=Math.max(h,v.y1))}),t=hn(a.CanvasPointToHtmlPoint([u,f]),2),u=t[0],f=t[1],n=hn(a.CanvasPointToHtmlPoint([c,h]),2),c=n[0],h=n[1];var g={left:"".concat(u-20*d/2,"px"),top:"".concat(f-20*l/2,"px"),width:"".concat(c-u+20*d,"px"),height:"".concat(h-f+20*l,"px"),"border-width":"".concat(2*d,"px")};return x("div",{className:"lf-multiple-select",style:g,onMouseDown:this.handleMouseDown,onContextMenu:this.handleContextMenu,onWheel:this.handleWheelEvent})}},e.toolName="multiple-select-tool",e=Cs([at],e),e}(V),yn=function(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var s=r.length-1;s>=0;s--)(a=r[s])&&(i=(o<3?a(i):o>3?a(e,t,i):a(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i},Rs=[Ds,js],Is=function(){function r(e){var t=this;this.toolMap=new Map,this.disabledToolMap=new Map,this.instance=e,W(Rs,function(i){t.isDisabled(i.toolName)||t.registerTool(i.toolName,i)});var n=e.graphModel,o=n.eventCenter;o.on("".concat(T.GRAPH_TRANSFORM,",").concat(T.NODE_CLICK,",").concat(T.BLANK_CLICK," "),function(){var i,a=n.textEditElement,s=n.editConfigModel,d=s.edgeTextEdit,l=s.nodeTextEdit;(d||l)&&a&&((i=n.textEditElement)===null||i===void 0||i.setElementState(B.DEFAULT))})}return r.prototype.isDisabled=function(e){var t;return((t=this.instance.options.disabledTools)===null||t===void 0?void 0:t.indexOf(e))!==-1},r.prototype.registerTool=function(e,t){this.toolMap.set(e,t)},r.prototype.disableTool=function(e){var t=this.toolMap.get(e);if(t)return this.disabledToolMap.set(e,t),this.toolMap.delete(e),!0;throw new Error("禁用失败，不存在名为 ${tool} 的工具")},r.prototype.enableTool=function(e){var t=this.disabledToolMap.get(e);if(t)return this.toolMap.set(e,t),this.disabledToolMap.delete(e),!0;throw new Error("不存在名为 ${tool} 的工具")},r.prototype.getTools=function(){return Array.from(this.toolMap.values())},r.prototype.getInstance=function(){return this.instance},yn([E],r.prototype,"toolMap",void 0),yn([m],r.prototype,"disableTool",null),yn([m],r.prototype,"enableTool",null),r}(),zn=function(){return zn=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},zn.apply(this,arguments)},Bs=function(){function r(e){this.undos=[],this.redos=[],this.callbacks=[],this.stopWatch=null,this.curData=null,this.maxSize=50,this.waitTime=100,this.eventCenter=e}return r.prototype.add=function(e){Zn(_o(this.undos),e)||(this.undos.push(e),Zn(this.curData,e)||(this.redos=[]),this.eventCenter.emit(T.HISTORY_CHANGE,{data:{undos:this.undos,redos:this.redos,undoAble:this.undoAble(),redoAble:this.redoAble()}}),this.undos.length>this.maxSize&&this.undos.shift())},r.prototype.undoAble=function(){return this.undos.length>1},r.prototype.undo=function(){if(this.undoAble()){var e=this.undos.pop();this.redos.push(e);var t=this.undos.pop();return this.curData=b(t),t}},r.prototype.redoAble=function(){return this.redos.length>0},r.prototype.redo=function(){if(this.redoAble()){var e=this.redos.pop();return this.curData=b(e),e}},r.prototype.watch=function(e){var t=this;this.stopWatch&&this.stopWatch(),this.undos.push(e.modelToGraphData()),this.stopWatch=To(e,mo(function(){var n=e.modelToHistoryData();n&&t.add(zn({},n))},this.waitTime))},r}();var yt=null;function kr(r,e){return r.x+=e,r.y+=e,Ur(r.text)||(r.text.x+=e,r.text.y+=e),r}function zr(r,e){return r.startPoint&&(r.startPoint.x+=e,r.startPoint.y+=e),r.endPoint&&(r.endPoint.x+=e,r.endPoint.y+=e),r.pointsList&&r.pointsList.length>0&&r.pointsList.forEach(function(t){t.x+=e,t.y+=e}),Ur(r.text)||(r.text.x+=e,r.text.y+=e),r}var Wt=40,ke=40;function Xs(r,e){var t=r.keyboard,n=t.options.keyboard;t.on(["cmd + c","ctrl + c"],function(){if(ke=Wt,!(n!=null&&n.enabled)||e.textEditElement)return!0;var o=r.options.guards,i=e.getSelectElements(!1),a=o&&o.beforeClone?o.beforeClone(i):!0;return!a||i.nodes.length===0&&i.edges.length===0?(yt=null,!0):(yt=i,yt.nodes.forEach(function(s){return kr(s,Wt)}),yt.edges.forEach(function(s){return zr(s,Wt)}),!1)}),t.on(["cmd + v","ctrl + v"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;if(yt&&(yt.nodes||yt.edges)){r.clearSelectElements();var o=r.addElements(yt,ke);if(!o)return!0;o.nodes.forEach(function(i){return r.selectElementById(i.id,!0)}),o.edges.forEach(function(i){return r.selectElementById(i.id,!0)}),yt.nodes.forEach(function(i){return kr(i,Wt)}),yt.edges.forEach(function(i){return zr(i,Wt)}),ke=ke+Wt}return!1}),t.on(["cmd + z","ctrl + z"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.undo(),!1)}),t.on(["cmd + y","ctrl + y"],function(){return!(n!=null&&n.enabled)||e.textEditElement?!0:(r.redo(),!1)}),t.on(["backspace"],function(){if(!(n!=null&&n.enabled)||e.textEditElement)return!0;var o=e.getSelectElements(!0);return r.clearSelectElements(),o.edges.forEach(function(i){return i.id&&r.deleteEdge(i.id)}),o.nodes.forEach(function(i){return i.id&&r.deleteNode(i.id)}),!1})}var Ys=function(){function r(e){e.keyboard||(e.keyboard={enabled:!1}),this.options=e;var t=e.lf;this.target=t.container,this.mousetrap=new Po(this.target),e.keyboard.enabled&&!t.options.isSilentMode&&this.enable(!0)}return r.prototype.initShortcuts=function(){var e=this,t,n=((t=this.options.keyboard)!==null&&t!==void 0?t:{}).shortcuts;if(n)if(xo(n))n.forEach(function(s){var d=s.keys,l=s.callback,u=s.action;return e.on(d,l,u)});else{var o=n.keys,i=n.callback,a=n.action;this.on(o,i,a)}},r.prototype.on=function(e,t,n){this.mousetrap.bind(this.getKeys(e),t,n)},Object.defineProperty(r.prototype,"disabled",{get:function(){var e,t;return((t=(e=this.options)===null||e===void 0?void 0:e.keyboard)===null||t===void 0?void 0:t.enabled)!==!0},enumerable:!1,configurable:!0}),r.prototype.off=function(e,t){this.mousetrap.unbind(this.getKeys(e),t)},r.prototype.enable=function(e){(this.disabled||e)&&(this.options.keyboard&&(this.options.keyboard.enabled=!0),this.target instanceof HTMLElement&&(this.target.setAttribute("tabindex","-1"),this.target.style.outline="none"))},r.prototype.disable=function(){this.disabled||(this.options.keyboard&&(this.options.keyboard.enabled=!1),this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))},r.prototype.getKeys=function(e){var t=this;return(Array.isArray(e)?e:[e]).map(function(n){return t.formatKey(n)})},r.prototype.formatKey=function(e){return e.toLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command")},r}(),At=function(){return At=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o])}return r},At.apply(this,arguments)},ze=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),o,i=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}return i},gn=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},vn=Symbol("plugin registered by Logicflow.use"),Hs=function(){function r(e){var t=this,n;this.viewMap=new Map,this.components=[],this.extension={},this.setView=function(l,u){return t.viewMap.set(l,u)},this.getView=function(l){return t.viewMap.get(l)};var o=_e.get(e),i=o.container,a=o.width,s=o.height;this.options=o,this.container=this.initContainer(i,a,s),this.graphModel=new ya(At(At({},o),{container:this.container})),this.plugins=(n=o.plugins)!==null&&n!==void 0?n:[];var d=this.graphModel.eventCenter;this.tool=new Is(this),this.dnd=new ws({lf:this}),this.history=new Bs(d),this.keyboard=new Ys({lf:this,keyboard:o.keyboard}),o.snapline!==!1&&(this.snaplineModel=new ga(this.graphModel),As(d,this.snaplineModel)),o.isSilentMode||(Xs(this,this.graphModel),this.keyboard.initShortcuts()),this.defaultRegister(),this.installPlugins(o.disabledPlugins)}return r.prototype.initContainer=function(e,t,n){var o=document.createElement("div");return o.style.position="relative",o.style.width=t?"".concat(t,"px"):"100%",o.style.height=n?"".concat(n,"px"):"100%",e.innerHTML="",e.appendChild(o),o},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return r.toStringTag},enumerable:!1,configurable:!0}),r.prototype.register=function(e,t,n){if(n===void 0&&(n=!0),typeof e!="string"){this.registerElement(e);return}var o={BaseEdge:on,BaseEdgeModel:rn,BaseNode:bt,BaseNodeModel:Dt,RectNode:Dr,RectNodeModel:wr,CircleNode:br,CircleNodeModel:Er,PolygonNode:Cr,PolygonNodeModel:Sr,TextNode:Rr,TextNodeModel:Pr,LineEdge:Yr,LineEdgeModel:vr,DiamondNode:Lr,DiamondNodeModel:Mr,PolylineEdge:Hr,PolylineEdgeModel:mr,BezierEdge:Xr,BezierEdgeModel:gr,EllipseNode:jr,EllipseNodeModel:Or,HtmlNode:Ir,HtmlNodeModel:Tr,h:Gr,type:e};if(this.viewMap.forEach(function(l){var u=l.extendKey;u&&(o[u]=l)}),this.graphModel.modelMap.forEach(function(l){var u=l.extendKey;u&&(o[u]=l)}),t){var i=t(o),a=i.view,s=i.model,d=a;n&&!d.isObserved&&(d.isObserved=!0,d=at(d)),this.setView(e,d),this.graphModel.setModel(e,s)}},r.prototype.registerElement=function(e){var t=e.view;e.isObserverView!==!1&&!t.isObserved&&(t.isObserved=!0,t=at(t)),this.setView(e.type,t),this.graphModel.setModel(e.type,e.model)},r.prototype.batchRegister=function(e){var t=this;e===void 0&&(e=[]),W(e,function(n){t.registerElement(n)})},r.prototype.defaultRegister=function(){var e=[{type:"rect",view:Dr,model:wr},{type:"circle",view:br,model:Er},{type:"polygon",view:Cr,model:Sr},{type:"text",view:Rr,model:Pr},{type:"ellipse",view:jr,model:Or},{type:"diamond",view:Lr,model:Mr},{type:"html",view:Ir,model:Tr},{type:"line",view:Yr,model:vr},{type:"polyline",view:Hr,model:mr},{type:"bezier",view:Xr,model:gr}];this.batchRegister(e)},r.prototype.addNode=function(e,t,n){return t===void 0&&(t=T.NODE_ADD),this.graphModel.addNode(e,t,n)},r.prototype.deleteNode=function(e){var t=this.graphModel.getNodeModelById(e);if(!t)return!1;var n=t.getData(),o=this.options.guards,i=o!=null&&o.beforeDelete?o.beforeDelete(n):!0;return i&&this.graphModel.deleteNode(e),i},r.prototype.cloneNode=function(e){var t=this.graphModel.getNodeModelById(e),n=t==null?void 0:t.getData();if(n){var o=this.options.guards,i=o!=null&&o.beforeClone?o.beforeClone(n):!0;if(i)return this.graphModel.cloneNode(e)}},r.prototype.changeNodeId=function(e,t){return this.graphModel.changeNodeId(e,t)},r.prototype.changeNodeType=function(e,t){this.graphModel.changeNodeType(e,t)},r.prototype.getNodeModelById=function(e){return this.graphModel.getNodeModelById(e)},r.prototype.getNodeDataById=function(e){var t=this.getNodeModelById(e);return t==null?void 0:t.getData()},r.prototype.getNodeIncomingEdge=function(e){return this.graphModel.getNodeIncomingEdge(e)},r.prototype.getNodeOutgoingEdge=function(e){return this.graphModel.getNodeOutgoingEdge(e)},r.prototype.getNodeIncomingNode=function(e){return this.graphModel.getNodeIncomingNode(e)},r.prototype.getNodeOutgoingNode=function(e){return this.graphModel.getNodeOutgoingNode(e)},r.prototype.createFakeNode=function(e){var t=this.graphModel.modelMap.get(e.type);if(!t)return console.warn("不存在为".concat(e.type,"类型的节点")),null;var n=new t(At(At({},e),{virtual:!0}),this.graphModel);return this.graphModel.setFakeNode(n),n},r.prototype.removeFakeNode=function(){this.graphModel.removeFakeNode()},r.prototype.setNodeSnapLine=function(e){var t;(t=this.snaplineModel)===null||t===void 0||t.setNodeSnapLine(e)},r.prototype.removeNodeSnapLine=function(){var e;(e=this.snaplineModel)===null||e===void 0||e.clearSnapline()},r.prototype.setDefaultEdgeType=function(e){this.graphModel.setDefaultEdgeType(e)},r.prototype.addEdge=function(e){return this.graphModel.addEdge(e)},r.prototype.getEdgeDataById=function(e){var t=this.getEdgeModelById(e);return t==null?void 0:t.getData()},r.prototype.getEdgeModelById=function(e){return this.graphModel.getEdgeModelById(e)},r.prototype.getEdgeModels=function(e){var t=e.sourceNodeId,n=e.targetNodeId,o=[],i=this.graphModel.edges;return t&&n?W(i,function(a){a.sourceNodeId===t&&a.targetNodeId===n&&o.push(a)}):t?W(i,function(a){a.sourceNodeId===t&&o.push(a)}):n&&W(i,function(a){a.targetNodeId===n&&o.push(a)}),o},r.prototype.changeEdgeId=function(e,t){return this.graphModel.changeEdgeId(e,t)},r.prototype.changeEdgeType=function(e,t){this.graphModel.changeEdgeType(e,t)},r.prototype.deleteEdge=function(e){var t=this.graphModel.getEdgeModelById(e);if(!t)return!1;var n=t.getData(),o=this.options.guards,i=o!=null&&o.beforeDelete?o.beforeDelete(n):!0;return i&&this.graphModel.deleteEdgeById(e),i},r.prototype.deleteEdgeByNodeId=function(e){var t=e.sourceNodeId,n=e.targetNodeId;t&&n?this.graphModel.deleteEdgeBySourceAndTarget(t,n):t?this.graphModel.deleteEdgeBySource(t):n&&this.graphModel.deleteEdgeByTarget(n)},r.prototype.getNodeEdges=function(e){return this.graphModel.getNodeEdges(e)},r.prototype.addElements=function(e,t){var n=this,o=e.nodes,i=e.edges;t===void 0&&(t=40);var a={},s={nodes:[],edges:[]};return W(o,function(d){var l=d.id,u=n.addNode(d);l&&(a[l]=u.id),s.nodes.push(u)}),W(i,function(d){var l=d.sourceNodeId,u=d.targetNodeId;a[l]&&(l=a[l]),a[u]&&(u=a[u]);var f=n.graphModel.addEdge(At(At({},d),{sourceNodeId:l,targetNodeId:u}));s.edges.push(f)}),s},r.prototype.selectElementById=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),this.graphModel.selectElementById(e,t),!t&&n&&this.graphModel.toFront(e)},r.prototype.getSelectElements=function(e){return e===void 0&&(e=!0),this.graphModel.getSelectElements(e)},r.prototype.clearSelectElements=function(){this.graphModel.clearSelectElements()},r.prototype.getModelById=function(e){return this.graphModel.getElement(e)},r.prototype.getDataById=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getData()},r.prototype.deleteElement=function(e){var t,n,o,i=this.getModelById(e);if(!i)return!1;var a=(t={},t[U.NODE]=this.deleteNode,t[U.EDGE]=this.deleteEdge,t);return(o=(n=a[i.BaseType])===null||n===void 0?void 0:n.call(this,e))!==null&&o!==void 0?o:!1},r.prototype.setElementZIndex=function(e,t){return this.graphModel.setElementZIndex(e,t)},r.prototype.getAreaElement=function(e,t,n,o,i){return n===void 0&&(n=!0),o===void 0&&(o=!0),i===void 0&&(i=!1),this.graphModel.getAreaElement(e,t,n,o,i).map(function(a){return a.getData()})},r.prototype.setProperties=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.setProperties(tt(t))},r.prototype.getProperties=function(e){var t;return(t=this.graphModel.getElement(e))===null||t===void 0?void 0:t.getProperties()},r.prototype.deleteProperty=function(e,t){var n;(n=this.graphModel.getElement(e))===null||n===void 0||n.deleteProperty(t)},r.prototype.updateAttributes=function(e,t){this.graphModel.updateAttributes(e,t)},r.prototype.editText=function(e){this.graphModel.editText(e)},r.prototype.updateText=function(e,t){this.graphModel.updateText(e,t)},r.prototype.updateEditConfig=function(e){var t=this.graphModel,n=t.editConfigModel,o=t.transformModel;n.updateEditConfig(e),(e==null?void 0:e.stopMoveGraph)!==void 0&&o.updateTranslateLimits(e.stopMoveGraph),e!=null&&e.isSilentMode?this.keyboard.disable():this.keyboard.enable(!0)},r.prototype.getEditConfig=function(){return this.graphModel.editConfigModel.getConfig()},r.prototype.setTheme=function(e){this.graphModel.setTheme(e)},r.prototype.focusByElement=function(e){var t=void 0,n=this.getNodeModelById(e);if(n){var o=n.getData(),i=o.x,a=o.y;t={x:i,y:a}}var s=this.getEdgeModelById(e);if(s){var d=s.textPosition,i=d.x,a=d.y;t={x:i,y:a}}t&&this.focusByCoordinate(t)},r.prototype.focusByCoordinate=function(e){var t=this.graphModel,n=t.transformModel,o=t.width,i=t.height,a=e.x,s=e.y;n.focusOn(a,s,o,i)},r.prototype.focusOn=function(e){if(typeof e=="string")this.focusByElement(e);else if("x"in e&&"y"in e)this.focusByCoordinate(e);else{var t=e.id,n=e.coordinate;t&&this.focusByElement(t),n&&this.focusByCoordinate(n)}},r.prototype.resize=function(e,t){this.graphModel.resize(e,t),this.options.width=this.graphModel.width,this.options.height=this.graphModel.height},r.prototype.toFront=function(e){this.graphModel.toFront(e)},r.prototype.getPointByClient=function(e,t){if(typeof e=="object")return this.graphModel.getPointByClient(e);if(typeof t=="number")return this.graphModel.getPointByClient({x:e,y:t})},r.prototype.getGraphData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getGraphRawData();return this.adapterOut?this.adapterOut.apply(this,gn([n],ze(e),!1)):n},r.prototype.getGraphRawData=function(){return this.graphModel.modelToGraphData()},r.prototype.clearData=function(){this.graphModel.clearData()},r.prototype.renderRawData=function(e){this.graphModel.graphDataToModel(tt(e)),this.options.history!==!1&&this.history.watch(this.graphModel),co(x(Wa,{getView:this.getView,tool:this.tool,options:this.options,dnd:this.dnd,snaplineModel:this.snaplineModel,graphModel:this.graphModel}),this.container),this.emit(T.GRAPH_RENDERED,{data:this.graphModel.modelToGraphData(),graphModel:this.graphModel})},r.prototype.render=function(e){var t=b(e);this.adapterIn&&(t=this.adapterIn(t)),this.renderRawData(t)},r.prototype.undo=function(){if(this.history.undoAble()){var e=tt(this.history.undo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.redo=function(){if(this.history.redoAble()){var e=tt(this.history.redo());this.clearSelectElements(),this.graphModel.graphDataToModel(e)}},r.prototype.zoom=function(e,t){var n=this.graphModel.transformModel;return n.zoom(e,t)},r.prototype.resetZoom=function(){var e=this.graphModel.transformModel;e.resetZoom()},r.prototype.setZoomMiniSize=function(e){var t=this.graphModel.transformModel;t.setZoomMiniSize(e)},r.prototype.setZoomMaxSize=function(e){var t=this.graphModel.transformModel;t.setZoomMaxSize(e)},r.prototype.getTransform=function(){var e=this.graphModel.transformModel,t=e.SCALE_X,n=e.SCALE_Y,o=e.TRANSLATE_X,i=e.TRANSLATE_Y;return{SCALE_X:t,SCALE_Y:n,TRANSLATE_X:o,TRANSLATE_Y:i}},r.prototype.translate=function(e,t){var n=this.graphModel.transformModel;n.translate(e,t)},r.prototype.resetTranslate=function(){var e=this.graphModel.transformModel,t=e.TRANSLATE_X,n=e.TRANSLATE_Y;this.translate(-t,-n)},r.prototype.translateCenter=function(){this.graphModel.translateCenter()},r.prototype.fitView=function(e,t){t===void 0&&(t=e),this.graphModel.fitView(e,t)},r.prototype.openEdgeAnimation=function(e){this.graphModel.openEdgeAnimation(e)},r.prototype.closeEdgeAnimation=function(e){this.graphModel.closeEdgeAnimation(e)},r.prototype.on=function(e,t){this.graphModel.eventCenter.on(e,t)},r.prototype.off=function(e,t){this.graphModel.eventCenter.off(e,t)},r.prototype.once=function(e,t){this.graphModel.eventCenter.once(e,t)},r.prototype.emit=function(e,t){this.graphModel.eventCenter.emit(e,t)},r.use=function(e,t){var n,o=e.pluginName;if(!o)throw new Error("请给插件指定 pluginName!");this.extensions.set(o,(n={},n[vn]=vn,n.extension=e,n.props=t,n))},r.prototype.installPlugins=function(e){var t=this;e===void 0&&(e=[]);var n=Array.from(r.extensions,function(i){var a=ze(i,2),s=a[1];return s}),o=gn(gn([],ze(this.plugins),!1),ze(n),!1);W(o,function(i){var a,s;vn in i?(a=i.extension,s=i.props):a=i;var d=a==null?void 0:a.pluginName;Eo(e,d)===-1&&t.installPlugin(a,s)})},r.prototype.installPlugin=function(e,t){var n,o;if("pluginName"in e&&"install"in e){var i=e.pluginName,a=e.install,s=e.render;i&&(a&&a.call(e,this,r),s&&this.components.push(s.bind(e)),this.extension[i]=e);return}var d=e,l=d.pluginName,u=new d({lf:this,LogicFlow:r,props:t,options:(o=(n=this.options.pluginsOptions)===null||n===void 0?void 0:n[l])!==null&&o!==void 0?o:{}});u.render&&this.components.push(u.render.bind(u)),this.extension[l]=u},r.extensions=new Map,r}();(function(r){r.toStringTag="LF.".concat(r.name)})(Hs);function at(r){return fo(r)}export{Hs as L};
