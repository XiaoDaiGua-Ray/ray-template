import{d as S}from"./destr@2.0.5-BPvN1X9m.js";import{d as h,a as $}from"./deep-pick-omit@1.2.1-CegYQlcN.js";function p(e,{storage:n,serializer:i,key:t,debug:s,pick:o,omit:d,beforeHydrate:a,afterHydrate:r},c,f=!0){try{f&&(a==null||a(c));const l=n.getItem(t);if(l){const u=i.deserialize(l),g=o?h(u,o):u,z=d?$(g,d):g;e.$patch(z)}f&&(r==null||r(c))}catch(l){s&&console.error("[pinia-plugin-persistedstate]",l)}}function m(e,{storage:n,serializer:i,key:t,debug:s,pick:o,omit:d}){try{const a=o?h(e,o):e,r=d?$(a,d):a,c=i.serialize(r);n.setItem(t,c)}catch(a){s&&console.error("[pinia-plugin-persistedstate]",a)}}function y(e,n,i){const{pinia:t,store:s,options:{persist:o=i}}=e;if(!o)return;if(!(s.$id in t.state.value)){const r=t._s.get(s.$id.replace("__hot:",""));r&&Promise.resolve().then(()=>r.$persist());return}const a=(Array.isArray(o)?o:o===!0?[{}]:[o]).map(n);s.$hydrate=({runHooks:r=!0}={})=>{a.forEach(c=>{p(s,c,e,r)})},s.$persist=()=>{a.forEach(r=>{m(s.$state,r)})},a.forEach(r=>{p(s,r,e),s.$subscribe((c,f)=>m(f,r),{detached:!0})})}function k(e={}){return function(n){y(n,i=>({key:(e.key?e.key:t=>t)(i.key??n.store.$id),debug:i.debug??e.debug??!1,serializer:i.serializer??e.serializer??{serialize:t=>JSON.stringify(t),deserialize:t=>S(t)},storage:i.storage??e.storage??window.localStorage,beforeHydrate:i.beforeHydrate,afterHydrate:i.afterHydrate,pick:i.pick,omit:i.omit}),e.auto??!1)}}var O=k();export{O as i};
