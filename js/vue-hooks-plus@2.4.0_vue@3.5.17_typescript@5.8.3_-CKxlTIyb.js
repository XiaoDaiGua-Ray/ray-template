import{k as b,u as v,x as $,h as ee,a as z,y as te,n as ne}from"./@vue_reactivity@3.5.17-Cach6sCz.js";import{j as R,w as U,f as C,R as Y,i as se}from"./@vue_runtime-core@3.5.17-YYjRSOhw.js";import{o as ie,q as re,c as V}from"./lodash-es@4.17.21-UVJw7vmf.js";import"./js-cookie@3.0.5-Z_8Sd105.js";import{s as _}from"./screenfull@5.2.0-CSmfy_M5.js";const J=(t,{manual:e,ready:n=!0,refreshDeps:s=[],refreshDepsAction:i})=>{const o=b(!1);return R(()=>{!e&&t.options.refreshDeps!==!0&&(o.value=v(n))}),s instanceof Array?U([o,...s],([r])=>{r&&!e&&r&&(i?i():t.refresh())},{deep:!0,immediate:!1}):U(o,r=>{!e&&r&&(i?i():t.refresh())}),{name:"autoRunPlugin",onBefore:()=>{if(!v(n))return{stopNow:!0}}}};J.onInit=({ready:t=!0,manual:e})=>({loading:!e&&v(t)});const A=new Map,oe=(t,e,n)=>{const s=A.get(t);s!=null&&s.timer&&clearTimeout(s.timer);let i;e>-1&&(i=setTimeout(()=>{A.delete(t)},e)),A.set(t,{...n,timer:i})},le=t=>A.get(t),F=new Map,ae=t=>F.get(t),ue=(t,e)=>{F.set(t,e),e.then(n=>(F.delete(t),n)).catch(n=>{throw F.delete(t),n})},E={},ce=[],fe=(t,e)=>{E[t]&&(E[t].forEach(n=>n(e)),ce.forEach(n=>n({type:t,data:e})))},x=(t,e)=>(E[t]||(E[t]=[]),E[t].push(e),function(){const s=E[t].indexOf(e);E[t].splice(s,1)}),de=(t,{cacheKey:e,cacheTime:n=5*60*1e3,staleTime:s=0,setCache:i,getCache:o})=>{const r=b(),u=b(),d=(a,f)=>{i?i(f):oe(a,n,f),fe(a,f.data)},c=(a,f=[])=>o?o(f):le(a);return R(()=>{if(!e)return;const a=c(e);a&&Object.hasOwnProperty.call(a,"data")&&(t.state.data=a.data,t.state.params=a.params,(s===-1||new Date().getTime()-a.time<=s)&&(t.state.loading=!1)),r.value=x(e,f=>{t.setState({data:f})})}),$(()=>{var a;(a=r.value)==null||a.call(r)}),e?{name:"cachePlugin",onBefore:a=>{const f=c(e,a);return!f||!Object.hasOwnProperty.call(f,"data")?{}:s===-1||new Date().getTime()-f.time<=s?{loading:!1,data:f==null?void 0:f.data,returnNow:!0}:{data:f==null?void 0:f.data}},onRequest:(a,f)=>{let h=ae(e);return h&&h!==u.value?{servicePromise:h}:(h=a(...f),u.value=h,ue(e,h),{servicePromise:h})},onSuccess:(a,f)=>{var h;e&&((h=r.value)==null||h.call(r),d(e,{data:a,params:f,time:new Date().getTime()}),r.value=x(e,l=>{t.setState({data:l})}))},onMutate:a=>{var f;e&&((f=r.value)==null||f.call(r),d(e,{data:a,params:t.state.params,time:new Date().getTime()}),r.value=x(e,h=>{t.setState({data:h})}))}}:{}},he=(t,{debounceWait:e,debounceLeading:n,debounceTrailing:s,debounceMaxWait:i})=>{const o=b(),r=C(()=>{const u={},d=v(n),c=v(s),a=v(i);return d!==void 0&&(u.leading=d),c!==void 0&&(u.trailing=c),a!==void 0&&(u.maxWait=a),u});return R(u=>{if(v(e)){const d=t.runAsync.bind(t);o.value=ie(c=>{c()},v(e),r.value),t.runAsync=(...c)=>new Promise((a,f)=>{var h;(h=o.value)==null||h.call(o,()=>{d(...c).then(a).catch(f)})}),u(()=>{var c;(c=o.value)==null||c.cancel(),t.runAsync=d})}}),v(e)?{name:"debouncePlugin",onCancel:()=>{var u;(u=o.value)==null||u.cancel()}}:{}};var ve=Object.defineProperty,me=(t,e,n)=>e in t?ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j=(t,e,n)=>(me(t,typeof e!="symbol"?e+"":e,n),n);class pe{constructor(){j(this,"table",{}),j(this,"hashTable",{})}insert(e){const n=Symbol(e);return this.table[e]=!0,this.hashTable[n]=e,n}find(e){return this.hashTable[e]}}new pe;var be=Object.defineProperty,ge=(t,e,n)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Q=(t,e,n)=>(ge(t,typeof e!="symbol"?e+"":e,n),n);class _e{constructor(){Q(this,"requestInstances",new Map),Q(this,"listeners",[])}emit(e){this.listeners.forEach(n=>n(e))}subscribe(e){return this.listeners.push(e),()=>{const n=this.listeners.indexOf(e);this.listeners.splice(n,1)}}insert(e,n){this.requestInstances.set(e,{...n}),this.emit({key:e,...n})}update(e,n){this.has(e)&&this.requestInstances.set(e,{...this.requestInstances.get(e),...n})}has(e){return this.requestInstances.has(e)}reset(e){if(this.requestInstances.has(e)){const n=this.requestInstances.get(e);this.requestInstances.clear(),this.insert(e,n)}else this.requestInstances.clear()}getAll(){return this.requestInstances}}new _e;const we=(t,{loadingDelay:e})=>{const n=b(),s=()=>{n.value&&(clearTimeout(v(n.value)),n.value=void 0)};return{name:"loadingDelayPlugin",onFinally:()=>{s();const i=v(e);i&&(t.setState({loading:!0}),n.value=setTimeout(()=>{t.setState({loading:!1})},i))},onError:()=>{s()}}};function L(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}const Pe=!!(typeof window<"u"&&window.document&&window.document.createElement);function H(){return L()?document.visibilityState!=="hidden":!0}const S=[];function Ee(t){return S.push(t),function(){const n=S.indexOf(t);S.splice(n,1)}}if(L()){const t=()=>{if(H())for(let e=0;e<S.length;e++){const n=S[e];n()}};window.addEventListener("visibilitychange",t,!1)}const Re=(t,{pollingInterval:e,pollingWhenHidden:n=!0,pollingErrorRetryCount:s=-1})=>{let i;const o=b(),r=b(0),u=()=>{var d;i&&clearTimeout(i),(d=o.value)==null||d.call(o)};return R(()=>{v(e)||u()}),v(e)?{name:"pollingPlugin",onBefore:()=>{u()},onError:()=>{r.value+=1},onSuccess:()=>{r.value=0},onFinally:()=>{s===-1||s!==-1&&r.value<=s?i=setTimeout(()=>{!n&&!H()?o.value=Ee(()=>{t.refresh()}):t.refresh()},v(e)):r.value=0},onCancel:()=>{u()}}:{}};function Oe(t,e){let n=!1;return(...s)=>{n||(n=!0,t(...s),setTimeout(()=>{n=!1},e))}}function Se(){return L()&&typeof navigator.onLine<"u"?navigator.onLine:!0}const D=[];function De(t){return D.push(t),function(){const n=D.indexOf(t);n>-1&&D.splice(n,1)}}if(Pe){const t=()=>{if(!(!H()||!Se()))for(let e=0;e<D.length;e++){const n=D[e];n()}};window.addEventListener("visibilitychange",t,!1),window.addEventListener("focus",t,!1)}const Te=(t,{refreshOnWindowFocus:e,focusTimespan:n=5e3})=>{const s=b(),i=()=>{var o;(o=s.value)==null||o.call(s)};return R(o=>{if(v(e)){const r=Oe(t.refresh.bind(t),v(n));s.value=De(()=>{r()})}o(()=>{i()})}),$(()=>{i()}),{name:"refreshOnWindowFocusPlugin"}},Ae=(t,{retryInterval:e,retryCount:n})=>{const s=b(),i=b(0),o=b(!1);return n?{name:"retryPlugin",onBefore:()=>{o.value||(i.value=0),o.value=!1,s.value&&clearTimeout(s.value)},onSuccess:()=>{i.value=0},onError:()=>{if(i.value+=1,n===-1||i.value<=n){const r=e??Math.min(1e3*2**i.value,3e4);s.value=setTimeout(()=>{o.value=!0,t.refresh()},r)}else i.value=0},onCancel:()=>{i.value=0,s.value&&clearTimeout(s.value)}}:{}},Fe=(t,{throttleWait:e,throttleLeading:n,throttleTrailing:s})=>{let i=null;const o=C(()=>{const c={};return v(n)!==void 0&&(c.leading=v(n)),v(s)!==void 0&&(c.trailing=v(s)),c}),r=t.runAsync.bind(t),u=b(),d=C(()=>v(e));return U([d,o],c=>{i&&(i.cancel(),t.runAsync=r);const[a,f]=c,h=re(l=>{l()},v(a),f);i=h,u.value=h,t.runAsync=(...l)=>new Promise((w,m)=>{var g;(g=u.value)==null||g.call(u,()=>{r(...l).then(w).catch(m)})})},{immediate:!0}),v(e)?(Y(()=>{var c;(c=u.value)==null||c.cancel()}),{name:"throttlePlugin",onCancel:()=>{var c;(c=u.value)==null||c.cancel()}}):{}},W=t=>typeof t=="function",qe=t=>typeof t=="boolean";var Ce=Object.defineProperty,ye=(t,e,n)=>e in t?Ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,T=(t,e,n)=>(ye(t,typeof e!="symbol"?e+"":e,n),n);class xe{constructor(e,n,s,i={}){T(this,"pluginImpls"),T(this,"count",0),T(this,"state",{loading:!1,params:void 0,data:void 0,error:void 0}),T(this,"previousValidData"),this.serviceRef=e,this.options=n,this.setUpdateData=s,this.initState=i,this.state={...this.state,loading:!n.manual,...i}}setState(e={}){this.state={...this.state,...e},this.setUpdateData(this.state)}setData(e,n){console.warn("Please use 'setFetchState' instead of 'setData'"),n instanceof Array?n.forEach(s=>{this.state[s]=e,this.setUpdateData(e,s)}):(this.state[n]=e,this.setUpdateData(e,n))}setFetchState(e,n){n instanceof Array?n.forEach(s=>{this.state[s]=e,this.setUpdateData(e,s)}):(this.state[n]=e,this.setUpdateData(e,n))}runPluginHandler(e,...n){var s,i,o;const r=(o=(i=(s=this.pluginImpls)==null?void 0:s.map(u=>{var d;return(d=u[e])==null?void 0:d.call(u,...n)}))!=null?i:[])==null?void 0:o.filter(Boolean);return Object.assign({},...r)}async runAsync(...e){var n,s,i,o,r,u,d,c,a,f,h;this.count+=1;const l=this.count,{stopNow:w=!1,returnNow:m=!1,...g}=this.runPluginHandler("onBefore",e);if(w)return new Promise(()=>{});if(this.setState({loading:!0,params:e,...g}),m)return Promise.resolve(g.data);try{(s=(n=this.options).onBefore)==null||s.call(n,e)}catch(p){return this.setState({error:p,loading:!1}),(o=(i=this.options).onError)==null||o.call(i,p,e),this.runPluginHandler("onError",p,e),new Promise(()=>{})}try{let{servicePromise:p}=this.runPluginHandler("onRequest",this.serviceRef.value,e);const Z=y=>{var N,M,G,I;if(!this.options.concurrent&&l!==this.count)return new Promise(()=>{});const P=this.options.formatResult?this.options.formatResult(y):y,k={data:y};return this.setState({data:P,error:void 0,loading:!1}),(M=(N=this.options).onSuccess)==null||M.call(N,P,e),this.runPluginHandler("onSuccess",P,e,k),this.previousValidData=P,(I=(G=this.options).onFinally)==null||I.call(G,e,P,void 0),(this.options.concurrent||l===this.count)&&this.runPluginHandler("onFinally",e,P,void 0),P};p||(p=this.serviceRef.value(...e));const K=await p;return Z(K)}catch(p){if(!this.options.concurrent&&l!==this.count)return new Promise(()=>{});throw this.setState({error:p,loading:!1}),(u=(r=this.options).onError)==null||u.call(r,p,e),this.runPluginHandler("onError",p,e),(W((d=this.options)==null?void 0:d.rollbackOnError)&&((c=this.options)!=null&&c.rollbackOnError(e))||qe((a=this.options)==null?void 0:a.rollbackOnError)&&this.options.rollbackOnError)&&this.setState({data:this.previousValidData}),(h=(f=this.options).onFinally)==null||h.call(f,e,void 0,p),(this.options.concurrent||l===this.count)&&this.runPluginHandler("onFinally",e,void 0,p),p}}run(...e){this.runAsync(...e).catch(n=>{this.options.onError||console.error(n)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const n=W(e)?e(this.state.data):e;this.runPluginHandler("onMutate",n),this.setState({data:n})}}const Be=Symbol("USEREQUEST_GLOBAL_OPTIONS_PROVIDE_KEY");function Ue(t){return Object.keys(t).filter(n=>["data","loading","params","error"].includes(n)).length===4}function $e(t,e={},n=[]){const s=se(Be,{}),{initialData:i=void 0,manual:o=!1,ready:r=!0,...u}={...s??{},...e??{}},d={manual:o,ready:r,initialData:i,...u},c=b(t),a=ee({data:i,loading:!1,params:void 0,error:void 0}),f=(m,g)=>{g?a[g]=m:Ue(m)&&(a.data=m.data,a.loading=m.loading,a.error=m.error,a.params=m.params)},h=n.map(m=>{var g;return(g=m==null?void 0:m.onInit)==null?void 0:g.call(m,d)}).filter(Boolean),l=new xe(c,d,f,Object.assign({},...h,a));l.options=d,l.pluginImpls=n.map(m=>m(l,d));const w=C(()=>z(r)?r.value:r);if(R(()=>{if(!o){const m=l.state.params||e.defaultParams||[];w.value&&l.options.refreshDeps===!0&&c.value&&l.run(...m)}}),!o&&l.options.refreshDeps!==!0){const m=l.state.params||e.defaultParams||[];v(r)&&l.run(...m)}return $(()=>{l.cancel()}),{...te(a),cancel:l.cancel.bind(l),refresh:l.refresh.bind(l),refreshAsync:l.refreshAsync.bind(l),run:l.run.bind(l),runAsync:l.runAsync.bind(l),mutate:l.mutate.bind(l)}}const Le=(t,e)=>function(s,i={},o=[]){let r=t;const u=e||[];for(let d=u.length;d--;)r=u[d](r);return r(s,i,o)};function We(t,e,n){var s;const i=(s=[null,he,we,Re,Te,Fe,J,de,Ae])==null?void 0:s.filter(Boolean);return Le($e,e==null?void 0:e.use)(t,e,[...i])}const He=!!(typeof window<"u"&&window.document&&window.document.createElement);function B(t,e){var n,s;if(!He)return;if(!t)return e;let i;return typeof t=="function"?i=t():z(t)?i=(s=(n=t.value)==null?void 0:n.$el)!=null?s:t.value:i=t,i}var Ne=Object.defineProperty,Me=(t,e,n)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q=(t,e,n)=>(Me(t,typeof e!="symbol"?e+"":e,n),n);const O=class{constructor(t){q(this,"subscriptions",new Map),q(this,"emitEffectCache",new Map),q(this,"isGlobal"),this.isGlobal=!!(t!=null&&t.global),this.clear()}static getInstance(){return O.instance||(O.instance=new O({global:!0})),O.instance}subscribe(t,e){this.subscriptions.has(t)||this.subscriptions.set(t,new Set);const n=this.subscriptions.get(t);return n.add(e),this.isGlobal||this.emitEffect(t),()=>{n.delete(e),n.size===0&&this.subscriptions.delete(t)}}emit(t,...e){if(typeof t=="string"||typeof t=="number"){const n=this.subscriptions.get(t);n==null||n.forEach(s=>{s==null||s({params:V(e.length===1?e[0]:e),event:t})}),this.isGlobal||this.emitEffectCache.set(t,{params:V(e.length===1?e[0]:e),event:t})}else throw new TypeError("event must be string or number!")}emitEffect(t){if(this.isGlobal)return;const e=this.emitEffectCache.get(t),n=this.subscriptions.get(t);e&&(n==null||n.forEach(s=>{s==null||s({...e})}))}removeListener(t,e){if(!e)this.subscriptions.delete(t);else{const n=this.subscriptions.get(t);n==null||n.delete(e),n&&n.size===0&&this.subscriptions.delete(t)}}clear(){this.subscriptions.clear(),this.emitEffectCache.clear()}};let X=O;q(X,"instance",null);X.getInstance();const ze=(t,e)=>{const{onExit:n,onEnter:s,defaultElement:i=document.documentElement}={},o=b(n),r=b(s),u=b(!1),d=l=>{u.value=l},c=()=>{var l,w,m;if(_.isEnabled){const g=B(t,i);if(!_.element)(l=o.value)==null||l.call(o),d(!1),_.off("change",c);else{const p=_.element===g;p?(w=r.value)==null||w.call(r):(m=o.value)==null||m.call(o),d(p)}}},a=()=>{const l=B(t,i);if(l&&_.isEnabled)try{_.request(l),_.on("change",c)}catch(w){console.error(w)}},f=()=>{const l=B(t,i);_.isEnabled&&_.element===l&&_.exit()},h=()=>{u.value?f():a()};return Y(()=>{_.isEnabled&&_.off("change",c)}),[ne(u),{enterFullscreen:a,exitFullscreen:f,toggleFullscreen:h,isEnabled:_.isEnabled}]};export{We as a,ze as u};
